<!-- vers√£o 78 -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    
    <meta charset="UTF-8"><!-- vers√£o 78 -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>LIAM - Laborat√≥rio Interativo de Alfabetiza√ß√£o Matem√°tica - 9¬∫ Ano</title>
    <!-- Font Awesome para √≠cones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        :root {
            /* --- SISTEMA DE CAMADAS (Z-INDEX) --- */
            --z-back: -1;          /* Fundo */
            --z-base: 1;           /* Conte√∫do normal */
            --z-content: 10;       /* Container principal */
            --z-controls: 100;     /* Bot√µes flutuantes (Conquista, Calc Btn) */
            --z-floating: 500;     /* Calculadora aberta */
            --z-overlay: 900;      /* Fundo escuro do modal */
            --z-modal: 1000;       /* Janelas (Conquistas, Config) */
            --z-notification: 2000;/* Avisos (Level Up, Pontos) */
            --z-effects: 9999;     /* Fogos de artif√≠cio (Sempre no topo) */
        }

        body {
            background: linear-gradient(135deg, #1a237e, #283593);
            color: white;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            position: relative;
            z-index: var(--z-content); /* Era 10 */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        


        h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #ffeb3b;
            text-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
            font-size: 2.5rem;
            background: linear-gradient(90deg, #ffeb3b, #ff9800);
            background-clip: text; /* LINHA ADICIONADA */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 235, 59, 0.3);
        }
        
        /* Painel de status do jogo */
        .game-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .status-item:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .status-label {
            color: #bbdefb;
            font-size: 14px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .status-value {
            font-size: 28px;
            font-weight: bold;
            color: #ffeb3b;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .status-subtext {
            font-size: 12px;
            color: #90caf9;
            margin-top: 5px;
        }
        
        /* Sistema de conquistas */
        .achievement-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff9800, #ff5722);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
            z-index: var(--z-controls);
            transition: all 0.3s;
        }
        
        .achievement-badge:hover {
            transform: scale(1.1) rotate(15deg);
        }
        
/* ========== MODAL DE CONQUISTAS ========== */
.achievements-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: var(--z-modal);
    animation: fadeIn 0.3s ease;
}

.achievements-modal.active {
    display: flex;
}

.modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: var(--z-overlay);
}

.modal-content {
    background: linear-gradient(135deg, #1a237e, #283593);
    border-radius: 20px;
    width: 90%;
    max-width: 500px;
    max-height: 80vh;
    overflow: hidden;
    z-index: var(--z-modal);
    position: relative;
    border: 2px solid #ff9800;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    animation: slideInUp 0.4s ease;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    padding: 20px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-close {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.modal-close:hover {
    background: rgba(255, 152, 0, 0.3);
    transform: rotate(90deg);
}

.modal-body {
    padding: 20px;
    overflow-y: auto;
    max-height: 50vh;
}

.modal-footer {
    padding: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.2);
}

/* Ajuste para os itens de conquista no modal */
.modal-body .achievement-item {
    margin-bottom: 15px;
}

/* Responsividade do modal */
@media (max-width: 768px) {
    .modal-content {
        width: 95%;
        max-height: 90vh;
    }
    
    .modal-body {
        max-height: 60vh;
    }
}
  


/* Modal de teoria */
.theory-modal, .theory-content-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: var(--z-modal);
    animation: fadeIn 0.3s ease;
}

.theory-modal.active, .theory-content-modal.active {
    display: flex;
}

.theme-choice-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    padding: 25px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
}

.theme-choice-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: #ff9800;
    transform: translateY(-5px);
}

.theory-content-modal .modal-body {
    max-height: 70vh;
    overflow-y: auto;
}

.theory-content-modal h4 {
    color: #ffeb3b;
    margin-top: 20px;
    margin-bottom: 10px;
}

.theory-content-modal p {
    margin-bottom: 10px;
    line-height: 1.5;
}

.theory-content-modal ul {
    margin-left: 20px;
    margin-bottom: 15px;
}

.theory-content-modal li {
    margin-bottom: 5px;
}



        .achievement-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            transition: all 0.3s;
        }
        
        .achievement-item.locked {
            opacity: 0.5;
        }
        
        .achievement-item.unlocked {
            border: 2px solid #ffeb3b;
            box-shadow: 0 0 15px rgba(255, 235, 59, 0.3);
        }
        
        .achievement-icon {
            font-size: 30px;
            margin-right: 15px;
            min-width: 50px;
            text-align: center;
        }
        
        .achievement-info h4 {
            color: #ffeb3b;
            margin-bottom: 5px;
        }
        

        /* --- ADICIONE ISTO AO SEU CSS --- */
        
        .power-up.disabled {
            opacity: 0.3;               /* Bem transparente */
            filter: grayscale(100%);    /* Tira toda a cor (fica cinza) */
            cursor: not-allowed;        /* Cursor de bloqueio */
            pointer-events: none;       /* Impede cliques */
            box-shadow: none !important;/* Remove o brilho */
            border-color: #555 !important; /* Borda escura */
            transform: none !important; /* Remove anima√ß√£o de movimento */
        }

        .achievement-info p {
            font-size: 12px;
            color: #bbdefb;
        }
        
        /* Progresso do n√≠vel */
        .level-progress {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            position: relative;
        }
        
        .level-bar {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }
        
        .level-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .level-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Substitua todo o bloco .calc-btn antigo por este: */

.calc-btn {
    /* Removemos position: fixed, bottom e left */
    position: relative; 
    display: flex;
    align-items: center;
    justify-content: center;
    
    /* Tamanho igual ao dos power-ups */
    width: 60px;
    height: 60px;
    
    /* Estilo visual */
    background: linear-gradient(135deg, #4caf50, #2e7d32);
    color: white;
    border-radius: 50%;
    border: 2px solid #4caf50; /* Borda para combinar */
    font-size: 24px; /* Ajuste para o √≠cone ficar centralizado */
    cursor: pointer;
    box-shadow: 0 0 15px rgba(76, 175, 80, 0.4);
    z-index: var(--z-controls);
    transition: all 0.3s ease;
    
    /* Margem para n√£o colar nos outros */
    margin: 0; 
}

.calc-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 0 25px rgba(76, 175, 80, 0.6);
}        
        .calculator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 320px;
            background: #1e1e1e;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.7);
            display: none;
            flex-direction: column;
            z-index: var(--z-floating);
            border: 2px solid #444;
            overflow: hidden;
        }
        
        .calculator.active {
            display: flex;
        }
        
        .calc-header {
            background: linear-gradient(90deg, #2196f3, #1976d2);
            padding: 12px 20px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            color: white;
            font-weight: bold;
        }
        
        .calc-controls {
            display: flex;
            gap: 5px;
        }
        
        .calc-controls button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calc-controls button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .calc-display {
            background: #1a1a1a;
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #444;
        }
        
        .calc-expression {
            color: #888;
            font-size: 14px;
            min-height: 20px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .calc-result {
            color: white;
            font-size: 28px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            padding: 15px;
            background: #2a2a2a;
        }
        
        .calc-button {
            background: #3a3a3a;
            color: white;
            border: none;
            height: 50px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calc-button:hover {
            background: #4a4a4a;
        }
        
        .calc-button.operator {
            background: #ff9800;
        }
        
        .calc-button.operator:hover {
            background: #ffb74d;
        }
        
        .calc-button.equals {
            background: #4caf50;
            grid-column: span 2;
        }
        
        .calc-button.clear {
            background: #f44336;
        }
        
        /* Temas de jogo */
        .theme-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .theme-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }
        
        .theme-card:hover {
            transform: translateY(-10px);
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 152, 0, 0.3);
        }
        
        .theme-card.selected {
            background: rgba(255, 152, 0, 0.2);
            border: 2px solid #ff9800;
            box-shadow: 0 10px 25px rgba(255, 152, 0, 0.3);
        }
        
        .theme-icon {
            font-size: 50px;
            margin-bottom: 15px;
            color: #ffeb3b;
        }
        
        .theme-card h3 {
            margin-bottom: 10px;
            color: #ffeb3b;
            font-size: 1.5rem;
        }
        
        .theme-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 12px;
            color: #90caf9;
        }
        


        /* Modal do Tutorial */
.tutorial-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: var(--z-modal);
    animation: fadeIn 0.3s ease;
}

.tutorial-modal.active {
    display: flex;
}

.tutorial-modal .modal-content {
    background: linear-gradient(135deg, #1a237e, #283593);
    border-radius: 20px;
    width: 90%;
    max-width: 900px;
    max-height: 80vh;
    overflow: hidden;
    z-index: var(--z-modal);
    position: relative;
    border: 2px solid #2196f3;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    animation: slideInUp 0.4s ease;
}

.tutorial-modal h4 {
    color: #ffeb3b;
    margin-bottom: 15px;
    font-size: 1.3rem;
}

.tutorial-modal p {
    margin-bottom: 10px;
    line-height: 1.5;
    color: #bbdefb;
}

.tutorial-modal ul {
    margin-left: 20px;
    margin-bottom: 15px;
}

.tutorial-modal li {
    margin-bottom: 8px;
    color: #bbdefb;
}

        /* Adicionar no CSS: */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .shake { animation: shake 0.5s ease; }

        /* Configura√ß√µes - CORRIGIDO */
        select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: #ffeb3b;
            border: 1px solid rgba(255, 235, 59, 0.3);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        select:hover {
            border-color: #ff9800;
        }
        
        select option {
            background: #1a237e;
            color: white;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #bbdefb;
            font-weight: 500;
        }
        
        /* Quest√µes */
        .question-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #ff9800;
            animation: fadeIn 0.5s ease;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .question-number {
            background: linear-gradient(135deg, #ff9800, #ff5722);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            box-shadow: 0 4px 10px rgba(255, 152, 0, 0.3);
        }
        
        .question-difficulty {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .difficulty-easy { color: #4caf50; }
        .difficulty-medium { color: #ff9800; }
        .difficulty-hard { color: #f44336; }
        
        .question-text {
            font-size: 1.2rem;
            line-height: 1.6;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 4px solid #2196f3;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin: 25px 0;
        }
        
        .option {
            width: 100%;
            text-align: left;
            font-family: inherit;
            font-size: 1rem;
            color: white;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .option:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateX(5px);
        }
        
        .option.selected {
            background: rgba(255, 152, 0, 0.2);
            border-color: #ff9800;
        }
        
        .option.correct {
            background: rgba(76, 175, 80, 0.2);
            border-color: #4caf50;
            animation: pulseCorrect 0.5s ease;
        }
        
        .option.incorrect {
            background: rgba(244, 67, 54, 0.2);
            border-color: #f44336;
        }
        
        @keyframes pulseCorrect {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .option-letter {
            background: rgba(255, 255, 255, 0.15);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            color: #ffeb3b;
            font-size: 16px;
        }
        
        /* Ajuste para os power-ups com calculadora */
.power-ups {
    display: flex;
    justify-content: center;
    align-items: center; /* Alinha verticalmente */
    gap: 15px;
    margin: 20px 0;
    flex-wrap: wrap; /* Permite quebra de linha em telas pequenas */
}
        
        .power-up {
            background: rgba(156, 39, 176, 0.3);
            border: 2px solid #9c27b0;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .power-up:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(156, 39, 176, 0.5);
        }
        
        .power-up:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .power-up-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Bot√µes */
        .btn {
            background: linear-gradient(90deg, #ff9800, #ff5722);
            color: white;
            border: none;
            padding: 15px 35px;
            font-size: 16px;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px;
            font-weight: bold;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
        }
        
        .btn:hover:not(:disabled) {
            opacity: 0.9;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 152, 0, 0.6);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, #2196f3, #1976d2);
        }
        
        /* Feedback */
        .feedback-card {
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            animation: slideIn 0.5s ease;
            display: none;
        }
        
        .feedback-card.correct {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4caf50;
        }
        
        .feedback-card.incorrect {
            background: rgba(244, 67, 54, 0.2);
            border: 2px solid #f44336;
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Tela de resultados */
        .results-container {
            text-align: center;
            animation: fadeIn 0.8s ease;
        }
        
        .trophy {
            font-size: 80px;
            color: #ffeb3b;
            margin: 20px 0;
            animation: bounce 1s ease infinite alternate;
        }
        
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-20px); }
        }
        
        .score-display {
            font-size: 60px;
            font-weight: bold;
            background: linear-gradient(90deg, #ffeb3b, #ff9800);
            background-clip: text; /* LINHA ADICIONADA */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            transition: all 0.3s;
        }
        
/* --- NOVO: Canvas para Fogos de Artif√≠cio (Alta Performance) --- */
        #fireworks-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Deixa clicar atrav√©s dele */
            z-index: var(--z-effects);
        }

        /* --- NOVO: Classe para Leitor de Tela (Invis√≠vel visualmente) --- */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }




        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Anima√ß√µes */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .theme-selection {
                grid-template-columns: 1fr;
            }
            
            .game-status {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .calculator {
                width: 90%;
                left: 5%;
                top: 50px;
                transform: translateX(-50%);
            }
            
            .achievements-panel {
                width: 100%;
                right: -100%;
            }
        }
        
        /* Efeitos especiais - Fogos de artif√≠cio */
        .firework {
            position: fixed;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            pointer-events: none;
            z-index: var(--z-effects);
        }
        
        .firework-particle {
            position: fixed;
            pointer-events: none;
            border-radius: 50%;
            z-index: var(--z-effects);
        }
        
        .firework-trail {
            position: fixed;
            pointer-events: none;
            border-radius: 50%;
            z-index: var(--z-effects);
        }
        
        /* Streak indicator */
        .streak-indicator {
            position: absolute;
            top: -40px;
            right: 20px;
            background: linear-gradient(135deg, #ff5722, #d81b60);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: none;
            animation: pulseStreak 1s infinite;
        }
        
        @keyframes pulseStreak {
            0% { box-shadow: 0 0 0 0 rgba(255, 87, 34, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 87, 34, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 87, 34, 0); }
        }
        
        /* Timer */
        .timer-container {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto;
        }
        
        .timer-circle {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        .timer-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 8;
        }
        
        .timer-progress {
            fill: none;
            stroke: #4caf50;
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 1s linear;
        }
        
        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            font-weight: bold;
            color: #ffeb3b;
        }
        
        /* Bot√£o de teste de fogos */
        .test-fireworks-btn {
            background: linear-gradient(90deg, #ff5722, #d81b60);
        }
        
        /* Anima√ß√£o de explos√£o de fogos */
        @keyframes firework {
            0% { 
                transform: translate(var(--x), var(--initialY));
                width: var(--initialSize);
                height: var(--initialSize);
                opacity: 1;
            }
            50% { 
                width: 0.5vmin;
                height: 0.5vmin;
            }
            100% { 
                transform: translate(var(--x), var(--y));
                opacity: 0;
            }
        }
        
        /* ========== FOOTER APRIMORADO ========== */
        .game-footer {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 2px solid rgba(255, 235, 59, 0.2);
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            padding: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .game-footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #ff9800, #ffeb3b, #2196f3, #4caf50);
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-title {
            text-align: center;
            margin-bottom: 30px;
            color: #ffeb3b;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .footer-title i {
            font-size: 2rem;
        }
        
        .authors-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .authors-section h3 {
            color: #ff9800;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .authors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .author-card {
            background: rgba(33, 150, 243, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(33, 150, 243, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .author-card:hover {
            transform: translateY(-8px);
            background: rgba(33, 150, 243, 0.2);
            border-color: #2196f3;
            box-shadow: 0 10px 20px rgba(33, 150, 243, 0.2);
        }
        
        .author-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #2196f3, #4caf50);
        }
        
        .author-icon {
            font-size: 2.5rem;
            color: #ffeb3b;
            margin-bottom: 15px;
            display: block;
        }
        
        .author-name {
            font-weight: bold;
            color: white;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }
        
        .author-role {
            color: #bbdefb;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .univesp-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 152, 0, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            color: #ff9800;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 25px;
            margin: 30px 0;
            padding: 20px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .footer-link {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #bbdefb;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        
        .footer-link:hover {
            background: rgba(255, 152, 0, 0.2);
            color: #ffeb3b;
            transform: translateY(-3px);
        }
        
        .footer-link i {
            font-size: 1.2rem;
        }
        
        .github-link {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: linear-gradient(90deg, #333, #444);
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: bold;
            margin: 25px auto;
            width: fit-content;
            transition: all 0.3s ease;
            border: 2px solid #555;
        }
        
        .github-link:hover {
            background: linear-gradient(90deg, #444, #555);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border-color: #ff9800;
        }
        
        .github-link i {
            font-size: 1.5rem;
        }
        
        .copyright {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #90caf9;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .copyright p {
            margin-bottom: 8px;
        }
        
        .math-formulas {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 25px 0;
            opacity: 0.7;
            font-size: 1.5rem;
        }
        
        .math-formula {
            animation: float 3s ease-in-out infinite;
        }
        
        .math-formula:nth-child(2) {
            animation-delay: 0.5s;
        }
        
        .math-formula:nth-child(3) {
            animation-delay: 1s;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @media (max-width: 768px) {
            .game-footer {
                padding: 20px;
            }
            
            .authors-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-links {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .footer-title {
                font-size: 1.5rem;
            }
        }

/* --- ATUALIZA√á√ÉO DO CSS --- */

/* Estilo para op√ß√£o selecionada (Ainda n√£o confirmada) - Cor Azul Neutra */
.option.selected {
    background: rgba(33, 150, 243, 0.2);
    border: 2px solid #2196f3;
    transform: translateX(10px);
    box-shadow: 0 0 15px rgba(33, 150, 243, 0.3);
}

/* Garante que o VERDE (Correto) sobrescreva o azul */
.option.correct {
    background: rgba(76, 175, 80, 0.2) !important;
    border-color: #4caf50 !important;
    transform: scale(1.02);
}

/* Garante que o VERMELHO (Incorreto) sobrescreva o azul */
.option.incorrect {
    background: rgba(244, 67, 54, 0.2) !important;
    border-color: #f44336 !important;
}

    </style>

    <script>
    window.MathJax = {
        tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']], // Permite usar $f√≥rmula$ no meio do texto
        displayMath: [['$$', '$$'], ['\\[', '\\]']] // Permite usar $$f√≥rmula$$ em linha separada
        },
        svg: {
        fontCache: 'global'
        }
    };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>


</head>
<body>
    <div id="a11y-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    <canvas id="fireworks-canvas"></canvas>

    <div class="container"> <!-- IN√çCIO DO CONTAINER -->
        
        
        <h1>üéÆ LIAM - Laborat√≥rio Interativo de Alfabetiza√ß√£o Matem√°tica - 9¬∫ Ano üéÆ</h1>
        
<div style="text-align: center;">
    <button class="btn" onclick="openTutorialModal()" style="background: linear-gradient(90deg, #2196f3, #1976d2); margin-top: 10px;">
        üéì Tutorial Inicial
    </button>
    <button class="btn" id="theory-btn" style="background: linear-gradient(90deg, #9c27b0, #673ab7); margin-top: 10px;">
        üìö Revis√£o Te√≥rica
    </button>
    <button class="btn btn-secondary" onclick="showStats()">üìä Ver Estat√≠sticas</button>
    <button class="btn test-fireworks-btn" onclick="testFireworks()" style="margin-top: 10px;">üéÜ Testar Fogos de Artif√≠cio</button>
    <button class="btn" onclick="testAudio()" style="background: linear-gradient(90deg, #5cda2a, #1ead25); margin-top: 10px;">üîä Testar Som</button>
    
    <!-- Novo bot√£o de conquistas -->
    <button class="btn" onclick="toggleAchievements()" style="background: linear-gradient(90deg, #ff9800, #ff5722); margin-top: 10px;">
        üèÜ Conquistas
    </button>

</div>

<!-- Bot√£o de conquistas -->
        <div class="achievement-badge" id="achievement-btn" role="button" tabindex="0" aria-label="Abrir Conquistas">
    üèÜ      <span class="achievement-count" id="achievement-count">0</span>
        </div>
        <!-- Status do jogo -->
        <div class="game-status">
            <div class="status-item">
                <div class="status-label">Tema</div>
                <div class="status-value" id="current-theme">-</div>
            </div>
            <div class="status-item">
                <div class="status-label">Pontua√ß√£o</div>
                <div class="status-value" id="score">0</div>
                <div class="status-subtext" id="streak">Streak: 0</div>
            </div>
            <div class="status-item">
                <div class="status-label">Quest√£o</div>
                <div class="status-value" id="question-counter">0/20</div>
                <div class="status-subtext">Tempo: 60s</div>
            </div>
            <div class="status-item">
                <div class="status-label">N√≠vel</div>
                <div class="status-value" id="level">1</div>
                <div class="status-subtext" id="xp">0/100 XP</div>
            </div>
        </div>
        
        <!-- Barra de progresso do n√≠vel -->
        <div class="level-progress">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span>Progresso do N√≠vel</span>
                <span id="level-percentage">0%</span>
            </div>
            <div class="level-bar">
                <div class="level-fill" id="level-fill"></div>
            </div>
        </div>
        
        <!-- Streak indicator -->
        <div class="streak-indicator" id="streak-indicator">
            üî• Streak: <span id="current-streak">0</span>
        </div>
        
       
        <div class="calculator" id="calculator">
            <div class="calc-header" id="calc-header">
                <div class="calc-title">Calculadora</div>
                <div class="calc-controls">
                    <button id="minimize-calc">‚àí</button>
                    <button id="close-calc">√ó</button>
                </div>
            </div>
            <div class="calc-display">
                <div class="calc-expression" id="calc-expression">0</div>
                <div class="calc-result" id="calc-result">0</div>
            </div>
            <div class="calc-buttons">
                <button class="calc-button clear" onclick="calcClear()">C</button>
                <button class="calc-button clear" onclick="calcClearEntry()">CE</button>
                <button class="calc-button" onclick="calcBackspace()">‚å´</button>
                <button class="calc-button operator" onclick="calcOperator('/')">√∑</button>
                <button class="calc-button operator" onclick="calcSqrt()">‚àö</button>
                
                <button class="calc-button" onclick="calcNumber(7)">7</button>
                <button class="calc-button" onclick="calcNumber(8)">8</button>
                <button class="calc-button" onclick="calcNumber(9)">9</button>
                <button class="calc-button operator" onclick="calcOperator('*')">√ó</button>
                <button class="calc-button operator" onclick="calcPower()">x¬≤</button>
                
                <button class="calc-button" onclick="calcNumber(4)">4</button>
                <button class="calc-button" onclick="calcNumber(5)">5</button>
                <button class="calc-button" onclick="calcNumber(6)">6</button>
                <button class="calc-button operator" onclick="calcOperator('-')">‚àí</button>
                <button class="calc-button operator" onclick="calcPercent()">%</button>
                
                <button class="calc-button" onclick="calcNumber(1)">1</button>
                <button class="calc-button" onclick="calcNumber(2)">2</button>
                <button class="calc-button" onclick="calcNumber(3)">3</button>
                <button class="calc-button operator" onclick="calcOperator('+')">+</button>
                <button class="calc-button" onclick="calcPi()">œÄ</button>
                
                <button class="calc-button" onclick="calcPlusMinus()">¬±</button>
                <button class="calc-button" onclick="calcNumber(0)">0</button>
                <button class="calc-button" onclick="calcDecimal()">.</button>
                <button class="calc-button equals" onclick="calcEquals()">=</button>
            </div>
        </div>
        
        <!-- Timer circular -->
        <div class="timer-container" id="timer-container" style="display: none;">
            <svg width="100" height="100" viewBox="0 0 100 100" class="timer-circle">
                <circle cx="50" cy="50" r="45" class="timer-bg"></circle>
                <circle cx="50" cy="50" r="45" class="timer-progress" id="timer-progress"></circle>
            </svg>
            <div class="timer-text" id="timer-text">60</div>
        </div>
        
        <!-- Tela inicial -->
        <div class="screen" id="start-screen" style="display: block;">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="font-size: 60px; margin-bottom: 20px;">üßÆ</div>
                <h2>Escolha o Tema</h2>
                <p style="color: #bbdefb; max-width: 600px; margin: 0 auto;">Teste seus conhecimentos em Matem√°tica do 9¬∫ ano. Use a calculadora para ajudar nos c√°lculos!</p>
            </div>
            
            <div class="theme-selection">
                <div class="theme-card" data-theme="probabilidade">
                    <div class="theme-icon">üìä</div>
                    <h3>Probabilidade</h3>
                    <p>Eventos dependentes e independentes, c√°lculo de probabilidades</p>
                    <div class="theme-stats">
                        <span>üîì Conclu√≠do: <span id="probabilidade-progress">0%</span></span>
                        <span>üèÜ Recorde: <span id="probabilidade-record">0</span></span>
                    </div>
                </div>
                
                <div class="theme-card" data-theme="estatistica">
                    <div class="theme-icon">üìà</div>
                    <h3>Estat√≠stica</h3>
                    <p>Gr√°ficos, m√©dia, mediana, moda, an√°lise de dados</p>
                    <div class="theme-stats">
                        <span>üîì Conclu√≠do: <span id="estatistica-progress">0%</span></span>
                        <span>üèÜ Recorde: <span id="estatistica-record">0</span></span>
                    </div>
                </div>
            </div>

            <!-- BOT√ÉO INICIAR JOGO ABAIXO DA SELE√á√ÉO DE TEMA -->
<div style="text-align: center; margin: 40px 0;">
    <button class="btn" id="start-btn" style="padding: 20px 50px; font-size: 1.2em;">
        üéÆ Iniciar Jogo
    </button>
</div>
         
 <!-- Power-ups dispon√≠veis -->
            <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 30px 0;">
                <h3 style="color: #ffeb3b; margin-bottom: 15px;">‚ú® Power-ups e Calculadora</h3>
                <div class="power-ups" style="justify-content: center;">
                    <div class="power-up" data-power="hint" title="Dica extra (3 dispon√≠veis)">
                        üí°
                        <div class="power-up-count" id="hint-count">3</div>
                    </div>
                    <div class="power-up" data-power="skip" title="Pular quest√£o (2 dispon√≠veis)">
                        ‚è≠Ô∏è
                        <div class="power-up-count" id="skip-count">2</div>
                    </div>
                    <div class="power-up" data-power="time" title="+10 segundos (1 dispon√≠vel)">
                        ‚è±Ô∏è
                        <div class="power-up-count" id="time-count">1</div>
                    </div>
                    <div class="power-up" data-power="double" title="Pontos em dobro (1 dispon√≠vel)">
                        ‚ú®
                        <div class="power-up-count" id="double-count">1</div>
                    </div>
                    <button class="calc-btn open-calc-btn" id="open-calc" aria-label="Abrir Calculadora" title="Calculadora">
    üî¢
</button>
                </div>
            </div>


            <!-- Configura√ß√µes simplificadas -->
           

<div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 30px 0;">
                <h3 style="color: #ffeb3b; margin-bottom: 15px;">‚öôÔ∏è Configura√ß√µes</h3>
                
                <div style="display: grid; grid-template-columns: 1fr; gap: 15px; max-width: 300px; margin: 0 auto;">
                    
                    <div>
                        <label for="sound-toggle">Sons e Efeitos:</label>
                        <select id="sound-toggle">
                            <option value="true">Ligado üîä</option>
                            <option value="false">Desligado üîá</option>
                        </select>
                    </div>

                    <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
                        <button id="reset-progress-btn" class="btn" style="background: linear-gradient(90deg, #d32f2f, #b71c1c); width: 100%; font-size: 14px; padding: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">
                            üóëÔ∏è Apagar Todo o Progresso
                        </button>
                    </div>
                    </div>

                <div style="text-align: center; margin-top: 15px; color: #bbdefb; font-size: 14px;">
                    <p>üìù Cada tema tem 20 quest√µes</p>
                    <p>‚è±Ô∏è Tempo: 60 segundos por quest√£o</p>
                    <p>üéØ Dificuldade: Mista (F√°cil, M√©dio e Dif√≠cil)</p>
                </div>
            </div>



            
           
            
            
        </div>
        
        <!-- Tela de perguntas -->
        <div class="screen" id="question-screen" style="display: none;">
            <div class="question-header">
                <div class="question-number" id="question-number">1</div>
                <div class="question-difficulty" id="question-difficulty">M√©dio</div>
            </div>
            
            <div class="question-card">
                <div class="question-text" id="question-text">
                    Carregando pergunta...
                </div>
                
                <div class="options-grid" id="options-container">
                    <!-- Op√ß√µes ser√£o inseridas aqui -->
                </div>
            </div>
            
            <!-- Power-ups durante o jogo -->
            <div class="power-ups" id="game-power-ups">
                <div class="power-up" data-power="hint" title="Dica extra" onclick="usePowerUp('hint')">
                    üí°
                    <div class="power-up-count" id="game-hint-count">3</div>
                </div>
                <div class="power-up" data-power="skip" title="Pular quest√£o" onclick="usePowerUp('skip')">
                    ‚è≠Ô∏è
                    <div class="power-up-count" id="game-skip-count">2</div>
                </div>
                <div class="power-up" data-power="time" title="+10 segundos" onclick="usePowerUp('time')">
                    ‚è±Ô∏è
                    <div class="power-up-count" id="game-time-count">2</div>
                </div>
                <div class="power-up" data-power="double" title="Pontos em dobro" onclick="usePowerUp('double')">
                    ‚ú®
                    <div class="power-up-count" id="game-double-count">3</div>
                </div>
                
                <!-- Bot√£o da calculadora para as quest√µes -->
                <button class="calc-btn open-calc-btn" id="open-calc-game" aria-label="Abrir Calculadora" title="Calculadora">
                    üî¢
                </button>
                </div>
            </div>
            
            <!-- Feedback -->
            <div class="feedback-card correct" id="correct-feedback">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 30px;">‚úÖ</div>
                    <div>
                        <h3 style="color: #4caf50; margin-bottom: 5px;">Resposta Correta!</h3>
                        <p>Voc√™ ganhou <span id="points-earned">0</span> pontos!</p>
                        <p id="bonus-info" style="font-size: 12px; color: #90caf9;"></p>
                    </div>
                </div>
            </div>
            
            <div class="feedback-card incorrect" id="incorrect-feedback">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 30px;">‚ùå</div>
                    <div>
                        <h3 style="color: #f44336; margin-bottom: 5px;">Resposta Incorreta</h3>
                        <p>A resposta correta √©: <span id="correct-answer"></span></p>
                        <p id="explanation" style="font-size: 14px; margin-top: 10px;"></p>
                    </div>
                </div>
            </div>
            
            <div class="game-controls" style="display: flex; justify-content: center; gap: 20px; margin-top: 30px;">
                <button class="btn" id="next-btn" disabled>Pr√≥xima Quest√£o</button>
               <!-- <button class="btn btn-secondary" id="hint-btn" onclick="showHint()">üí° Pedir Dica</button> -->
            </div>
        </div>
        
        <!-- Tela de resultados -->
        <div class="screen" id="results-screen" style="display: none;">
            <div class="results-container">
                <div class="trophy" id="trophy">üèÜ</div>
                
                <h2 style="margin-bottom: 20px;">Desafio Conclu√≠do!</h2>
                
                <div class="score-display" id="final-score">0%</div>
                <div style="color: #bbdefb; font-size: 18px; margin-bottom: 30px;">Sua pontua√ß√£o final</div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="status-label">Acertos</div>
                        <div class="status-value" id="final-correct">0</div>
                        <div class="status-subtext" id="accuracy">0% de precis√£o</div>
                    </div>
                    <div class="stat-card">
                        <div class="status-label">Pontos</div>
                        <div class="status-value" id="final-points">0</div>
                        <div class="status-subtext" id="bonus-points">+0 b√¥nus</div>
                    </div>
                    <div class="stat-card">
                        <div class="status-label">Tempo M√©dio</div>
                        <div class="status-value" id="avg-time">0s</div>
                        <div class="status-subtext" id="time-saved">-0s com power-ups</div>
                    </div>
                    <div class="stat-card">
                        <div class="status-label">Streak M√°xima</div>
                        <div class="status-value" id="max-streak">0</div>
                        <div class="status-subtext" id="streak-bonus">+0 pontos</div>
                    </div>
                </div>
                
                <!-- Novas conquistas desbloqueadas -->
                <div id="new-achievements" style="display: none; background: rgba(255, 235, 59, 0.1); padding: 20px; border-radius: 15px; margin: 30px 0; border: 2px solid #ffeb3b;">
                    <h3 style="color: #ffeb3b; margin-bottom: 15px;">üéâ Novas Conquistas!</h3>
                    <div id="achievements-unlocked"></div>
                </div>
                
                <!-- Resumo das respostas -->
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 30px 0;">
                    <h3 style="color: #ffeb3b; margin-bottom: 15px;">üìã Resumo das Respostas</h3>
                    <div id="answers-summary" style="max-height: 300px; overflow-y: auto; padding-right: 10px;">
                        <!-- Resumo ser√° inserido aqui -->
                    </div>
                </div>
                
                <!-- Gr√°fico de desempenho -->
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 30px 0;">
                    <h3 style="color: #ffeb3b; margin-bottom: 15px;">üìä Seu Desempenho</h3>
                    <canvas id="performance-chart" width="400" height="200" style="width: 100%; max-width: 600px; margin: 0 auto;"></canvas>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" id="restart-btn">üîÑ Jogar Novamente</button>
                    <button class="btn btn-secondary" id="change-theme-btn">üéØ Mudar Tema</button>
                    <button class="btn" onclick="shareResults()" style="background: linear-gradient(90deg, #2196f3, #1976d2);">üì§ Compartilhar</button>
                    <button class="btn" id="download-stats-btn" style="background: linear-gradient(90deg, #4caf50, #2e7d32);">üì• Baixar Estat√≠sticas</button>
                </div>
            </div>
        </div>
        
        <!-- FOOTER APRIMORADO -->
        <footer class="game-footer">
            <div class="footer-content">
                <h2 class="footer-title"><i class="fas fa-graduation-cap"></i> Projeto Integrador IV</h2>
                
                <div class="math-formulas">
                    <div class="math-formula">œÄ</div>
                    <div class="math-formula">‚àë</div>
                    <div class="math-formula">‚à´</div>
                    <div class="math-formula">‚àö</div>
                    <div class="math-formula">‚àû</div>
                </div>
                
                <div class="footer-links">
                    <a href="#" class="footer-link">
                        <i class="fas fa-university"></i>
                        <span>UNIVESP</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-book"></i>
                        <span>BNCC Matem√°tica</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Licenciatura em Matem√°tica</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-chart-bar"></i>
                        <span>Estat√≠stica</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-percentage"></i>
                        <span>Probabilidade</span>
                    </a>
                </div>
                
                <a href="https://github.com/profsergioericmatematica/Projeto-Integrador-IV" class="github-link" target="_blank">
                    <i class="fab fa-github"></i>
                    <span>C√≥digo dispon√≠vel no GitHub</span>
                </a>
                
                <div class="copyright">
                    <p>¬© 2026 Antonio Antunes Junior, Fl√°vio Rabelo Barros, Giovani Machado de Lima, Mariane Mendes Coutinho, Priscilla Santiago Zamorra, Rodrigo Aires de Medeiros Correa, Sergio Eric Reis de Oliveira e Vitor Correa Uberti</p>
                    <p>Projeto Integrador IV - Licenciatura em Matem√°tica - UNIVESP</p>
                    <p>Licenciado sob MIT License | C√≥digo dispon√≠vel em GitHub</p>
                </div>
            </div>
        </footer>
    </div>

<!-- Modal de Conquistas FORA DO CONTAINER (CORRETO!) -->
<div class="achievements-modal" id="achievements-modal">
    <div class="modal-overlay" onclick="closeAchievements()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 style="color: #ffeb3b;">üèÜ Conquistas</h3>
            <button class="modal-close" onclick="closeAchievements()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="achievements-list">
                <!-- Conquistas ser√£o adicionadas aqui -->
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn" onclick="closeAchievements()" style="width: 100%;">Fechar</button>
        </div>
    </div>
</div>

<!-- Modal de escolha de revis√£o -->
<div class="theory-modal" id="theory-modal">
    <div class="modal-overlay" onclick="closeTheoryModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 style="color: #ffeb3b;">üìö Escolha o Tema da Revis√£o</h3>
            <button class="modal-close" onclick="closeTheoryModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px;">
                <button class="theme-choice-btn" data-theory="probabilidade">
                    <div style="font-size: 40px;">üìä</div>
                    <h4>Probabilidade</h4>
                    <p>Revise conceitos de probabilidade para ajudar nas quest√µes.</p>
                </button>
                <button class="theme-choice-btn" data-theory="estatistica">
                    <div style="font-size: 40px;">üìà</div>
                    <h4>Estat√≠stica</h4>
                    <p>Revise conceitos de estat√≠stica para ajudar nas quest√µes.</p>
                </button>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeTheoryModal()" style="width: 100%;">Fechar</button>
        </div>
    </div>
</div>

<!-- Modal de Revis√£o de Probabilidade -->
<div class="theory-content-modal" id="probabilidade-modal">
    <div class="modal-overlay" onclick="closeTheoryContentModal('probabilidade')"></div>
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3 style="color: #ffeb3b;">üìä Revis√£o de Probabilidade</h3>
            <button class="modal-close" onclick="closeTheoryContentModal('probabilidade')">&times;</button>
        </div>
        <div class="modal-body">
            <div style="max-height: 60vh; overflow-y: auto; padding-right: 10px;">
                <h4>Conceitos B√°sicos</h4>
                <p><strong>Probabilidade</strong> √© a chance de um evento ocorrer.</p>
                <p>Espa√ßo amostral (S) √© o conjunto de todos os resultados poss√≠veis de um experimento aleat√≥rio.</p>
                <p>Evento (E) √© um subconjunto do espa√ßo amostral.</p>
                
                <h4>C√°lculo de Probabilidade</h4>
                <p>A probabilidade de um evento E ocorrer √© dada por:</p>
                <p style="text-align: center; font-size: 1.2em;">P(E) = n√∫mero de casos favor√°veis / n√∫mero de casos poss√≠veis</p>
                
                <h4>Exemplo</h4>
                <p>Jogar um dado: espa√ßo amostral S = {1,2,3,4,5,6}</p>
                <p>Evento "sair um n√∫mero par": E = {2,4,6}</p>
                <p>P(E) = 3/6 = 1/2 = 50%</p>
                
                <h4>Eventos Independentes</h4>
                <p>Dois eventos s√£o independentes quando a ocorr√™ncia de um n√£o afeta a probabilidade do outro.</p>
                <p>Exemplo: jogar uma moeda duas vezes. O resultado da primeira jogada n√£o afeta a segunda.</p>
                
                <h4>Eventos Dependentes</h4>
                <p>Dois eventos s√£o dependentes quando a ocorr√™ncia de um afeta a probabilidade do outro.</p>
                <p>Exemplo: tirar duas cartas de um baralho sem reposi√ß√£o. A segunda carta depende da primeira.</p>
                
                <h4>Probabilidade Condicional</h4>
                <p>√â a probabilidade de um evento ocorrer dado que outro evento j√° ocorreu.</p>
                <p>Nota√ß√£o: P(A|B) - probabilidade de A dado B.</p>
                
                <h4>Dicas para as Quest√µes</h4>
                <ul>
                    <li>Identifique sempre o espa√ßo amostral (total de possibilidades)</li>
                    <li>Conte cuidadosamente os casos favor√°veis</li>
                    <li>Para moedas e dados, lembre que todos os lados t√™m igual chance</li>
                    <li>Probabilidade varia de 0 (imposs√≠vel) a 1 (certo), ou 0% a 100%</li>
                    <li>A soma das probabilidades de todos os resultados poss√≠veis √© sempre 1</li>
                </ul>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeTheoryContentModal('probabilidade')" style="width: 100%;">Fechar</button>
        </div>
    </div>
</div>

<!-- Modal de Revis√£o de Estat√≠stica -->
<div class="theory-content-modal" id="estatistica-modal">
    <div class="modal-overlay" onclick="closeTheoryContentModal('estatistica')"></div>
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3 style="color: #ffeb3b;">üìà Revis√£o de Estat√≠stica</h3>
            <button class="modal-close" onclick="closeTheoryContentModal('estatistica')">&times;</button>
        </div>
        <div class="modal-body">
            <div style="max-height: 60vh; overflow-y: auto; padding-right: 10px;">
                <h4>Conceitos B√°sicos</h4>
                <p><strong>Estat√≠stica</strong> √© a ci√™ncia que coleta, organiza, analisa e interpreta dados.</p>
                
                <h4>Medidas de Tend√™ncia Central</h4>
                <p><strong>M√©dia Aritm√©tica:</strong> Soma de todos os valores dividida pelo n√∫mero de valores.</p>
                <p>F√≥rmula: M√©dia = (x‚ÇÅ + x‚ÇÇ + ... + x‚Çô) / n</p>
                <p>Exemplo: notas 5, 6, 7 ‚Üí m√©dia = (5+6+7)/3 = 6</p>
                
                <p><strong>Mediana:</strong> Valor que divide o conjunto de dados ordenados ao meio.</p>
                <p>Como calcular: 1) Ordene os dados; 2) Encontre o valor do meio.</p>
                <p>Exemplo: 1, 3, 3, 6, 7, 8, 9 ‚Üí mediana = 6</p>
                <p>Se houver n√∫mero par de valores, mediana √© a m√©dia dos dois centrais.</p>
                <p>Exemplo: 1, 2, 3, 4 ‚Üí mediana = (2+3)/2 = 2,5</p>
                
                <p><strong>Moda:</strong> Valor que aparece com maior frequ√™ncia.</p>
                <p>Exemplo: 1, 2, 2, 3, 4 ‚Üí moda = 2</p>
                
                <h4>Gr√°ficos</h4>
                <p><strong>Gr√°fico de Barras:</strong> Usado para comparar quantidades entre categorias.</p>
                <p><strong>Gr√°fico de Linhas:</strong> Usado para mostrar tend√™ncias ao longo do tempo.</p>
                <p><strong>Gr√°fico de Setores (Pizza):</strong> Usado para mostrar partes de um todo.</p>
                <p><strong>Histograma:</strong> Gr√°fico de barras para dados agrupados em intervalos.</p>
                
                <h4>Medidas de Dispers√£o</h4>
                <p><strong>Amplitude:</strong> Diferen√ßa entre o maior e o menor valor.</p>
                <p>F√≥rmula: Amplitude = valor m√°ximo - valor m√≠nimo</p>
                <p>Exemplo: no conjunto {2, 5, 8, 10}, amplitude = 10 - 2 = 8</p>
                
                <h4>Popula√ß√£o e Amostra</h4>
                <p><strong>Popula√ß√£o:</strong> Conjunto completo de elementos a ser estudado.</p>
                <p><strong>Amostra:</strong> Subconjunto da popula√ß√£o (parte selecionada para estudo).</p>
                <p>Exemplo: Pesquisa eleitoral: popula√ß√£o = todos os eleitores, amostra = parte dos eleitores entrevistados.</p>
                
                <h4>Dicas para as Quest√µes</h4>
                <ul>
                    <li>M√©dia: some todos e divida pela quantidade</li>
                    <li>Mediana: primeiro ORDENE os dados, depois ache o meio</li>
                    <li>Moda: √© o valor que mais se repete</li>
                    <li>Para gr√°ficos de pizza: o c√≠rculo inteiro = 100%</li>
                    <li>Dados qualitativos (cores, nomes) s√≥ t√™m moda, n√£o m√©dia</li>
                    <li>Amplitude mostra a varia√ß√£o dos dados</li>
                </ul>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeTheoryContentModal('estatistica')" style="width: 100%;">Fechar</button>
        </div>
    </div>
</div>


<!-- Modal do Tutorial -->
<div class="tutorial-modal" id="tutorial-modal">
    <div class="modal-overlay" onclick="closeTutorialModal()"></div>
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h3 style="color: #ffeb3b;">üéì Tutorial - LIAM - Laborat√≥rio Interativo de Alfabetiza√ß√£o Matem√°tica</h3>
            <button class="modal-close" onclick="closeTutorialModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div style="max-height: 70vh; overflow-y: auto; padding-right: 10px;">
                
                <!-- Se√ß√£o: Sobre o Projeto -->
                <div style="background: rgba(33, 150, 243, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #2196f3;">
                    <h4 style="color: #2196f3; margin-bottom: 15px;">üìã Sobre o Projeto</h4>
                    <p><strong>LIAM - Laborat√≥rio Interativo de Alfabetiza√ß√£o Matem√°tica</strong> √© um jogo educativo desenvolvido como parte do <strong>Projeto Integrador IV</strong> da Licenciatura em Matem√°tica da UNIVESP.</p>
                    <p><strong>Objetivo:</strong> Auxiliar estudantes do 9¬∫ ano do Ensino Fundamental no aprendizado de Probabilidade e Estat√≠stica, tornando o estudo mais interativo, divertido e eficaz.</p>
                    <p><strong>P√∫blico-alvo:</strong> Alunos do 9¬∫ ano, professores de matem√°tica e qualquer pessoa interessada em refor√ßar seus conhecimentos matem√°ticos.</p>
                </div>
                
                <!-- Se√ß√£o: Desenvolvedores -->
                <div style="background: rgba(76, 175, 80, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #4caf50;">
                    <h4 style="color: #4caf50; margin-bottom: 15px;">üë• Equipe de Desenvolvimento</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüíª</div>
                            <strong>Antonio Antunes Junior</strong>
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüíª</div>
                            <strong>Fl√°vio Rabelo Barros</strong>
                        </div>
                        
                                            
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüíª</div>
                            <strong>Giovani Machado de Lima</strong>
                        </div>


                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüíª</div>
                            <strong>Mariane Mendes Coutinho</strong>
                        </div>

                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë©‚Äçüíª</div>
                            <strong>Priscilla Santiago Zamorra</strong>
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüíª</div>
                            <strong>Rodrigo Aires de Medeiros Correa</strong>
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüè´</div>
                            <strong>Sergio Eric Reis de Oliveira</strong>
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüíª</div>
                            <strong>Vitor Correa Uberti</strong>
                        </div>
                    </div>
                    <p style="margin-top: 15px; font-size: 14px; color: #bbdefb;">Projeto Integrador IV - Licenciatura em Matem√°tica - UNIVESP - 2026</p>
                </div>
                
                <!-- Se√ß√£o: Como Jogar -->
                <div style="background: rgba(255, 152, 0, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #ff9800;">
                    <h4 style="color: #ff9800; margin-bottom: 15px;">üéÆ Como Jogar</h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                        <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 40px; margin-bottom: 15px;">1Ô∏è‚É£</div>
                            <h5 style="color: #ffeb3b;">Escolha o Tema</h5>
                            <p style="font-size: 14px;">Selecione entre <strong>Probabilidade</strong> ou <strong>Estat√≠stica</strong>. Cada tema tem 20 quest√µes.</p>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 40px; margin-bottom: 15px;">2Ô∏è‚É£</div>
                            <h5 style="color: #ffeb3b;">Responda as Quest√µes</h5>
                            <p style="font-size: 14px;">Voc√™ tem <strong>60 segundos</strong> por quest√£o. Selecione a alternativa correta.</p>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 40px; margin-bottom: 15px;">3Ô∏è‚É£</div>
                            <h5 style="color: #ffeb3b;">Use Power-ups</h5>
                            <p style="font-size: 14px;">Utilize dicas, pule quest√µes, ganhe tempo extra ou ative pontos em dobro!</p>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 40px; margin-bottom: 15px;">4Ô∏è‚É£</div>
                            <h5 style="color: #ffeb3b;">Acompanhe Seu Progresso</h5>
                            <p style="font-size: 14px;">Ganhe XP, suba de n√≠vel e desbloqueie conquistas!</p>
                        </div>
                    </div>
                </div>
                
                <!-- Se√ß√£o: Sistema de Pontua√ß√£o -->
                <div style="background: rgba(156, 39, 176, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #9c27b0;">
                    <h4 style="color: #9c27b0; margin-bottom: 15px;">üèÖ Sistema de Pontua√ß√£o</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 30px; color: #4caf50;">10</div>
                            <p style="font-size: 14px;"><strong>Quest√µes F√°ceis</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px; color: #ff9800;">15</div>
                            <p style="font-size: 14px;"><strong>Quest√µes M√©dias</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px; color: #f44336;">20</div>
                            <p style="font-size: 14px;"><strong>Quest√µes Dif√≠ceis</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px; color: #ffeb3b;">+5</div>
                            <p style="font-size: 14px;"><strong>B√¥nus por Velocidade</strong><br>(resposta em <10s)</p>
                        </div>
                    </div>
                    <p style="margin-top: 15px; font-size: 14px;"><strong>Streak Bonus:</strong> A cada 3 acertos consecutivos, ganhe +5 pontos adicionais!</p>
                </div>
                
                <!-- Se√ß√£o: Recursos Dispon√≠veis -->
                <div style="background: rgba(0, 150, 136, 0.1); padding: 20px; border-radius: 10px; border-left: 5px solid #009688;">
                    <h4 style="color: #009688; margin-bottom: 15px;">üõ†Ô∏è Recursos Dispon√≠veis</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üßÆ</div>
                            <p><strong>Calculadora</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üìö</div>
                            <p><strong>Revis√£o Te√≥rica</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üí°</div>
                            <p><strong>Dicas</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üèÜ</div>
                            <p><strong>Conquistas</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üìä</div>
                            <p><strong>Estat√≠sticas</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üéÜ</div>
                            <p><strong>Efeitos Visuais</strong></p>
                        </div>
                    </div>
                </div>
                
                <!-- Se√ß√£o: Dicas Importantes -->
                <div style="background: rgba(244, 67, 54, 0.1); padding: 20px; border-radius: 10px; margin-top: 25px; border-left: 5px solid #f44336;">
                    <h4 style="color: #f44336; margin-bottom: 15px;">üí° Dicas Importantes</h4>
                    <ul style="margin-left: 20px;">
                        <li>Use a <strong>calculadora</strong> para ajudar nos c√°lculos complexos</li>
                        <li>Consulte a <strong>revis√£o te√≥rica</strong> se tiver d√∫vidas sobre os conceitos</li>
                        <li>Administre bem seus <strong>power-ups</strong> - use-os estrategicamente</li>
                        <li>Pratique ambos os temas para dominar Probabilidade e Estat√≠stica</li>
                        <li>Preste aten√ß√£o ao <strong>tempo</strong> - cada quest√£o tem 60 segundos</li>
                        <li>Quanto mais r√°pido responder corretamente, mais pontos ganha!</li>
                    </ul>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeTutorialModal()" style="width: 100%; background: linear-gradient(90deg, #2196f3, #1976d2);">Fechar Tutorial</button>
        </div>
    </div>
</div>

    <!-- √Åudio para efeitos sonoros - URLs alternativas -->
    <audio id="correct-sound" preload="auto">
        <source src="https://actions.google.com/sounds/v1/foley/firecrackers_exploding.ogg" type="audio/ogg">

        <!-- <source src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_12b0c7443c.mp3" type="audio/mpeg">   -->  
    </audio>
    
    <audio id="incorrect-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="level-up-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="achievement-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-trumpet-2018.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="powerup-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-magic-sparkles-300.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Som de fogos de artif√≠cio - URLs alternativas -->
    <audio id="firework-sound" preload="auto">
       <!--  <source src="https://assets.mixkit.co/sfx/preview/mixkit-fireworks-show-audio-3065.mp3" type="audio/mpeg"> -->
        <!-- <source src="https://cdn.pixabay.com/download/audio/2022/01/18/audio_82173f40f0.mp3" type="audio/mpeg"> -->

       <source src="https://cdn.pixabay.com/download/audio/2022/03/10/audio_5b6623642d.mp3"  type="audio/mpeg">
    </audio>

    <!-- Biblioteca Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>






    <script>
        // ================ DADOS DO JOGO ================
        const gameData = {
            theme: null,
            currentQuestion: 0,
            isQuestionAnswered: false,
            score: 0,
            correctAnswers: 0,
            totalQuestions: 20, // Fixo: 20 quest√µes
            questions: [],
            userAnswers: [],
            currentStreak: 0,
            maxStreak: 0,
            startTime: null,
            questionTimes: [],
            powerUps: {
                hint: { count: 3, used: 0 },
                skip: { count: 2, used: 0 },
                time: { count: 2, used: 0 },
                double: { count: 3, used: 0 }
            },
            xp: 0,
            level: 1,
            xpToNextLevel: 100,
            achievements: [],
            settings: {
                sound: true
            },
            timer: null,
            timeLeft: 60, // Fixo: 60 segundos
            doublePointsActive: false
        };

        // ================ DADOS DA CALCULADORA ================
        let calcData = {
            display: '0',
            expression: '0',
            firstNum: null,
            operator: null,
            waitingForSecond: false
        };

        // ================ CONQUISTAS ================
        const achievements = [
            { id: 'first_game', name: 'Primeiro Jogo', description: 'Complete seu primeiro jogo', icon: 'üéÆ', unlocked: false, xp: 50 },
            { id: 'perfect_score', name: 'Perfei√ß√£o', description: 'Acertar 100% das quest√µes', icon: 'üíØ', unlocked: false, xp: 100 },
            { id: 'speed_demon', name: 'Dem√¥nio da Velocidade', description: 'Responder todas em menos de 30s cada', icon: '‚ö°', unlocked: false, xp: 75 },
            { id: 'streak_master', name: 'Mestre da Sequ√™ncia', description: 'Alcan√ßar streak de 10 acertos', icon: 'üî•', unlocked: false, xp: 80 },
            { id: 'power_user', name: 'Usu√°rio de Power-ups', description: 'Usar todos os power-ups em um jogo', icon: '‚ú®', unlocked: false, xp: 60 },
            { id: 'calculator_pro', name: 'Profissional da Calculadora', description: 'Usar calculadora 10 vezes', icon: 'üßÆ', unlocked: false, xp: 40 },
            { id: 'theme_master', name: 'Mestre dos Temas', description: 'Completar todos os temas', icon: 'üëë', unlocked: false, xp: 150 },
            { id: 'level_10', name: 'N√≠vel 10', description: 'Alcan√ßar o n√≠vel 10', icon: 'üåü', unlocked: false, xp: 200 },
            { id: 'hint_saver', name: 'Economizador de Dicas', description: 'Completar jogo sem usar dicas', icon: 'üí°', unlocked: false, xp: 70 },
            { id: 'persistent', name: 'Persistente', description: 'Jogar 5 vezes', icon: 'üí™', unlocked: false, xp: 90 }
        ];

// ================ BANCO DE QUEST√ïES (20 Probabilidade + 20 Estat√≠stica) ================
       
const questions = {
    probabilidade: [
        // --- N√≠vel B√°sico (Intui√ß√£o) ---
        {
            question: "Se voc√™ jogar uma moeda comum para o alto, qual a chance de cair 'Cara'?",
            options: ["100% (Certeza)", "25%", "50% (Metade)", "0% (Imposs√≠vel)"],
            correct: 2,
            hint: "A moeda s√≥ tem dois lados iguais: cara e coroa.",
            explanation: "Como s√£o apenas 2 possibilidades iguais, a chance √© 1 em 2, ou seja, metade (50%).",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Em um dado comum de 6 lados, qual a chance de sair o n√∫mero 7?",
            options: ["0% (Imposs√≠vel)", "100%", "50%", "10%"],
            correct: 0,
            hint: "Olhe para um dado comum. Qual √© o maior n√∫mero que aparece nele?",
            explanation: "O dado s√≥ vai at√© o n√∫mero 6. Sair o n√∫mero 7 √© imposs√≠vel, por isso a chance √© 0%.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Uma urna tem 10 bolas: 9 brancas e 1 vermelha. Se voc√™ pegar uma sem olhar, o que √© mais prov√°vel?",
            options: ["Pegar a vermelha", "As chances s√£o iguais", "Nenhuma das anteriores", "Pegar a branca"],
            correct: 3,
            hint: "Pense em qual cor tem em maior quantidade dentro da urna.",
            explanation: "Como h√° muito mais bolas brancas (9) do que vermelhas (1), a chance de pegar uma branca √© muito maior.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Qual a probabilidade de tirar um n√∫mero PAR ao jogar um dado?",
            options: ["\\(\\frac{1}{6}\\)", "\\(\\frac{1}{2}\\)", "\\(\\frac{1}{3}\\)", "\\(\\frac{5}{6}\\)"],
            correct: 1,
            hint: "Os n√∫meros pares no dado s√£o 2, 4 e 6. Isso representa metade dos n√∫meros.",
            explanation: "S√£o 3 n√∫meros pares (2, 4, 6) em um total de 6 n√∫meros. \\(\\frac{3}{6}\\) simplificando √© igual a \\(\\frac{1}{2}\\) (metade).",
            difficulty: "easy",
            points: 10
        },
        {
            question: "O sorteio de uma rifa tem 100 n√∫meros. Se voc√™ comprou 1 n√∫mero, qual sua chance de ganhar?",
            options: ["50 em 100", "1 em 10", "1 em 100", "100 em 1"],
            correct: 2,
            hint: "Voc√™ tem apenas um bilhete contra o total de bilhetes da rifa.",
            explanation: "Sua chance √© de 1 bilhete favor√°vel (o seu) dividido pelo total de 100 bilhetes: \\(\\frac{1}{100}\\).",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Se a previs√£o do tempo diz que h√° 100% de chance de chuva, isso significa que:",
            options: ["Com certeza vai chover", "Talvez chova", "√â imposs√≠vel chover", "Vai chover pouco"],
            correct: 0,
            hint: "100% representa o total, a certeza completa.",
            explanation: "Na probabilidade, 100% (ou 1) representa um 'evento certo', ou seja, temos certeza absoluta que vai acontecer.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Escolhendo ao acaso uma letra da palavra 'ESCOLA', qual a chance de ser a letra 'A'?",
            options: ["\\(\\frac{1}{5}\\)", "\\(\\frac{2}{6}\\)", "\\(\\frac{1}{2}\\)", "\\(\\frac{1}{6}\\)"],
            correct: 3,
            hint: "Conte quantas letras tem a palavra ESCOLA no total e quantas s√£o a letra 'A'.",
            explanation: "A palavra E-S-C-O-L-A tem 6 letras no total. Apenas uma delas √© 'A'. Logo, a chance √© \\(\\frac{1}{6}\\).",
            difficulty: "easy",
            points: 10
        },
        // --- N√≠vel M√©dio (C√°lculos Simples) ---
        {
            question: "Em uma caixa h√° 3 bolas Azuis e 2 Vermelhas. Qual a chance de pegar uma Azul?",
            options: ["\\(\\frac{3}{5}\\)", "\\(\\frac{2}{5}\\)", "\\(\\frac{1}{2}\\)", "\\(\\frac{3}{2}\\)"],
            correct: 0,
            hint: "Primeiro, some todas as bolas para saber o total na caixa.",
            explanation: "Total de bolas = 3 azuis + 2 vermelhas = 5. Como queremos as azuis (3), a chance √© \\(\\frac{3}{5}\\).",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Qual a probabilidade de escolher um dia da semana que comece com a letra 'S'?",
            options: ["\\(\\frac{1}{7}\\)", "\\(\\frac{3}{7}\\)", "\\(\\frac{2}{7}\\)", "\\(\\frac{5}{7}\\)"],
            correct: 1,
            hint: "Os dias s√£o: Domingo, Segunda, Ter√ßa, Quarta, Quinta, Sexta, S√°bado. Quantos come√ßam com S?",
            explanation: "Os dias com S s√£o: Segunda, Sexta e S√°bado (3 dias). O total de dias √© 7. Probabilidade = \\(\\frac{3}{7}\\).",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Se voc√™ jogar dois dados e somar os n√∫meros, qual soma √© IMPOSS√çVEL de acontecer?",
            options: ["12", "7", "2", "1"],
            correct: 3,
            hint: "O menor n√∫mero em cada dado √© 1. Qual a menor soma poss√≠vel?",
            explanation: "O m√≠nimo que se pode tirar √© 1 em cada dado, somando 1+1=2. Portanto, obter soma 1 √© imposs√≠vel.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Uma prova tem 4 quest√µes de m√∫ltipla escolha (A, B, C, D). Se chutar uma, qual a chance de acertar?",
            options: ["50%", "10%", "25%", "75%"],
            correct: 2,
            hint: "Existe apenas uma op√ß√£o correta entre as quatro poss√≠veis.",
            explanation: "1 chance em 4 √© igual a \\(\\frac{1}{4}\\). Em porcentagem: 100% dividido por 4 √© igual a 25%.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Em um baralho comum, qual naipe tem mais cartas?",
            options: ["Copas", "Todos t√™m a mesma quantidade", "Espadas", "Ouros"],
            correct: 1,
            hint: "Um baralho padr√£o √© dividido igualmente entre os s√≠mbolos.",
            explanation: "Um baralho √© dividido igualmente em 4 naipes. A probabilidade de tirar qualquer naipe √© a mesma.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Se a chance de chover √© 30%, qual √© a chance de N√ÉO chover?",
            options: ["70%", "30%", "50%", "100%"],
            correct: 0,
            hint: "A soma das chances de acontecer (chuva) e n√£o acontecer (sol) deve ser 100%.",
            explanation: "O total √© 100%. Se tirarmos os 30% de chuva, sobra 70% para n√£o chover (100 - 30 = 70).",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Lan√ßando uma moeda 2 vezes, qual a chance de sair 'Cara' nas duas vezes?",
            options: ["\\(\\frac{1}{2}\\)", "\\(\\frac{1}{3}\\)", "\\(\\frac{1}{8}\\)", "\\(\\frac{1}{4}\\)"],
            correct: 3,
            hint: "As op√ß√µes s√£o: Cara-Cara, Cara-Coroa, Coroa-Cara, Coroa-Coroa.",
            explanation: "H√° 4 combina√ß√µes poss√≠veis. Apenas uma serve (Cara-Cara). Logo, \\(\\frac{1}{4}\\).",
            difficulty: "medium",
            points: 15
        },
        // --- N√≠vel Dif√≠cil (Racioc√≠nio L√≥gico) ---
        {
            question: "Uma caixa tem 5 bolas: 1 Amarela, 1 Azul, 1 Verde, 1 Branca, 1 Preta. Qual a chance de N√ÉO pegar a preta?",
            options: ["\\(\\frac{1}{5}\\)", "\\(\\frac{1}{2}\\)", "\\(\\frac{4}{5}\\)", "\\(\\frac{3}{5}\\)"],
            correct: 2,
            hint: "Quantas bolas sobram se excluirmos a bola preta?",
            explanation: "Existem 4 bolas que n√£o s√£o pretas num total de 5. Probabilidade = \\(\\frac{4}{5}\\).",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Se eu tenho 3 camisas e 2 cal√ßas, de quantas formas diferentes posso me vestir?",
            options: ["6", "5", "3", "2"],
            correct: 0,
            hint: "Para cada uma das 3 camisas, voc√™ pode usar 2 cal√ßas diferentes. Tente multiplicar.",
            explanation: "Pelo princ√≠pio multiplicativo: 3 camisas √ó 2 cal√ßas = 6 combina√ß√µes diferentes de roupa.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Em um jogo, voc√™ ganha se tirar um n√∫mero maior que 4 no dado. Qual sua chance?",
            options: ["\\(\\frac{1}{6}\\)", "\\(\\frac{2}{6}\\)", "\\(\\frac{1}{2}\\)", "\\(\\frac{4}{6}\\)"],
            correct: 1,
            hint: "Quais n√∫meros no dado s√£o maiores que 4?",
            explanation: "Os n√∫meros maiores que 4 s√£o o 5 e o 6. S√£o 2 n√∫meros favor√°veis em 6 poss√≠veis (\\(\\frac{2}{6}\\) ou \\(\\frac{1}{3}\\)).",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Qual a chance de tirar um n√∫mero PRIMO em um dado (2, 3, 5)?",
            options: ["20%", "30%", "50%", "60%"],
            correct: 2,
            hint: "Conte quantos n√∫meros primos existem at√© 6 (o 2, o 3 e o 5).",
            explanation: "Os primos no dado s√£o 2, 3 e 5. S√£o 3 n√∫meros em 6 totais. \\(\\frac{3}{6}\\) √© igual a metade, ou 50%.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Se voc√™ retirar uma carta de um baralho de 52 cartas, √© mais prov√°vel sair:",
            options: ["Um Rei", "Um √Ås vermelho", "O 7 de Ouros", "Uma carta de Copas"],
            correct: 3,
            hint: "Pense na quantidade de cada tipo. Existem 4 Reis, 2 √Åses vermelhos, 1 sete de ouros e 13 cartas de Copas.",
            explanation: "Existem 13 cartas de Copas, o que √© maior quantidade que Reis (4), √Åses vermelhos (2) ou 7 de Ouros (1).",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Em um sorteio entre 10 meninos e 15 meninas, qual a chance de o vencedor ser menino?",
            options: ["\\(\\frac{10}{25}\\)", "\\(\\frac{10}{15}\\)", "\\(\\frac{15}{25}\\)", "\\(\\frac{1}{2}\\)"],
            correct: 0,
            hint: "Lembre-se de somar meninos e meninas para achar o total de alunos.",
            explanation: "Total de alunos = 10 + 15 = 25. Meninos = 10. Probabilidade = \\(\\frac{10}{25}\\) (meninos sobre o total).",
            difficulty: "hard",
            points: 20
        }
    ],
    estatistica: [
        // --- N√≠vel B√°sico (Leitura e Conceitos) ---
        {
            question: "O que √© uma 'Pesquisa Censit√°ria' (Censo)?",
            options: ["Entrevistar algumas pessoas", "Adivinhar os dados", "Entrevistar TODA a popula√ß√£o", "Fazer um sorteio"],
            correct: 2,
            hint: "Lembre-se do Censo do IBGE, que tenta contar todos os brasileiros.",
            explanation: "Censo √© quando coletamos dados de 100% dos indiv√≠duos de um grupo ou popula√ß√£o, sem deixar ningu√©m de fora.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Para descobrir qual o sabor de sorvete favorito da turma, qual a melhor pergunta?",
            options: ["Qual seu sabor favorito?", "Voc√™ gosta de sorvete?", "Voc√™ gosta de chocolate?", "Quanto custa o sorvete?"],
            correct: 0,
            hint: "A pergunta deve permitir v√°rias respostas diferentes sobre sabores.",
            explanation: "Perguntar 'Qual seu sabor favorito?' permite coletar os dados variados (morango, chocolate, creme...) para fazer a estat√≠stica.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Em um gr√°fico de barras, o que a altura da barra geralmente representa?",
            options: ["A beleza do gr√°fico", "A largura dos dados", "A cor dos dados", "A quantidade ou frequ√™ncia"],
            correct: 3,
            hint: "Quanto mais alta a barra, mais gente escolheu aquela op√ß√£o.",
            explanation: "A altura (ou comprimento) da barra indica a frequ√™ncia ou quantidade daquela categoria (quantos votos ela teve).",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Se 5 alunos tiraram nota 10, dizemos que a FREQU√äNCIA da nota 10 √©:",
            options: ["10", "5", "50", "1"],
            correct: 1,
            hint: "Frequ√™ncia √© a quantidade de vezes que algo aconteceu.",
            explanation: "Frequ√™ncia absoluta √© o n√∫mero de vezes que o dado aparece. Se 5 alunos tiraram 10, a frequ√™ncia √© 5.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Qual gr√°fico usa 'fatias' para representar as partes de um todo?",
            options: ["Gr√°fico de Pizza (Setores)", "Gr√°fico de Linhas", "Gr√°fico de Barras", "Histograma"],
            correct: 0,
            hint: "Tem o formato de uma comida redonda dividida.",
            explanation: "O gr√°fico de setores √© popularmente conhecido como gr√°fico de pizza porque suas fatias representam partes do total.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Jo√£o tirou notas 5, 5 e 5. Qual √© a m√©dia dele?",
            options: ["15", "3", "5", "10"],
            correct: 2,
            hint: "Se todas as notas s√£o iguais, a m√©dia √© esse mesmo valor.",
            explanation: "A m√©dia de valores iguais √© o pr√≥prio valor. (5+5+5) dividido por 3 √© igual a 5.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "O que √© 'Amostra' em uma pesquisa?",
            options: ["Toda a popula√ß√£o", "O resultado final", "O gr√°fico", "Uma parte pequena escolhida para representar o todo"],
            correct: 3,
            hint: "√â como quando voc√™ prova um pedacinho do bolo para ver se est√° bom, sem comer o bolo inteiro.",
            explanation: "Amostra √© um pequeno grupo selecionado da popula√ß√£o para a pesquisa, pois muitas vezes √© imposs√≠vel perguntar a todos.",
            difficulty: "easy",
            points: 10
        },
        // --- N√≠vel M√©dio (Moda, M√©dia, Mediana) ---
        {
            question: "Observe os n√∫meros: 2, 5, 8, 5, 9. Qual √© a MODA?",
            options: ["5", "2", "8", "9"],
            correct: 0,
            hint: "Moda √© o que est√° 'na moda', ou seja, o que aparece mais vezes.",
            explanation: "O n√∫mero 5 aparece duas vezes, os outros apenas uma. Logo, 5 √© a moda.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Qual a M√©dia de idade entre dois irm√£os de 10 e 12 anos?",
            options: ["10", "12", "22", "11"],
            correct: 3,
            hint: "Qual n√∫mero est√° exatamente no meio de 10 e 12?",
            explanation: "Soma-se as idades (10+12=22) e divide pela quantidade de pessoas (2). A m√©dia √© 11.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Em uma corrida, os tempos foram: 10s, 12s, 15s. O tempo M√âDIO foi:",
            options: ["12s", "13s", "12,3s", "37s"],
            correct: 2,
            hint: "Some 10+12+15 e divida o resultado por 3.",
            explanation: "10+12+15 = 37. Dividindo 37 por 3, obtemos aproximadamente 12,33 segundos.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Para saber qual a fruta preferida da turma para o lanche, que medida usamos?",
            options: ["M√©dia", "Moda", "Mediana", "Amplitude"],
            correct: 1,
            hint: "Queremos saber a fruta que teve MAIS votos.",
            explanation: "A Moda indica o valor mais frequente (o vencedor). N√£o d√° para calcular a 'M√©dia' de ma√ß√£s e bananas.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Qual a Mediana dos n√∫meros: 1, 3, 5, 7, 9?",
            options: ["5", "1", "9", "7"],
            correct: 0,
            hint: "Coloque em ordem (j√° est√£o) e pegue o n√∫mero que est√° bem no meio.",
            explanation: "Os n√∫meros j√° est√£o ordenados. O termo central √© o 5.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "A Amplitude dos dados 10, 20, 50 √©:",
            options: ["50", "10", "40", "30"],
            correct: 2,
            hint: "√â a diferen√ßa (dist√¢ncia) entre o maior valor e o menor valor.",
            explanation: "Amplitude = Maior valor (50) menos o Menor valor (10). 50 - 10 = 40.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Qual gr√°fico √© melhor para mostrar se a temperatura subiu ou desceu durante a semana?",
            options: ["Gr√°fico de Pizza", "Tabela", "Pictograma", "Gr√°fico de Linha"],
            correct: 3,
            hint: "As linhas conectam pontos e mostram a evolu√ß√£o ou mudan√ßa.",
            explanation: "Gr√°ficos de linha s√£o ideais para mostrar evolu√ß√£o ou varia√ß√£o ao longo do tempo (como temperatura, crescimento, etc).",
            difficulty: "medium",
            points: 15
        },
        // --- N√≠vel Dif√≠cil (Interpreta√ß√£o) ---
        {
            question: "Em uma lista ordenada: 2, 3, X, 8, 10. Se a mediana √© 6, qual o valor de X?",
            options: ["6", "5", "7", "4"],
            correct: 0,
            hint: "A mediana √© o n√∫mero do meio. Olhe para a posi√ß√£o do X.",
            explanation: "Como s√£o 5 n√∫meros, o X est√° exatamente na posi√ß√£o do meio. Para a mediana ser 6, o X deve valer 6.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Se a m√©dia de 4 provas foi 7,0. Qual a soma total das notas?",
            options: ["21", "30", "28", "14"],
            correct: 2,
            hint: "Se ele tivesse tirado 7 em todas as 4 provas, qual seria o total?",
            explanation: "Se a m√©dia √© 7 e foram 4 provas, fazemos 7 vezes 4 = 28 pontos no total.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Uma vari√°vel 'Qualitativa' representa:",
            options: ["N√∫meros e contas", "Qualidades ou categorias (ex: cor dos olhos)", "Apenas notas de prova", "A quantidade de alunos"],
            correct: 1,
            hint: "Qualitativa vem de 'Qualidade', n√£o de quantidade (n√∫meros).",
            explanation: "Vari√°veis qualitativas expressam caracter√≠sticas (cor, g√™nero, nome, escolaridade), e n√£o n√∫meros que podemos somar.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Se em um gr√°fico de pizza a parte do 'Futebol' ocupa metade do c√≠rculo, quantos % gostam de futebol?",
            options: ["25%", "75%", "100%", "50%"],
            correct: 3,
            hint: "O c√≠rculo inteiro vale 100%. Quanto vale a metade?",
            explanation: "Metade do c√≠rculo corresponde a metade do total, ou seja, 50%.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Em estat√≠stica, o que significa organizar os dados em 'Rol'?",
            options: ["Misturar os dados", "Colocar em ordem crescente ou decrescente", "Apagar os dados", "Somar os dados"],
            correct: 1,
            hint: "√â o primeiro passo importante antes de achar a mediana.",
            explanation: "Rol √© a organiza√ß√£o dos dados brutos em uma ordem (geralmente do menor para o maior) para facilitar a an√°lise.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Se a moda de um conjunto √© 7, isso significa que:",
            options: ["A m√©dia √© 7", "O maior n√∫mero √© 7", "O n√∫mero 7 √© o que mais se repete", "A mediana √© 7"],
            correct: 2,
            hint: "Lembre-se da defini√ß√£o de Moda (o mais popular).",
            explanation: "A Moda √© o valor com maior frequ√™ncia absoluta, ou seja, o que mais aparece na lista.",
            difficulty: "hard",
            points: 20
        }
    ]
};


// ================ INICIALIZA√á√ÉO ================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM carregado, inicializando...");
            
            // Carregar dados salvos
            loadGameData();
            
            // Configurar sele√ß√£o de temas
            document.querySelectorAll('.theme-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.theme-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    gameData.theme = card.dataset.theme;
                    updateThemeDisplay();
                    console.log("Tema selecionado:", gameData.theme);
                });
            });
            
            // Configurar bot√µes
            document.getElementById('start-btn').addEventListener('click', startGame);
            document.getElementById('restart-btn').addEventListener('click', restartGame);
            document.getElementById('change-theme-btn').addEventListener('click', () => {
                showScreen('start-screen');
            });
            
            // Configurar conquistas
            document.getElementById('achievement-btn').addEventListener('click', toggleAchievements);
            
            // Configurar calculadora
            initCalculator();
            
            // Configurar controle de som
            document.getElementById('sound-toggle').addEventListener('change', (e) => {
                const isEnabled = e.target.value === 'true';
                
                // Atualiza o gameData
                gameData.settings.sound = isEnabled;
                
                // Atualiza o localStorage
                localStorage.setItem('soundEnabled', isEnabled.toString());
                
                // Feedback
                if (isEnabled) {
                    audioEnabled = true; 
                    playSound('powerup');
                }
                
                saveGameData();
            }); // <--- O C√ìDIGO DO SOM TERMINA AQUI

            // ============================================================
            // C√ìDIGO DO RESET AGORA EST√Å FORA DO SOM (LUGAR CORRETO)
            // ============================================================
            const resetBtn = document.getElementById('reset-progress-btn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    // Tocar um som de alerta
                    if (typeof playSound === "function") playSound('incorrect');

                    // Pergunta de seguran√ßa
                    const confirmReset = confirm(
                        "‚ö†Ô∏è PERIGO: ATEN√á√ÉO! ‚ö†Ô∏è\n\n" +
                        "Voc√™ est√° prestes a APAGAR TODO O SEU PROGRESSO.\n" +
                        "Isto inclui:\n" +
                        "- O seu N√≠vel e XP\n" +
                        "- Todas as Conquistas/Trof√©us\n" +
                        "- Estat√≠sticas de acertos\n\n" +
                        "Tem a certeza absoluta que quer come√ßar do zero?"
                    );
                    
                    if (confirmReset) {
                        // 1. Apagar chaves espec√≠ficas do localStorage
                        localStorage.removeItem('mathGameData');   // Dados do jogo
                        localStorage.removeItem('themeProgress');  // Progresso dos temas
                        localStorage.removeItem('gamesPlayed');    // Contador de jogos
                        
                        // 2. Feedback visual
                        alert("üóëÔ∏è Mem√≥ria limpa com sucesso!\nO jogo ser√° reiniciado agora.");
                        
                        // 3. Recarregar a p√°gina
                        window.location.reload();
                    }
                });
            }
            // ============================================================
            
            // Configurar bot√£o de download de estat√≠sticas
            document.getElementById('download-stats-btn')?.addEventListener('click', downloadStatistics);
            
            // Selecionar tema padr√£o
            document.querySelector('[data-theme="probabilidade"]').click();
            
            console.log("üéÆ Jogo inicializado com sucesso!");
            
            // Inicializar √°udios
            initAudio();

            // Fechar modal com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && document.getElementById('achievements-modal').classList.contains('active')) {
                    closeAchievements();
                }
            });

// --- C√ìDIGO QUE FALTA PARA A REVIS√ÉO TE√ìRICA ---

    // 1. Configurar o bot√£o principal "Revis√£o Te√≥rica"
    const theoryBtn = document.getElementById('theory-btn');
    if (theoryBtn) {
        theoryBtn.addEventListener('click', openTheoryModal);
    }

    // 2. Configurar os bot√µes de escolha (Probabilidade vs Estat√≠stica) dentro do modal
    document.querySelectorAll('.theme-choice-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const theoryType = btn.dataset.theory; // Pega 'probabilidade' ou 'estatistica'
            closeTheoryModal(); // Fecha o menu de escolha
            openTheoryContentModal(theoryType); // Abre o conte√∫do
        });
    });
            
        });
    
        

// ================ FUN√á√ïES DO MODAL DE TUTORIAL ================

function openTutorialModal() {
    const modal = document.getElementById('tutorial-modal');
    if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
}

function closeTutorialModal() {
    const modal = document.getElementById('tutorial-modal');
    if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
    }
}

// Fechar modal com ESC
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        if (document.getElementById('tutorial-modal').classList.contains('active')) {
            closeTutorialModal();
        }
    }
});





        function switchTheoryContent(targetTheme) {
    // Fecha o modal atual
    if (document.getElementById('probabilidade-modal').classList.contains('active')) {
        closeTheoryContentModal('probabilidade');
    } else if (document.getElementById('estatistica-modal').classList.contains('active')) {
        closeTheoryContentModal('estatistica');
    }
    
    // Abre o novo modal
    setTimeout(() => {
        openTheoryContentModal(targetTheme);
    }, 300);
}

function createPerformanceChart() {
            // === IN√çCIO DA CORRE√á√ÉO ===
            // Verifica se j√° existe um gr√°fico no canvas e o destr√≥i antes de criar um novo
            const existingChart = Chart.getChart("performance-chart");
            if (existingChart) {
                existingChart.destroy();
            }
            // === FIM DA CORRE√á√ÉO ===

            const ctx = document.getElementById('performance-chart').getContext('2d');
            
            // Dados para o gr√°fico
            const questionNumbers = Array.from({length: gameData.userAnswers.length}, (_, i) => i + 1);
            const correctness = gameData.userAnswers.map(a => a.isCorrect ? 1 : 0);
            const responseTimes = gameData.userAnswers.map(a => a.time);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: questionNumbers,
                    datasets: [
                        {
                            label: 'Acertos (1=sim, 0=n√£o)',
                            data: correctness,
                            borderColor: '#4caf50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.3,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Tempo de resposta (s)',
                            data: responseTimes,
                            borderColor: '#2196f3',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.3,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#bbdefb'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        }
                    }
                }
            });
        }




        // ================ FUN√á√ÉO DE DOWNLOAD DE ESTAT√çSTICAS ================
        function downloadStatistics() {
            // Coletar dados da partida
            const accuracy = (gameData.correctAnswers / gameData.totalQuestions) * 100;
            const avgTime = gameData.questionTimes.length > 0 ? 
                (gameData.questionTimes.reduce((a, b) => a + b) / gameData.questionTimes.length).toFixed(1) : 0;
            
            // Formatar data e hora
            const now = new Date();
            const dateStr = now.toLocaleDateString('pt-BR');
            const timeStr = now.toLocaleTimeString('pt-BR');
            
            // Criar conte√∫do do arquivo
            const statsContent = `
==========================================
ESTAT√çSTICAS DA PARTIDA - LIAM - Laborat√≥rio Interativo de Alfabetiza√ß√£o Matem√°tica
==========================================

üìÖ Data: ${dateStr}
‚è∞ Hora: ${timeStr}

üéÆ INFORMA√á√ïES DA PARTIDA
========================
‚Ä¢ Tema: ${gameData.theme === 'probabilidade' ? 'Probabilidade' : 'Estat√≠stica'}
‚Ä¢ N√∫mero de quest√µes: ${gameData.totalQuestions}
‚Ä¢ Tempo por quest√£o: 60 segundos

üìä RESULTADOS
=============
‚Ä¢ Pontua√ß√£o total: ${gameData.score} pontos
‚Ä¢ Acertos: ${gameData.correctAnswers}/${gameData.totalQuestions}
‚Ä¢ Precis√£o: ${accuracy.toFixed(1)}%
‚Ä¢ Streak m√°xima: ${gameData.maxStreak} acertos consecutivos
‚Ä¢ Tempo m√©dio por quest√£o: ${avgTime}s

‚ö° DESEMPENHO
=============
‚Ä¢ N√≠vel atual: ${gameData.level}
‚Ä¢ XP ganho na partida: ${gameData.score} XP
‚Ä¢ Total de XP: ${gameData.xp}/${gameData.xpToNextLevel}

‚ú® POWER-UPS UTILIZADOS
=======================
‚Ä¢ Dicas usadas: ${gameData.powerUps.hint.used}
‚Ä¢ Quest√µes puladas: ${gameData.powerUps.skip.used}
‚Ä¢ Tempo extra usado: ${gameData.powerUps.time.used}
‚Ä¢ Pontos em dobro ativados: ${gameData.powerUps.double.used}

üèÜ DETALHES DAS QUEST√ïES
========================
${gameData.userAnswers.map((answer, index) => {
    const q = gameData.questions[index];
    let status = answer.isCorrect ? '‚úÖ CORRETO' : '‚ùå ERRADO';
    if (answer.skipped) status = '‚è≠Ô∏è PULADA';
    if (answer.timeout) status = '‚è∞ TEMPO ESGOTADO';
    
    return `Quest√£o ${index + 1}: ${status}
   Pergunta: ${answer.question}
   ${answer.isCorrect ? 
        `Pontos: ${answer.points} | Tempo: ${answer.time.toFixed(1)}s` : 
        `Resposta correta: ${q.options[answer.correctAnswer]}`
   }
   ----------------------------------------`;
}).join('\n')}

üìà RECOMENDA√á√ïES
================
${accuracy >= 90 ? 
    'Excelente desempenho! Continue assim!' :
accuracy >= 70 ?
    'Bom trabalho! Pratique um pouco mais para alcan√ßar a perfei√ß√£o.' :
accuracy >= 50 ?
    'Resultado razo√°vel. Recomendamos revisar os conceitos b√°sicos.' :
    'H√° espa√ßo para melhoria. Sugerimos estudar os conte√∫dos novamente.'}

==========================================
Jogo desenvolvido para o 9¬∫ Ano do Ensino Fundamental
==========================================
    `.trim();

            // Criar arquivo para download
            const blob = new Blob([statsContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `estatisticas-matematica-${dateStr.replace(/\//g, '-')}-${timeStr.replace(/:/g, '-')}.txt`;
            
            // Adicionar ao documento, clicar e remover
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // Liberar o objeto URL
            URL.revokeObjectURL(url);
            
            // Feedback visual
            const originalText = document.getElementById('download-stats-btn').innerHTML;
            document.getElementById('download-stats-btn').innerHTML = '‚úÖ Baixado!';
            document.getElementById('download-stats-btn').disabled = true;
            
            setTimeout(() => {
                document.getElementById('download-stats-btn').innerHTML = originalText;
                document.getElementById('download-stats-btn').disabled = false;
            }, 2000);
        }

        // ================ CALCULADORA - C√ìDIGO SIMPLIFICADO E FUNCIONAL ================
        function initCalculator() {
    console.log("Inicializando calculadora...");
    
    // Elementos da calculadora
    const calculator = document.getElementById('calculator');
    const openCalcBtns = document.querySelectorAll('.open-calc-btn'); // Seleciona TODOS os bot√µes
    const closeCalcBtn = document.getElementById('close-calc');
    const minimizeCalcBtn = document.getElementById('minimize-calc');
    
    if (!calculator || openCalcBtns.length === 0) {
        console.error("Elementos da calculadora n√£o encontrados!");
        return;
    }
    
    // Abrir calculadora - para TODOS os bot√µes
    openCalcBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            console.log("Abrindo calculadora...");
            calculator.classList.add('active');
        });
    });
    
    // Fechar calculadora
    closeCalcBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        calculator.classList.remove('active');
    });
    
    // Minimizar calculadora
    let minimized = false;
    minimizeCalcBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        const buttons = calculator.querySelector('.calc-buttons');
        const display = calculator.querySelector('.calc-display');
        
        if (!minimized) {
            buttons.style.display = 'none';
            display.style.display = 'none';
            calculator.style.height = '60px';
            minimized = true;
        } else {
            buttons.style.display = 'grid';
            display.style.display = 'block';
            calculator.style.height = 'auto';
            minimized = false;
        }
    });
    
    console.log("Calculadora inicializada com m√∫ltiplos bot√µes!");
}

        // Fun√ß√µes da calculadora
        function calcNumber(num) {
            if (calcData.waitingForSecond) {
                calcData.display = num.toString();
                calcData.waitingForSecond = false;
            } else {
                calcData.display = calcData.display === '0' ? num.toString() : calcData.display + num;
            }
            calcData.expression = calcData.display;
            updateCalcDisplay();
        }

        function calcOperator(op) {
            if (calcData.firstNum === null) {
                calcData.firstNum = parseFloat(calcData.display);
            } else if (calcData.operator && !calcData.waitingForSecond) {
                calcData.firstNum = calcCalculate();
                calcData.display = calcData.firstNum.toString();
            }
            calcData.operator = op;
            calcData.waitingForSecond = true;
            calcData.expression = `${calcData.firstNum} ${getOperatorSymbol(op)}`;
            updateCalcDisplay();
        }

        function calcEquals() {
            if (calcData.operator && calcData.firstNum !== null) {
                const result = calcCalculate();
                calcData.display = result.toString();
                calcData.expression = `${calcData.firstNum} ${getOperatorSymbol(calcData.operator)} ${calcData.display} =`;
                calcData.firstNum = null;
                calcData.operator = null;
                calcData.waitingForSecond = true;
                updateCalcDisplay();
            }
        }

        function calcClear() {
            calcData.display = '0';
            calcData.expression = '0';
            calcData.firstNum = null;
            calcData.operator = null;
            calcData.waitingForSecond = false;
            updateCalcDisplay();
        }

        function calcClearEntry() {
            calcData.display = '0';
            calcData.expression = '0';
            updateCalcDisplay();
        }

        function calcBackspace() {
            if (calcData.display.length > 1) {
                calcData.display = calcData.display.slice(0, -1);
            } else {
                calcData.display = '0';
            }
            calcData.expression = calcData.display;
            updateCalcDisplay();
        }

        function calcDecimal() {
            if (!calcData.display.includes('.')) {
                calcData.display += '.';
                calcData.expression = calcData.display;
                updateCalcDisplay();
            }
        }

        function calcSqrt() {
            calcData.display = Math.sqrt(parseFloat(calcData.display)).toString();
            calcData.expression = `‚àö(${calcData.display})`;
            updateCalcDisplay();
        }

        function calcPower() {
            calcData.display = Math.pow(parseFloat(calcData.display), 2).toString();
            calcData.expression = `(${calcData.display})¬≤`;
            updateCalcDisplay();
        }

        function calcPercent() {
            calcData.display = (parseFloat(calcData.display) / 100).toString();
            calcData.expression = `${calcData.display}%`;
            updateCalcDisplay();
        }

        function calcPi() {
            calcData.display = Math.PI.toString();
            calcData.expression = 'œÄ';
            updateCalcDisplay();
        }

        function calcPlusMinus() {
            calcData.display = (-parseFloat(calcData.display)).toString();
            calcData.expression = calcData.display;
            updateCalcDisplay();
        }

        function calcCalculate() {
            const a = calcData.firstNum;
            const b = parseFloat(calcData.display);
            
            switch(calcData.operator) {
                case '+': return a + b;
                case '-': return a - b;
                case '*': return a * b;
                case '/': return a / b;
                default: return b;
            }
        }

        function getOperatorSymbol(op) {
            switch(op) {
                case '+': return '+';
                case '-': return '‚àí';
                case '*': return '√ó';
                case '/': return '√∑';
                default: return op;
            }
        }

        function updateCalcDisplay() {
            const calcExpression = document.getElementById('calc-expression');
            const calcResult = document.getElementById('calc-result');
            
            if (calcExpression) calcExpression.textContent = calcData.expression;
            if (calcResult) calcResult.textContent = calcData.display;
        }

        // ================ FUN√á√ïES DO JOGO ================
        function startGame() {
            if (!gameData.theme) {
                alert('Escolha um tema primeiro!');
                return;
            }

            // Resetar dados do jogo
            resetGameData();
            
            // Configurar com base nas settings fixas
            gameData.totalQuestions = 20; // Fixo
            gameData.timeLeft = 60; // Fixo
            
            // Selecionar quest√µes
            selectQuestions();
            
            // Atualizar interface
            updateGameStatus();
            showQuestion();
            updatePowerUpDisplay();
            
            // Mostrar tela de quest√µes
            showScreen('question-screen');
            
            // Iniciar timer (sempre 60 segundos)
            document.getElementById('timer-container').style.display = 'block';
            startTimer();
            
            // Registrar in√≠cio do jogo
            gameData.startTime = Date.now();
            
            console.log("Jogo iniciado!");
        }

        function selectQuestions() {
            const allQuestions = questions[gameData.theme];
            
            // Embaralhar todas as quest√µes
            let shuffledQuestions = [...allQuestions].sort(() => Math.random() - 0.5);
            
            // Pegar as primeiras 20 quest√µes
            gameData.questions = shuffledQuestions.slice(0, 20);
            
            // Se n√£o houver quest√µes suficientes, repetir algumas
            if (gameData.questions.length < 20) {
                const needed = 20 - gameData.questions.length;
                const extraQuestions = shuffledQuestions.slice(0, needed);
                gameData.questions = gameData.questions.concat(extraQuestions);
            }
        }



// 1. Vari√°vel Global para armazenar a escolha tempor√°ria
let selectedOptionIndex = null;

// 2. Nova Fun√ß√£o para Confirmar a Resposta (O intermedi√°rio)
function confirmAnswer() {
    if (selectedOptionIndex === null) return; // Seguran√ßa

    // Chama a corre√ß√£o oficial
    checkAnswer(selectedOptionIndex);

    // Transforma o bot√£o em "Pr√≥xima Quest√£o"
    const actionBtn = document.getElementById('next-btn');
    actionBtn.textContent = "Pr√≥xima Quest√£o ‚ûî";
    actionBtn.onclick = nextQuestion; // Muda o evento do clique
}



// 3. Atualiza√ß√£o da fun√ß√£o showQuestion (Reseta o bot√£o)


function showQuestion() {
    const q = gameData.questions[gameData.currentQuestion];
    
    // === RESETAR ESTADO ===
    gameData.isQuestionAnswered = false;
    updatePowerUpDisplay();

    // === ACESSIBILIDADE: Anunciar nova quest√£o ===
    setTimeout(() => {
        announceToScreenReader(`Quest√£o ${gameData.currentQuestion + 1}. Dificuldade ${q.difficulty === 'easy' ? 'F√°cil' : q.difficulty === 'medium' ? 'M√©dio' : 'Dif√≠cil'}.`);
    }, 500);
    
    // === CONFIGURA√á√ÉO DO BOT√ÉO ===
    selectedOptionIndex = null; 
    const actionBtn = document.getElementById('next-btn');
    actionBtn.textContent = "Confirmar Resposta"; 
    actionBtn.onclick = confirmAnswer; 
    actionBtn.disabled = true; 

    // Atualizar n√∫mero e texto
    document.getElementById('question-number').textContent = gameData.currentQuestion + 1;
    document.getElementById('question-text').innerHTML = q.question;
    
    // Dificuldade
    const diffEl = document.getElementById('question-difficulty');
    diffEl.textContent = q.difficulty === 'easy' ? 'F√°cil' : 
                         q.difficulty === 'medium' ? 'M√©dio' : 'Dif√≠cil';
    diffEl.className = 'question-difficulty'; 
    diffEl.classList.add(`difficulty-${q.difficulty}`);
    
    // === GERA√á√ÉO DAS OP√á√ïES ===
    const optionsContainer = document.getElementById('options-container');
    optionsContainer.innerHTML = '';
    
    ['A', 'B', 'C', 'D'].forEach((letter, index) => {
        const option = document.createElement('button');
        option.className = 'option';
        
        // ARIA Label para acessibilidade
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = q.options[index];
        const cleanText = tempDiv.textContent || tempDiv.innerText || "";
        option.setAttribute('aria-label', `Op√ß√£o ${letter}: ${cleanText}`);
        
        option.innerHTML = `
            <div class="option-letter">${letter}</div>
            <div style="flex: 1; text-align: left;">${q.options[index]}</div>
        `;
        
        option.addEventListener('click', () => selectOption(option, index));
        optionsContainer.appendChild(option);
    });
    
    // Resetar feedback
    document.getElementById('correct-feedback').style.display = 'none';
    document.getElementById('incorrect-feedback').style.display = 'none';
    
    // Timer
    gameData.timeLeft = 60;
    updateTimerDisplay();
    gameData.questionStartTime = Date.now();
    
    // === MATHJAX - AGORA COM TIMEOUT PARA GARANTIR QUE O DOM EST√Å PRONTO ===
    setTimeout(() => {
        if (window.MathJax && window.MathJax.typesetPromise) {
            // Garante que tanto a pergunta quanto as op√ß√µes sejam processadas
            const elementsToTypeset = [
                document.getElementById('question-text'),
                document.getElementById('options-container')
            ];
            
            MathJax.typesetPromise(elementsToTypeset)
                .then(() => {
                    console.log('LaTeX renderizado com sucesso!');
                })
                .catch((err) => {
                    console.log('Erro MathJax:', err);
                    // Tentativa alternativa se a primeira falhar
                    setTimeout(() => {
                        if (window.MathJax && window.MathJax.typeset) {
                            MathJax.typeset(elementsToTypeset);
                        }
                    }, 500);
                });
        }
    }, 100); // 100ms √© suficiente para o DOM atualizar
}

function renderMathJaxWithRetry(attempt = 0) {
    if (window.MathJax && window.MathJax.typesetPromise) {
        const elementsToTypeset = [
            document.getElementById('question-text'),
            document.getElementById('options-container')
        ];
        
        MathJax.typesetPromise(elementsToTypeset)
            .then(() => {
                console.log('LaTeX renderizado com sucesso!');
            })
            .catch((err) => {
                console.log('Erro MathJax, tentativa:', attempt + 1, err);
                if (attempt < 3) {
                    setTimeout(() => renderMathJaxWithRetry(attempt + 1), 300 * (attempt + 1));
                }
            });
    } else if (attempt < 5) {
        // Se MathJax ainda n√£o carregou, tenta novamente
        setTimeout(() => renderMathJaxWithRetry(attempt + 1), 500);
    }
}

// Chama a primeira vez
setTimeout(() => renderMathJaxWithRetry(), 150);


function forceMathJaxRender(elementId) {
    const element = document.getElementById(elementId);
    if (!element) return;
    
    if (window.MathJax && window.MathJax.typesetPromise) {
        MathJax.typesetPromise([element]).catch(err => {
            console.log('Erro ao renderizar MathJax para', elementId, err);
        });
    }
}

// 4. Atualiza√ß√£o da fun√ß√£o selectOption (Apenas visual)
function selectOption(optionElement, index) {
    // Se o bot√£o j√° virou "Pr√≥xima Quest√£o", n√£o deixa mudar a resposta (j√° foi corrigido)
    const actionBtn = document.getElementById('next-btn');
    if (actionBtn.textContent.includes("Pr√≥xima")) return;

    // Remove sele√ß√£o visual das outras
    document.querySelectorAll('.option').forEach(o => {
        o.classList.remove('selected');
    });
    
    // Adiciona na atual
    optionElement.classList.add('selected');
    
    // Salva o √≠ndice na mem√≥ria
    selectedOptionIndex = index;
    
    // Libera o bot√£o para confirmar
    actionBtn.disabled = false;
    
    // Opcional: Feedback sonoro leve de "clique" (se tiver √°udio de UI)
    // playSound('click'); 
}

// 5. Atualiza√ß√£o da fun√ß√£o checkAnswer (Corre√ß√£o Final)
function checkAnswer(selectedIndex) {
            clearInterval(gameData.timer);

            // === BLOQUEAR POWER-UPS ===
            gameData.isQuestionAnswered = true; // Marca como respondida
            
            document.querySelectorAll('.power-up').forEach(btn => btn.disabled = true); // Desabilita visualmente todos
            updatePowerUpDisplay();
            // ==========================


            const q = gameData.questions[gameData.currentQuestion];
            const isCorrect = selectedIndex === q.correct;
            const options = document.querySelectorAll('.option');
            
            options.forEach(o => o.style.pointerEvents = 'none');

            const responseTime = (Date.now() - gameData.questionStartTime) / 1000;
            gameData.questionTimes.push(responseTime);
            
            options[q.correct].classList.add('correct');
            
            if (isCorrect) {
                options[selectedIndex].classList.add('correct');
                
                let points = q.points;
                let bonusText = [];
                
                gameData.currentStreak++;
                if (gameData.currentStreak > gameData.maxStreak) gameData.maxStreak = gameData.currentStreak;
                
                if (gameData.currentStreak >= 3) {
                    const streakBonus = Math.floor(gameData.currentStreak / 3) * 5;
                    points += streakBonus;
                    bonusText.push(`Streak +${streakBonus}`);
                    if (gameData.currentStreak >= 5) showStreakIndicator();
                }
                
                if (responseTime < 10) {
                    points += 5;
                    bonusText.push(`R√°pido +5`);
                }
                
                if (gameData.doublePointsActive) {
                    points *= 2;
                    bonusText.push(`‚ú® Dobro!`);
                    gameData.doublePointsActive = false; // RESETA DEPOIS DE USAR
                }
                
                gameData.score += points;
                gameData.correctAnswers++;
                addXP(points);
                
                document.getElementById('correct-feedback').style.display = 'block';
                document.getElementById('points-earned').textContent = points;
                document.getElementById('bonus-info').textContent = bonusText.length > 0 ? `B√¥nus: ${bonusText.join(', ')}` : '';
                
                // === ACESSIBILIDADE: Anunciar acerto ===
                announceToScreenReader(`Resposta Correta! Voc√™ ganhou ${points} pontos.`);
                
                if (typeof playSound === "function") playSound('correct');
                createFireworksEffect(); // Usa a nova fun√ß√£o de canvas
                checkAchievements();
                
            } else {
        options[selectedIndex].classList.add('incorrect');
        gameData.currentStreak = 0;
        
        document.getElementById('incorrect-feedback').style.display = 'block';
        document.getElementById('correct-answer').innerHTML = q.options[q.correct];
        document.getElementById('explanation').innerHTML = q.explanation;
        
        // === ACESSIBILIDADE: Anunciar erro ===
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = q.options[q.correct];
        const cleanAnswer = tempDiv.textContent || "";
        announceToScreenReader(`Resposta Incorreta. A resposta correta era: ${cleanAnswer}`);
        
        if (typeof playSound === "function") playSound('incorrect');
        
        // === ADICIONE ESTAS LINHAS: Atualizar MathJax ===
        setTimeout(() => {
            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise([
                    document.getElementById('correct-answer'),
                    document.getElementById('explanation')
                ]).catch(err => console.log('Erro ao processar MathJax:', err));
            }
        }, 100);
    }
            
            gameData.userAnswers.push({
                question: q.question,
                userAnswer: selectedIndex,
                correctAnswer: q.correct,
                isCorrect: isCorrect,
                time: responseTime,
                points: isCorrect ? q.points : 0
            });
            
            updateGameStatus();
        }


        
        function nextQuestion() {
            gameData.currentQuestion++;
            
            if (gameData.currentQuestion < gameData.totalQuestions) {
                showQuestion();
                startTimer();
            } else {
                finishGame();
            }
        }

        function finishGame() {
            // Parar timer
            clearInterval(gameData.timer);
            
            // Calcular estat√≠sticas finais
            const accuracy = (gameData.correctAnswers / gameData.totalQuestions) * 100;
            const avgTime = gameData.questionTimes.length > 0 ? 
                (gameData.questionTimes.reduce((a, b) => a + b) / gameData.questionTimes.length).toFixed(1) : 0;
            
            // Atualizar resultados
            document.getElementById('final-score').textContent = `${accuracy.toFixed(1)}%`;
            document.getElementById('final-correct').textContent = gameData.correctAnswers;
            document.getElementById('accuracy').textContent = `${accuracy.toFixed(1)}% de precis√£o`;
            document.getElementById('final-points').textContent = gameData.score;
            document.getElementById('avg-time').textContent = `${avgTime}s`;
            document.getElementById('max-streak').textContent = gameData.maxStreak;
            
            // Trof√©u baseado na pontua√ß√£o
            let trophy = 'üèÜ';
            if (accuracy >= 90) trophy = 'üëë';
            else if (accuracy >= 70) trophy = 'ü•á';
            else if (accuracy >= 50) trophy = 'ü•à';
            else trophy = 'üéñÔ∏è';
            document.getElementById('trophy').textContent = trophy;
            
            // Criar resumo
            createAnswersSummary();
            
            // Criar gr√°fico
            createPerformanceChart();
            
            // Verificar se desbloqueou novas conquistas
            checkGameAchievements();
            
            // Salvar recordes
            saveRecords();
            
            // Mostrar tela de resultados
            showScreen('results-screen');
            
            // Tocar som de vit√≥ria e fogos de artif√≠cio se boa pontua√ß√£o
            if (accuracy >= 70) {
                playSound('achievement');
                // Fogos de artif√≠cio para celebrar uma boa pontua√ß√£o
                setTimeout(() => createFireworksEffect(), 500);
            }
        }

        
        // ================ POWER-UPS ================
        function usePowerUp(power) {
            
            // === PROTE√á√ÉO NOVA ===
            if (gameData.isQuestionAnswered) {
                showNotification("‚è∏Ô∏è Quest√£o j√° respondida!", "warning");
                return;
            }
            // =====================

            if (gameData.timeLeft <= 0) {
                showNotification("‚åõ Tempo esgotado!", "warning");
                return;
            }


        if (gameData.powerUps[power].count <= 0) {
                // Feedback visual sutil
                const btn = document.querySelector(`.power-up[data-power="${power}"]`);
                if (btn) {
                    btn.classList.add('shake');
                    setTimeout(() => btn.classList.remove('shake'), 500);
                }
                return;
            }   

            switch(power) {
                case 'hint':
                    showHint();
                    break;
                case 'skip':
                    skipQuestion();
                    break;
                case 'time':
                    addTime(10);
                    break;
                case 'double':
                    activateDoublePoints();
                    break;
            }
            
            gameData.powerUps[power].count--;
            gameData.powerUps[power].used++;
            updatePowerUpDisplay();
            playSound('powerup');
        }

 function showHint() {
    const q = gameData.questions[gameData.currentQuestion];
    
    // Criar tooltip tempor√°rio
    const hintTooltip = document.createElement('div');
    hintTooltip.className = 'hint-tooltip';
    hintTooltip.innerHTML = `
        <div style="padding: 10px; background: rgba(0,0,0,0.9); border-radius: 10px; 
                    border: 2px solid #ff9800; color: white; max-width: 300px;">
            <strong>üí° Dica:</strong> ${q.hint}
        </div>
    `;
    
    hintTooltip.style.position = 'fixed';
    hintTooltip.style.top = '50%';
    hintTooltip.style.left = '50%';
    hintTooltip.style.transform = 'translate(-50%, -50%)';
    hintTooltip.style.zIndex = '10000';
    
    document.body.appendChild(hintTooltip);
    
    // Auto-remover ap√≥s 5 segundos
    setTimeout(() => {
        hintTooltip.style.opacity = '0';
        setTimeout(() => hintTooltip.remove(), 300);
    }, 5000);
}

        function skipQuestion() {
            clearInterval(gameData.timer);
            gameData.doublePointsActive = false;
            // Registrar como errada
            gameData.userAnswers.push({
                question: gameData.questions[gameData.currentQuestion].question,
                userAnswer: -1,
                correctAnswer: gameData.questions[gameData.currentQuestion].correct,
                isCorrect: false,
                time: (Date.now() - gameData.questionStartTime) / 1000,
                points: 0,
                skipped: true
            });
            
            gameData.currentStreak = 0;
            nextQuestion();
        }

        function addTime(seconds) {
            gameData.timeLeft += seconds;
            updateTimerDisplay();
            
            // Efeito visual
            const timerText = document.getElementById('timer-text');
            timerText.style.color = '#4caf50';
            setTimeout(() => {
                timerText.style.color = '#ffeb3b';
            }, 1000);
        }

        function activateDoublePoints() {
            gameData.doublePointsActive = true;
            
            // Efeito visual
            const indicator = document.createElement('div');
            indicator.textContent = '‚ú® Pontos em Dobro Ativo!';
            indicator.style.position = 'fixed';
            indicator.style.top = '50%';
            indicator.style.left = '50%';
            indicator.style.transform = 'translate(-50%, -50%)';
            indicator.style.background = 'linear-gradient(90deg, #ff9800, #ff5722)';
            indicator.style.color = 'white';
            indicator.style.padding = '15px 30px';
            indicator.style.borderRadius = '30px';
            indicator.style.fontWeight = 'bold';
            indicator.style.zIndex = '10000';
            indicator.style.animation = 'fadeIn 0.5s';
            document.body.appendChild(indicator);
            
            setTimeout(() => {
                indicator.style.opacity = '0';
                indicator.style.transform = 'translate(-50%, -50%) scale(0.8)';
                setTimeout(() => indicator.remove(), 500);
            }, 2000);
        }

        // ================ TIMER ================
        function startTimer() {
            clearInterval(gameData.timer);
            updateTimerDisplay();
            
            gameData.timer = setInterval(() => {
                gameData.timeLeft--;
                updateTimerDisplay();
                
                if (gameData.timeLeft <= 0) {
                    clearInterval(gameData.timer);
                    timeUp();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerText = document.getElementById('timer-text');
    const timerProgress = document.getElementById('timer-progress');
    
    // Exibir o tempo real
    timerText.textContent = gameData.timeLeft;
    
    const circumference = 283;
    const maxTime = 60;
    
    // Para c√°lculo visual, limitar a 60s m√°ximo
    let displayTime = Math.min(gameData.timeLeft, maxTime);
    const offset = circumference - (displayTime / maxTime) * circumference;
    
    timerProgress.style.strokeDashoffset = offset;
            
           
            
            // Mudar cor conforme o tempo
            if (gameData.timeLeft < 10) {
                timerProgress.style.stroke = '#f44336';
                timerText.style.color = '#f44336';
            } else if (gameData.timeLeft < 20) {
                timerProgress.style.stroke = '#ff9800';
                timerText.style.color = '#ff9800';
            } else {
                timerProgress.style.stroke = '#4caf50';
                timerText.style.color = '#ffeb3b';
            }
        }

        function timeUp() {
            gameData.doublePointsActive = false; 
    // Desabilitar op√ß√µes
    document.querySelectorAll('.option').forEach(o => {
        o.style.pointerEvents = 'none';
    });
    
    // Mostrar feedback de tempo esgotado
    alert('‚è∞ Tempo esgotado!');
    
    // Registrar como resposta errada
    const q = gameData.questions[gameData.currentQuestion];
    const options = document.querySelectorAll('.option');
    options[q.correct].classList.add('correct');
    
    // Mostrar feedback incorreto
    document.getElementById('incorrect-feedback').style.display = 'block';
    document.getElementById('correct-answer').innerHTML = q.options[q.correct];
    document.getElementById('explanation').innerHTML = "Tempo esgotado! " + q.explanation;
    
    // === ADICIONE ESTAS LINHAS: Atualizar MathJax ===
    setTimeout(() => {
        if (window.MathJax && window.MathJax.typesetPromise) {
            MathJax.typesetPromise([
                document.getElementById('correct-answer'),
                document.getElementById('explanation')
            ]).catch(err => console.log('Erro ao processar MathJax:', err));
        }
    }, 100); 
            
            gameData.userAnswers.push({
                question: q.question,
                userAnswer: -1,
                correctAnswer: q.correct,
                isCorrect: false,
                time: 60,
                points: 0,
                timeout: true
            });
            
            gameData.currentStreak = 0;
            document.getElementById('next-btn').disabled = false;
        }

function updateMathJax(elements) {
    if (!elements) return;
    
    if (window.MathJax && window.MathJax.typesetPromise) {
        setTimeout(() => {
            MathJax.typesetPromise(elements).catch(err => {
                console.log('Erro ao processar MathJax:', err);
                // Tentativa alternativa
                if (window.MathJax && window.MathJax.typeset) {
                    MathJax.typeset(elements);
                }
            });
        }, 50);
    }
}


        // ================ SISTEMA DE XP E N√çVEIS ================
        function addXP(points) {
            gameData.xp += points;
            
            // Verificar se subiu de n√≠vel
            while (gameData.xp >= gameData.xpToNextLevel) {
                gameData.xp -= gameData.xpToNextLevel;
                gameData.level++;
                gameData.xpToNextLevel = Math.floor(gameData.xpToNextLevel * 1.2); // Aumenta 20% a cada n√≠vel
                
                // Efeitos de level up
                levelUpEffects();
            }
            
            updateLevelDisplay();
            saveGameData();
        }

        function levelUpEffects() {
            // Tocar som
            playSound('level-up');
            
            // Efeito visual
           
           
           const levelUp = document.createElement('div');
levelUp.innerHTML = `
    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
               background: rgba(0,0,0,0.9); color: white; padding: 30px; border-radius: 20px; 
               text-align: center; border: 3px solid #ffeb3b;
               z-index: 2000;">
        <div style="font-size: 50px; margin-bottom: 20px;">üéâ</div>
        <h2 style="color: #ffeb3b; margin-bottom: 10px;">N√≠vel Up!</h2>
        <h3 style="font-size: 40px; color: #4caf50;">N√≠vel ${gameData.level}</h3>
        <p style="margin-top: 20px;">Novos power-ups desbloqueados!</p>
    </div>
`;
document.body.appendChild(levelUp); // Adiciona o elemento na tela
           
          /*(Nota: No JS inline n√£o d√° para usar `var(--z...)` facilmente sem configurar antes, ent√£o usamos `2000` que √© o valor equivalente √† nossa camada de notifica√ß√£o).*/

/*### Por que isso √© melhor? */
/*Se amanh√£ voc√™ criar um novo "Menu de Configura√ß√µes" e quiser que ele fique em cima da calculadora, mas embaixo do aviso de "Level Up", voc√™ s√≥ precisa definir `z-index: var(--z-modal)`. N√£o precisa ficar lembrando se o n√∫mero era 1001 ou 10005. */
                  


            
            // Fogos de artif√≠cio para celebrar level up
            setTimeout(() => createFireworksEffect(), 300);
            
            setTimeout(() => {
                levelUp.style.opacity = '0';
                levelUp.style.transform = 'translate(-50%, -50%) scale(0.8)';
                setTimeout(() => levelUp.remove(), 500);
            }, 3000);
            
            // Desbloquear power-ups adicionais
           // PREMIA√á√ÉO: D√° +1 de cada item a cada 3 n√≠veis
    if (gameData.level % 3 === 0) {
        gameData.powerUps.hint.count++;
        gameData.powerUps.skip.count++;
        gameData.powerUps.time.count++;
        gameData.powerUps.double.count++;
        
        // Salva imediatamente para n√£o perder o pr√™mio se fechar o navegador
        saveGameData(); 
        updatePowerUpDisplay();
        alert("üéÅ B√¥nus de N√≠vel: Voc√™ ganhou +1 de todos os Power-ups!");
    }
}
        // ================ CONQUISTAS ================
        function checkAchievements() {
            const newAchievements = [];
            
            // Verificar conquistas de streak
            if (gameData.currentStreak >= 10 && !achievements.find(a => a.id === 'streak_master').unlocked) {
                unlockAchievement('streak_master');
                newAchievements.push('streak_master');
            }
            
            // Verificar conquistas de tempo
            const avgTime = gameData.questionTimes.reduce((a, b) => a + b, 0) / gameData.questionTimes.length;
            if (avgTime < 30 && gameData.questionTimes.length >= 5 && !achievements.find(a => a.id === 'speed_demon').unlocked) {
                unlockAchievement('speed_demon');
                newAchievements.push('speed_demon');
            }
            
            return newAchievements;
        }

        function checkGameAchievements() {
            const newAchievements = [];
            
            // Primeiro jogo
            if (!achievements.find(a => a.id === 'first_game').unlocked) {
                unlockAchievement('first_game');
                newAchievements.push('first_game');
            }
            
            // Pontua√ß√£o perfeita
            if (gameData.correctAnswers === gameData.totalQuestions && !achievements.find(a => a.id === 'perfect_score').unlocked) {
                unlockAchievement('perfect_score');
                newAchievements.push('perfect_score');
            }
            
            // Usou todos os power-ups
            const totalUsed = Object.values(gameData.powerUps).reduce((sum, p) => sum + p.used, 0);
            if (totalUsed >= 4 && !achievements.find(a => a.id === 'power_user').unlocked) {
                unlockAchievement('power_user');
                newAchievements.push('power_user');
            }
            
            // N√≠vel 10
            if (gameData.level >= 10 && !achievements.find(a => a.id === 'level_10').unlocked) {
                unlockAchievement('level_10');
                newAchievements.push('level_10');
            }
            
            // Mostrar conquistas desbloqueadas
            if (newAchievements.length > 0) {
                showUnlockedAchievements(newAchievements);
                
                // Fogos de artif√≠cio para celebrar conquistas
                setTimeout(() => createFireworksEffect(), 100);
            }
        }

        function unlockAchievement(id) {
            const achievement = achievements.find(a => a.id === id);
            if (achievement && !achievement.unlocked) {
                achievement.unlocked = true;
                gameData.achievements.push(id);
                addXP(achievement.xp);
                updateAchievementsDisplay();
                saveGameData();
                return true;
            }
            return false;
        }

        // ================ INTERFACE ================
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(screenId).style.display = 'block';
        }

       function updateGameStatus() {
            document.getElementById('score').textContent = gameData.score;
            document.getElementById('question-counter').textContent = 
                `${gameData.currentQuestion + 1}/${gameData.totalQuestions}`;
            
            // Verifica se o elemento streak existe antes de atualizar
            const streakEl = document.getElementById('streak');
            if (streakEl) {
                streakEl.textContent = `Streak: ${gameData.currentStreak}`;
            }

            document.getElementById('current-theme').textContent = 
                gameData.theme === 'probabilidade' ? 'Probabilidade' : 'Estat√≠stica';
            
            // A LINHA QUE CAUSAVA ERRO FOI REMOVIDA AQUI (document.getElementById('difficulty')...)
            
            updateLevelDisplay();
        }
        function updateLevelDisplay() {
            document.getElementById('level').textContent = gameData.level;
            document.getElementById('xp').textContent = `${gameData.xp}/${gameData.xpToNextLevel} XP`;
            
            const percentage = (gameData.xp / gameData.xpToNextLevel) * 100;
            document.getElementById('level-fill').style.width = `${percentage}%`;
            document.getElementById('level-percentage').textContent = `${Math.floor(percentage)}%`;
        }


        function updatePowerUpDisplay() {
            // Atualiza os contadores na tela inicial e no jogo
            ['hint', 'skip', 'time', 'double'].forEach(type => {
                // Tenta atualizar contador da tela inicial (se existir)
                const homeCount = document.getElementById(`${type}-count`);
                if (homeCount) homeCount.textContent = gameData.powerUps[type].count;
                
                // Tenta atualizar contador do jogo (se existir)
                const gameCount = document.getElementById(`game-${type}-count`);
                if (gameCount) gameCount.textContent = gameData.powerUps[type].count;
            });

            // L√≥gica para habilitar/desabilitar visualmente (ADICIONAR/REMOVER CLASSE .disabled)
            document.querySelectorAll('.power-up').forEach(powerUp => {
                const power = powerUp.dataset.power;
                
                // O power-up deve ficar desabilitado se:
                // 1. O estoque for 0 OU
                // 2. A pergunta j√° tiver sido respondida (bloqueio p√≥s-confirma√ß√£o)
                const shouldDisable = (gameData.powerUps[power].count <= 0) || gameData.isQuestionAnswered;

                if (shouldDisable) {
                    powerUp.classList.add('disabled'); // Aplica o estilo sombreado
                    // Mant√©m o atributo disabled para acessibilidade se for button
                    if (powerUp.tagName === 'BUTTON') powerUp.disabled = true; 
                } else {
                    powerUp.classList.remove('disabled'); // Remove o sombreado (volta a cor)
                    if (powerUp.tagName === 'BUTTON') powerUp.disabled = false;
                }
            });
        }



        function updateThemeDisplay() {
            // Atualizar progresso dos temas
            const themeProgress = JSON.parse(localStorage.getItem('themeProgress') || '{}');
            
            document.getElementById('probabilidade-progress').textContent = 
                `${themeProgress.probabilidade?.completed || 0}%`;
            document.getElementById('probabilidade-record').textContent = 
                themeProgress.probabilidade?.record || 0;
            
            document.getElementById('estatistica-progress').textContent = 
                `${themeProgress.estatistica?.completed || 0}%`;
            document.getElementById('estatistica-record').textContent = 
                themeProgress.estatistica?.record || 0;
        }

        function showStreakIndicator() {
            const indicator = document.getElementById('streak-indicator');
            document.getElementById('current-streak').textContent = gameData.currentStreak;
            indicator.style.display = 'block';
            
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 3000);
        }

        function createAnswersSummary() {
            const summary = document.getElementById('answers-summary');
            summary.innerHTML = '';
            
            gameData.userAnswers.forEach((answer, index) => {
                const q = gameData.questions[index];
                const item = document.createElement('div');
                item.style.marginBottom = '15px';
                item.style.padding = '15px';
                item.style.background = answer.isCorrect ? 'rgba(76,175,80,0.1)' : 'rgba(244,67,54,0.1)';
                item.style.borderRadius = '10px';
                item.style.borderLeft = `4px solid ${answer.isCorrect ? '#4caf50' : '#f44336'}`;
                
                let status = answer.isCorrect ? '‚úÖ' : '‚ùå';
                if (answer.skipped) status = '‚è≠Ô∏è';
                if (answer.timeout) status = '‚è∞';
                
                item.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px;">
                        ${status} Quest√£o ${index + 1}: ${answer.question}
                    </div>
                    <div style="font-size: 14px; color: ${answer.isCorrect ? '#4caf50' : '#f44336'};">
                        ${answer.isCorrect ? 
                            `Acertou! +${answer.points} pontos (${answer.time.toFixed(1)}s)` : 
                            `Resposta correta: ${q.options[answer.correctAnswer]}`
                        }
                        ${answer.skipped ? ' (Pulada)' : ''}
                        ${answer.timeout ? ' (Tempo esgotado)' : ''}
                    </div>
                `;
                
                summary.appendChild(item);

setTimeout(() => {
            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise([item]).catch(err => {
                    console.log('Erro MathJax no resumo:', err);
                });
            }
        }, 100);
    });
}



       function createPerformanceChart() {
            // === IN√çCIO DA CORRE√á√ÉO ===
            // Verifica se j√° existe um gr√°fico no canvas e o destr√≥i antes de criar um novo
            const existingChart = Chart.getChart("performance-chart");
            if (existingChart) {
                existingChart.destroy();
            }
            // === FIM DA CORRE√á√ÉO ===

            const ctx = document.getElementById('performance-chart').getContext('2d');
            
            // Dados para o gr√°fico
            const questionNumbers = Array.from({length: gameData.userAnswers.length}, (_, i) => i + 1);
            const correctness = gameData.userAnswers.map(a => a.isCorrect ? 1 : 0);
            const responseTimes = gameData.userAnswers.map(a => a.time);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: questionNumbers,
                    datasets: [
                        {
                            label: 'Acertos (1=sim, 0=n√£o)',
                            data: correctness,
                            borderColor: '#4caf50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.3,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Tempo de resposta (s)',
                            data: responseTimes,
                            borderColor: '#2196f3',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.3,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#bbdefb'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        }
                    }
                }
            });
        }
        // ================ AUDIO CORRIGIDO DEFINITIVAMENTE ================
        let audioEnabled = false;
        
        function initAudio() {
            console.log("Inicializando √°udios...");
            
            // Tentar carregar todos os √°udios
            const audioElements = document.querySelectorAll('audio');
            audioElements.forEach(audio => {
                // Configurar volume
                audio.volume = 1.0;
                
                // Tentar carregar (sem .catch, pois load() n√£o retorna promessa)
                try {
                    audio.load();
                } catch (e) {
                    console.log("Erro ao carregar √°udio:", e);
                }
            });
            
            console.log("√Åudios inicializados");
        }
        
        function testAudio() {
            console.log("Testando √°udio...");
            audioEnabled = true;
            playSound('firework');
            alert("üîä Teste de som realizado! Se voc√™ ouviu fogos de artif√≠cio, o som est√° funcionando.");
        }
        
        function playSound(type) {
            // Verificar se o som est√° habilitado
            if (localStorage.getItem('soundEnabled') === 'false') return;
            
            // Se o √°udio ainda n√£o foi habilitado (primeira intera√ß√£o), n√£o tenta tocar
            if (!audioEnabled) {
                console.log("√Åudio n√£o habilitado ainda. Clique em 'Testar Som' primeiro.");
                return;
            }
            
            const audio = document.getElementById(`${type}-sound`);
            if (audio) {
                try {
                    // Para o √°udio e reinicia
                    audio.pause();
                    audio.currentTime = 0;
                    
                    // Ajustar volume espec√≠fico para fogos de artif√≠cio
                    // Ajustar volume espec√≠fico para fogos de artif√≠cio
                  // Ajustar volume espec√≠fico para fogos de artif√≠cio
                    if (type === 'firework') {
                        audio.volume = 1.0; // Volume M√ÅXIMO
                        audio.currentTime = 0; // Reinicia o som para dar o estalo imediato
                    } else {
                        // Se n√£o for fogo, toca um pouco mais baixo (60%) 
                        // para que, quando os fogos entrarem (100%), eles pare√ßam muito altos
                        audio.volume = 0.6; 
                    }
                    
                    // Tenta tocar
                    const playPromise = audio.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.catch(error => {
                            console.log(`N√£o foi poss√≠vel tocar o som ${type}:`, error);
                            // Tentativa alternativa - usar √°udio embutido
                            fallbackAudio(type);
                        });
                    }
                } catch (error) {
                    console.log(`Erro ao tocar som ${type}:`, error);
                    fallbackAudio(type);
                }
            } else {
                console.log(`√Åudio n√£o encontrado: ${type}`);
                fallbackAudio(type);
            }
        }
        
        // Fallback para √°udio usando Web Audio API se os URLs externos falharem
        function fallbackAudio(type) {
            console.log(`Usando fallback para: ${type}`);
            
            // Criar contexto de √°udio
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioContext = new AudioContext();
            
            // Gerar som baseado no tipo
            let frequency = 440; // Hz
            let duration = 0.3; // segundos
            
            switch(type) {
                case 'correct':
                    frequency = 523.25; // C5
                    break;
                case 'incorrect':
                    frequency = 349.23; // F4
                    break;
                case 'level-up':
                    frequency = 659.25; // E5
                    break;
                case 'achievement':
                    // Acorde maior
                    playChord([523.25, 659.25, 783.99], 1.0);
                    return;
                case 'powerup':
                    frequency = 587.33; // D5
                    break;
                case 'firework':
                    // Som de explos√£o
                    playExplosionSound();
                    return;
            }
            
            // Criar oscilador
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = 'sine';
            
            // Configurar envelope
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        function playChord(frequencies, duration) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioContext = new AudioContext();
            const gainNode = audioContext.createGain();
            
            gainNode.connect(audioContext.destination);
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            frequencies.forEach(freq => {
                const oscillator = audioContext.createOscillator();
                oscillator.connect(gainNode);
                oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                oscillator.type = 'sine';
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            });
        }
        
        function playExplosionSound() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioContext = new AudioContext();
            const bufferSize = audioContext.sampleRate * 0.5;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const output = buffer.getChannelData(0);
            
            // Gerar ru√≠do branco
            for (let i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }
            
            const whiteNoise = audioContext.createBufferSource();
            whiteNoise.buffer = buffer;
            
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            whiteNoise.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(1000, audioContext.currentTime);
            filter.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 1);
            
            gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            
            whiteNoise.start(audioContext.currentTime);
            whiteNoise.stop(audioContext.currentTime + 1);
        }

        // ================ LOCAL STORAGE ================
        function saveGameData() {
            const data = {
                xp: gameData.xp,
                level: gameData.level,
                xpToNextLevel: gameData.xpToNextLevel,
                achievements: gameData.achievements,
                settings: gameData.settings,
                powerUps: gameData.powerUps
            };
            localStorage.setItem('mathGameData', JSON.stringify(data));
        }

function loadGameData() {
    try {
        const data = JSON.parse(localStorage.getItem('mathGameData'));
        if (data) {
            // Carrega dados persistentes
            gameData.xp = data.xp || 0;
            gameData.level = data.level || 1;
            gameData.xpToNextLevel = data.xpToNextLevel || 100;
            gameData.achievements = data.achievements || [];
            gameData.settings = data.settings || { sound: true };
            
            // IMPORTANTE: Carrega o estoque de power-ups salvo
            if (data.powerUps) {
                gameData.powerUps = data.powerUps;
            }

            // Atualizar status das conquistas
            achievements.forEach(ach => {
                ach.unlocked = gameData.achievements.includes(ach.id);
            });
        }
    } catch (e) {
        console.error("Erro ao carregar save:", e);
    }

    // Configurar som na UI
    const soundToggle = document.getElementById('sound-toggle');
    if (soundToggle && gameData.settings) {
        soundToggle.value = gameData.settings.sound.toString();
        localStorage.setItem('soundEnabled', gameData.settings.sound);
    }

    // === ATUALIZA√á√ÉO VISUAL IMEDIATA ===
    // Isso garante que a tela inicial mostre os n√∫meros reais do banco de dados
    updateAchievementsDisplay();
    updateThemeDisplay();
    updateLevelDisplay();
    updatePowerUpDisplay(); // <--- Essa linha corrige o n√∫mero na tela inicial
}

        function saveRecords() {
            const accuracy = (gameData.correctAnswers / gameData.totalQuestions) * 100;
            const themeProgress = JSON.parse(localStorage.getItem('themeProgress') || '{}');
            
            if (!themeProgress[gameData.theme]) {
                themeProgress[gameData.theme] = { completed: 0, record: 0 };
            }
            
            // Atualizar porcentagem de conclus√£o
            themeProgress[gameData.theme].completed = Math.max(
                themeProgress[gameData.theme].completed,
                Math.floor(accuracy)
            );
            
            // Atualizar recorde de pontua√ß√£o
            if (gameData.score > (themeProgress[gameData.theme].record || 0)) {
                themeProgress[gameData.theme].record = gameData.score;
            }
            
            localStorage.setItem('themeProgress', JSON.stringify(themeProgress));
            updateThemeDisplay();
        }

        // ================ CONQUISTAS UI ================
        function updateAchievementsDisplay() {
            const list = document.getElementById('achievements-list');
            list.innerHTML = '';
            
            let unlockedCount = 0;
            
            achievements.forEach(ach => {
                const item = document.createElement('div');
                item.className = `achievement-item ${ach.unlocked ? 'unlocked' : 'locked'}`;
                
                item.innerHTML = `
                    <div class="achievement-icon">${ach.icon}</div>
                    <div class="achievement-info">
                        <h4>${ach.name}</h4>
                        <p>${ach.description}</p>
                        <p style="font-size: 10px; color: ${ach.unlocked ? '#4caf50' : '#f44336'}">
                            ${ach.unlocked ? '‚úÖ Desbloqueado' : 'üîí Bloqueado'} ‚Ä¢ ${ach.xp} XP
                        </p>
                    </div>
                `;
                
                list.appendChild(item);
                if (ach.unlocked) unlockedCount++;
            });
            
            document.getElementById('achievement-count').textContent = unlockedCount;
        }

       function showUnlockedAchievements(achievementIds) {
    const container = document.getElementById('new-achievements');
    const list = document.getElementById('achievements-unlocked');
    list.innerHTML = '';
    
    achievementIds.forEach(id => {
        const ach = achievements.find(a => a.id === id);
        if (ach) {
            const item = document.createElement('div');
            item.className = 'achievement-item unlocked';
            item.style.marginBottom = '10px';
            item.innerHTML = `
                <div class="achievement-icon">${ach.icon}</div>
                <div class="achievement-info">
                    <h4>${ach.name}</h4>
                    <p>${ach.description}</p>
                    <p style="color: #4caf50; font-size: 12px;">+${ach.xp} XP ganhos!</p>
                </div>
            `;
            list.appendChild(item);
        }
    });
    
    container.style.display = 'block';
    
    // Auto-fechar ap√≥s 5 segundos
    setTimeout(() => {
        container.style.display = 'none';
    }, 5000);
}

        function toggleAchievements() {
    document.getElementById('achievements-modal').classList.add('active');
    document.body.style.overflow = 'hidden'; // Previne scroll do body
}

function closeAchievements() {
    document.getElementById('achievements-modal').classList.remove('active');
    document.body.style.overflow = ''; // Restaura scroll do body
}

       function resetGameData() {
    // 1. Resetar APENAS dados da partida moment√¢nea (Pontos, Streak, Tempo)
    gameData.currentQuestion = 0;
    gameData.score = 0;
    gameData.correctAnswers = 0;
    gameData.userAnswers = [];
    gameData.currentStreak = 0;
    gameData.maxStreak = 0;
    gameData.questionTimes = [];
    gameData.doublePointsActive = false;
    gameData.questionStartTime = null;
    gameData.timeLeft = 60; // Reinicia o tempo base

    // 2. L√≥gica de Estoque de Power-ups (CORRE√á√ÉO)
    // Se os power-ups N√ÉO existirem ou estiverem vazios (Primeira vez jogando), cria o pacote inicial.
    // Se j√° existirem (carregados do save), N√ÉO MEXE NELES.
    if (!gameData.powerUps || !gameData.powerUps.hint) {
        gameData.powerUps = {
            hint: { count: 3, used: 0 },
            skip: { count: 2, used: 0 },
            time: { count: 2, used: 0 },
            double: { count: 3, used: 0 }
        };
    }
    // Nota: Removemos a matem√°tica de "n√≠vel" daqui para n√£o resetar o estoque toda vez.
    // O jogador ganhar√° mais itens apenas na fun√ß√£o levelUpEffects().
}
        function restartGame() {
            resetGameData();
            showScreen('start-screen');
        }

        function showStats() {
            alert('üìä Estat√≠sticas:\n' +
                  `N√≠vel: ${gameData.level}\n` +
                  `XP: ${gameData.xp}/${gameData.xpToNextLevel}\n` +
                  `Conquistas: ${gameData.achievements.length}/${achievements.length}\n` +
                  `Jogos completados: ${localStorage.getItem('gamesPlayed') || 0}`);
        }

        function shareResults() {
            const accuracy = (gameData.correctAnswers / gameData.totalQuestions) * 100;
            const text = `üéÆ Acabei de jogar Matem√°tica do 9¬∫ Ano!\n` +
                        `Pontua√ß√£o: ${gameData.score} pontos\n` +
                        `Acertos: ${gameData.correctAnswers}/${gameData.totalQuestions} (${accuracy.toFixed(1)}%)\n` +
                        `N√≠vel: ${gameData.level}\n` +
                        `#Matematica #Educacao #JogoEducativo`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Meu Resultado - LIAM - Laborat√≥rio Interativo de Alfabetiza√ß√£o Matem√°tica',
                    text: text,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(text);
                alert('üìã Resultado copiado para a √°rea de transfer√™ncia!');
            }
        }

        // ================ INICIALIZA√á√ÉO FINAL ================
        // Configurar som
        if (localStorage.getItem('soundEnabled') === null) {
            localStorage.setItem('soundEnabled', 'true');
        }
        
        // Habilitar √°udio no primeiro clique do usu√°rio
        document.addEventListener('click', function enableAudio() {
            audioEnabled = true;
            // Remover o listener ap√≥s o primeiro clique
            document.removeEventListener('click', enableAudio);
        });
        
        // Contar jogos jogados
        let gamesPlayed = parseInt(localStorage.getItem('gamesPlayed') || '0');
        localStorage.setItem('gamesPlayed', (gamesPlayed + 1).toString());
        
        console.log('üéÆ Jogo de Matem√°tica carregado com sucesso!');

// ============================================================
    //  NOVOS RECURSOS: ACESSIBILIDADE E FOGOS OTIMIZADOS
    // ============================================================

    // 1. Fun√ß√£o Auxiliar de Acessibilidade (Leitor de Tela)
    function announceToScreenReader(message) {
        const announcer = document.getElementById('a11y-announcer');
        if (announcer) {
            announcer.textContent = ''; // Limpa para for√ßar o an√∫ncio
            setTimeout(() => {
                announcer.textContent = message;
            }, 100);
        }
    }

    // 2. Sistema de Fogos de Artif√≠cio Otimizado (Canvas)
    const canvas = document.getElementById('fireworks-canvas');
    let ctx = null;
    let particles = [];

    // Inicializa o contexto do canvas se ele existir
    if (canvas) {
        ctx = canvas.getContext('2d');
        
        // Ajustar tamanho
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Loop de anima√ß√£o
        function animationLoop() {
            if (particles.length > 0) {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.globalCompositeOperation = 'lighter';

                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.05;
                    p.alpha -= 0.01;

                    ctx.fillStyle = `rgba(${p.r}, ${p.g}, ${p.b}, ${p.alpha})`;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();

                    if (p.alpha <= 0) particles.splice(i, 1);
                }
            } else {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            requestAnimationFrame(animationLoop);
        }
        animationLoop();
    }

    // Fun√ß√£o principal de criar fogos (Substitui a antiga)
    function createFireworksEffect() {
        if (!ctx) return; // Seguran√ßa caso o canvas n√£o carregue
        console.log("Criando fogos (Canvas)...");
        
        // Tenta tocar som se existir
        if (typeof playSound === "function") playSound('firework');
        
        // Cria 5 explos√µes
        for(let i=0; i<5; i++) {
            setTimeout(() => {
                const x = Math.random() * canvas.width;
                const y = Math.random() * (canvas.height * 0.6);
                createExplosion(x, y);
            }, i * 300);
        }
    }

    // Fun√ß√£o auxiliar da explos√£o
    function createExplosion(x, y) {
        const particleCount = 50;
        const r = Math.floor(Math.random() * 255);
        const g = Math.floor(Math.random() * 255);
        const b = Math.floor(Math.random() * 255);

        for (let i = 0; i < particleCount; i++) {
            const angle = Math.random() * Math.PI * 2;
            const velocity = Math.random() * 6 + 2;
            
            particles.push({
                x: x, y: y,
                vx: Math.cos(angle) * velocity,
                vy: Math.sin(angle) * velocity,
                size: Math.random() * 3 + 1,
                r: r, g: g, b: b,
                alpha: 1
            });
        }
    }
    
    // Fun√ß√£o de teste para o bot√£o
    function testFireworks() {
        createFireworksEffect();
    }


    // ================ FUN√á√ïES DOS MODAIS DE TEORIA ================

function openTheoryModal() {
    const modal = document.getElementById('theory-modal');
    if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden'; // Impede a rolagem da p√°gina de fundo
    }
}

function closeTheoryModal() {
    const modal = document.getElementById('theory-modal');
    if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = ''; // Libera a rolagem
    }
}

function openTheoryContentModal(type) {
    const modal = document.getElementById(`${type}-modal`);
    if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
}

function closeTheoryContentModal(type) {
    const modal = document.getElementById(`${type}-modal`);
    if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
    }
}

// Esta fun√ß√£o voc√™ j√° tinha parcialmente, mas precisa garantir que ela existe:
function switchTheoryContent(targetTheme) {
    // Fecha qualquer modal aberto
    closeTheoryContentModal('probabilidade');
    closeTheoryContentModal('estatistica');
    
    // Abre o novo ap√≥s um breve delay para transi√ß√£o visual
    setTimeout(() => {
        openTheoryContentModal(targetTheme);
    }, 300);
}

    </script>
</body>
</html>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>LIAM - Laborat√≥rio Interativo de Alfabetiza√ß√£o Matem√°tica - 9¬∫ Ano</title>
    <!-- Font Awesome para √≠cones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        :root {
            /* --- SISTEMA DE CAMADAS (Z-INDEX) --- */
            --z-back: -1;          /* Fundo */
            --z-base: 1;           /* Conte√∫do normal */
            --z-content: 10;       /* Container principal */
            --z-controls: 100;     /* Bot√µes flutuantes (Conquista, Calc Btn) */
            --z-floating: 500;     /* Calculadora aberta */
            --z-overlay: 900;      /* Fundo escuro do modal */
            --z-modal: 1000;       /* Janelas (Conquistas, Config) */
            --z-notification: 2000;/* Avisos (Level Up, Pontos) */
            --z-effects: 9999;     /* Fogos de artif√≠cio (Sempre no topo) */
        }

        body {
            background: linear-gradient(135deg, #1a237e, #283593);
            color: white;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            position: relative;
            z-index: var(--z-content); /* Era 10 */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        


        h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #ffeb3b;
            text-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
            font-size: 2.5rem;
            background: linear-gradient(90deg, #ffeb3b, #ff9800);
            background-clip: text; /* LINHA ADICIONADA */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 235, 59, 0.3);
        }
        
        /* Painel de status do jogo */
        .game-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .status-item:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .status-label {
            color: #bbdefb;
            font-size: 14px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .status-value {
            font-size: 28px;
            font-weight: bold;
            color: #ffeb3b;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .status-subtext {
            font-size: 12px;
            color: #90caf9;
            margin-top: 5px;
        }
        
        /* Sistema de conquistas */
        .achievement-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff9800, #ff5722);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
            z-index: var(--z-controls);
            transition: all 0.3s;
        }
        
        .achievement-badge:hover {
            transform: scale(1.1) rotate(15deg);
        }
        
/* ========== MODAL DE CONQUISTAS ========== */
.achievements-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: var(--z-modal);
    animation: fadeIn 0.3s ease;
}

.achievements-modal.active {
    display: flex;
}

.modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: var(--z-overlay);
}

.modal-content {
    background: linear-gradient(135deg, #1a237e, #283593);
    border-radius: 20px;
    width: 90%;
    max-width: 500px;
    max-height: 80vh;
    overflow: hidden;
    z-index: var(--z-modal);
    position: relative;
    border: 2px solid #ff9800;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    animation: slideInUp 0.4s ease;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    padding: 20px;
    background: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-close {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.modal-close:hover {
    background: rgba(255, 152, 0, 0.3);
    transform: rotate(90deg);
}

.modal-body {
    padding: 20px;
    overflow-y: auto;
    max-height: 50vh;
}

.modal-footer {
    padding: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(0, 0, 0, 0.2);
}

/* Ajuste para os itens de conquista no modal */
.modal-body .achievement-item {
    margin-bottom: 15px;
}

/* Responsividade do modal */
@media (max-width: 768px) {
    .modal-content {
        width: 95%;
        max-height: 90vh;
    }
    
    .modal-body {
        max-height: 60vh;
    }
}
  


/* Modal de teoria */
.theory-modal, .theory-content-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: var(--z-modal);
    animation: fadeIn 0.3s ease;
}

.theory-modal.active, .theory-content-modal.active {
    display: flex;
}

.theme-choice-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    padding: 25px;
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
}

.theme-choice-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    border-color: #ff9800;
    transform: translateY(-5px);
}

.theory-content-modal .modal-body {
    max-height: 70vh;
    overflow-y: auto;
}

.theory-content-modal h4 {
    color: #ffeb3b;
    margin-top: 20px;
    margin-bottom: 10px;
}

.theory-content-modal p {
    margin-bottom: 10px;
    line-height: 1.5;
}

.theory-content-modal ul {
    margin-left: 20px;
    margin-bottom: 15px;
}

.theory-content-modal li {
    margin-bottom: 5px;
}



        .achievement-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            transition: all 0.3s;
        }
        
        .achievement-item.locked {
            opacity: 0.5;
        }
        
        .achievement-item.unlocked {
            border: 2px solid #ffeb3b;
            box-shadow: 0 0 15px rgba(255, 235, 59, 0.3);
        }
        
        .achievement-icon {
            font-size: 30px;
            margin-right: 15px;
            min-width: 50px;
            text-align: center;
        }
        
        .achievement-info h4 {
            color: #ffeb3b;
            margin-bottom: 5px;
        }
        

        /* --- ADICIONE ISTO AO SEU CSS --- */
        
        .power-up.disabled {
            opacity: 0.3;               /* Bem transparente */
            filter: grayscale(100%);    /* Tira toda a cor (fica cinza) */
            cursor: not-allowed;        /* Cursor de bloqueio */
            pointer-events: none;       /* Impede cliques */
            box-shadow: none !important;/* Remove o brilho */
            border-color: #555 !important; /* Borda escura */
            transform: none !important; /* Remove anima√ß√£o de movimento */
        }

        .achievement-info p {
            font-size: 12px;
            color: #bbdefb;
        }
        
        /* Progresso do n√≠vel */
        .level-progress {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            position: relative;
        }
        
        .level-bar {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }
        
        .level-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .level-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Substitua todo o bloco .calc-btn antigo por este: */

.calc-btn {
    /* Removemos position: fixed, bottom e left */
    position: relative; 
    display: flex;
    align-items: center;
    justify-content: center;
    
    /* Tamanho igual ao dos power-ups */
    width: 60px;
    height: 60px;
    
    /* Estilo visual */
    background: linear-gradient(135deg, #4caf50, #2e7d32);
    color: white;
    border-radius: 50%;
    border: 2px solid #4caf50; /* Borda para combinar */
    font-size: 24px; /* Ajuste para o √≠cone ficar centralizado */
    cursor: pointer;
    box-shadow: 0 0 15px rgba(76, 175, 80, 0.4);
    z-index: var(--z-controls);
    transition: all 0.3s ease;
    
    /* Margem para n√£o colar nos outros */
    margin: 0; 
}

.calc-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 0 25px rgba(76, 175, 80, 0.6);
}        
        .calculator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 320px;
            background: #1e1e1e;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.7);
            display: none;
            flex-direction: column;
            z-index: var(--z-floating);
            border: 2px solid #444;
            overflow: hidden;
        }
        
        .calculator.active {
            display: flex;
        }
        
        .calc-header {
            background: linear-gradient(90deg, #2196f3, #1976d2);
            padding: 12px 20px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            color: white;
            font-weight: bold;
        }
        
        .calc-controls {
            display: flex;
            gap: 5px;
        }
        
        .calc-controls button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calc-controls button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .calc-display {
            background: #1a1a1a;
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #444;
        }
        
        .calc-expression {
            color: #888;
            font-size: 14px;
            min-height: 20px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .calc-result {
            color: white;
            font-size: 28px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            padding: 15px;
            background: #2a2a2a;
        }
        
        .calc-button {
            background: #3a3a3a;
            color: white;
            border: none;
            height: 50px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calc-button:hover {
            background: #4a4a4a;
        }
        
        .calc-button.operator {
            background: #ff9800;
        }
        
        .calc-button.operator:hover {
            background: #ffb74d;
        }
        
        .calc-button.equals {
            background: #4caf50;
            grid-column: span 2;
        }
        
        .calc-button.clear {
            background: #f44336;
        }
        
        /* Temas de jogo */
        .theme-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .theme-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }
        
        .theme-card:hover {
            transform: translateY(-10px);
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 152, 0, 0.3);
        }
        
        .theme-card.selected {
            background: rgba(255, 152, 0, 0.2);
            border: 2px solid #ff9800;
            box-shadow: 0 10px 25px rgba(255, 152, 0, 0.3);
        }
        
        .theme-icon {
            font-size: 50px;
            margin-bottom: 15px;
            color: #ffeb3b;
        }
        
        .theme-card h3 {
            margin-bottom: 10px;
            color: #ffeb3b;
            font-size: 1.5rem;
        }
        
        .theme-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 12px;
            color: #90caf9;
        }
        


        /* Modal do Tutorial */
.tutorial-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: var(--z-modal);
    animation: fadeIn 0.3s ease;
}

.tutorial-modal.active {
    display: flex;
}

.tutorial-modal .modal-content {
    background: linear-gradient(135deg, #1a237e, #283593);
    border-radius: 20px;
    width: 90%;
    max-width: 900px;
    max-height: 80vh;
    overflow: hidden;
    z-index: var(--z-modal);
    position: relative;
    border: 2px solid #2196f3;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    animation: slideInUp 0.4s ease;
}

.tutorial-modal h4 {
    color: #ffeb3b;
    margin-bottom: 15px;
    font-size: 1.3rem;
}

.tutorial-modal p {
    margin-bottom: 10px;
    line-height: 1.5;
    color: #bbdefb;
}

.tutorial-modal ul {
    margin-left: 20px;
    margin-bottom: 15px;
}

.tutorial-modal li {
    margin-bottom: 8px;
    color: #bbdefb;
}

        /* Adicionar no CSS: */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .shake { animation: shake 0.5s ease; }

        /* Configura√ß√µes - CORRIGIDO */
        select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: #ffeb3b;
            border: 1px solid rgba(255, 235, 59, 0.3);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        select:hover {
            border-color: #ff9800;
        }
        
        select option {
            background: #1a237e;
            color: white;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #bbdefb;
            font-weight: 500;
        }
        
        /* Quest√µes */
        .question-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #ff9800;
            animation: fadeIn 0.5s ease;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .question-number {
            background: linear-gradient(135deg, #ff9800, #ff5722);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            box-shadow: 0 4px 10px rgba(255, 152, 0, 0.3);
        }
        
        .question-difficulty {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .difficulty-easy { color: #4caf50; }
        .difficulty-medium { color: #ff9800; }
        .difficulty-hard { color: #f44336; }
        
        .question-text {
            font-size: 1.2rem;
            line-height: 1.6;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 4px solid #2196f3;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin: 25px 0;
        }
        
        .option {
            width: 100%;
            text-align: left;
            font-family: inherit;
            font-size: 1rem;
            color: white;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .option:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateX(5px);
        }
        
        .option.selected {
            background: rgba(255, 152, 0, 0.2);
            border-color: #ff9800;
        }
        
        .option.correct {
            background: rgba(76, 175, 80, 0.2);
            border-color: #4caf50;
            animation: pulseCorrect 0.5s ease;
        }
        
        .option.incorrect {
            background: rgba(244, 67, 54, 0.2);
            border-color: #f44336;
        }
        
        @keyframes pulseCorrect {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .option-letter {
            background: rgba(255, 255, 255, 0.15);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            color: #ffeb3b;
            font-size: 16px;
        }
        
        /* Ajuste para os power-ups com calculadora */
.power-ups {
    display: flex;
    justify-content: center;
    align-items: center; /* Alinha verticalmente */
    gap: 15px;
    margin: 20px 0;
    flex-wrap: wrap; /* Permite quebra de linha em telas pequenas */
}
        
        .power-up {
            background: rgba(156, 39, 176, 0.3);
            border: 2px solid #9c27b0;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .power-up:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(156, 39, 176, 0.5);
        }
        
        .power-up:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .power-up-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Bot√µes */
        .btn {
            background: linear-gradient(90deg, #ff9800, #ff5722);
            color: white;
            border: none;
            padding: 15px 35px;
            font-size: 16px;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px;
            font-weight: bold;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
        }
        
        .btn:hover:not(:disabled) {
            opacity: 0.9;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 152, 0, 0.6);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, #2196f3, #1976d2);
        }
        
        /* Feedback */
        .feedback-card {
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            animation: slideIn 0.5s ease;
            display: none;
        }
        
        .feedback-card.correct {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4caf50;
        }
        
        .feedback-card.incorrect {
            background: rgba(244, 67, 54, 0.2);
            border: 2px solid #f44336;
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Tela de resultados */
        .results-container {
            text-align: center;
            animation: fadeIn 0.8s ease;
        }
        
        .trophy {
            font-size: 80px;
            color: #ffeb3b;
            margin: 20px 0;
            animation: bounce 1s ease infinite alternate;
        }
        
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-20px); }
        }
        
        .score-display {
            font-size: 60px;
            font-weight: bold;
            background: linear-gradient(90deg, #ffeb3b, #ff9800);
            background-clip: text; /* LINHA ADICIONADA */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            transition: all 0.3s;
        }
        
/* --- NOVO: Canvas para Fogos de Artif√≠cio (Alta Performance) --- */
        #fireworks-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Deixa clicar atrav√©s dele */
            z-index: var(--z-effects);
        }

        /* --- NOVO: Classe para Leitor de Tela (Invis√≠vel visualmente) --- */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }




        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Anima√ß√µes */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .theme-selection {
                grid-template-columns: 1fr;
            }
            
            .game-status {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .calculator {
                width: 90%;
                left: 5%;
                top: 50px;
                transform: translateX(-50%);
            }
            
            .achievements-panel {
                width: 100%;
                right: -100%;
            }
        }
        
        /* Efeitos especiais - Fogos de artif√≠cio */
        .firework {
            position: fixed;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            pointer-events: none;
            z-index: var(--z-effects);
        }
        
        .firework-particle {
            position: fixed;
            pointer-events: none;
            border-radius: 50%;
            z-index: var(--z-effects);
        }
        
        .firework-trail {
            position: fixed;
            pointer-events: none;
            border-radius: 50%;
            z-index: var(--z-effects);
        }
        
        /* Streak indicator */
        .streak-indicator {
            position: absolute;
            top: -40px;
            right: 20px;
            background: linear-gradient(135deg, #ff5722, #d81b60);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: none;
            animation: pulseStreak 1s infinite;
        }
        
        @keyframes pulseStreak {
            0% { box-shadow: 0 0 0 0 rgba(255, 87, 34, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 87, 34, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 87, 34, 0); }
        }
        
        /* Timer */
        .timer-container {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto;
        }
        
        .timer-circle {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        .timer-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 8;
        }
        
        .timer-progress {
            fill: none;
            stroke: #4caf50;
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 1s linear;
        }
        
        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            font-weight: bold;
            color: #ffeb3b;
        }
        
        /* Bot√£o de teste de fogos */
        .test-fireworks-btn {
            background: linear-gradient(90deg, #ff5722, #d81b60);
        }
        
        /* Anima√ß√£o de explos√£o de fogos */
        @keyframes firework {
            0% { 
                transform: translate(var(--x), var(--initialY));
                width: var(--initialSize);
                height: var(--initialSize);
                opacity: 1;
            }
            50% { 
                width: 0.5vmin;
                height: 0.5vmin;
            }
            100% { 
                transform: translate(var(--x), var(--y));
                opacity: 0;
            }
        }
        
        /* ========== FOOTER APRIMORADO ========== */
        .game-footer {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 2px solid rgba(255, 235, 59, 0.2);
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            padding: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .game-footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #ff9800, #ffeb3b, #2196f3, #4caf50);
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-title {
            text-align: center;
            margin-bottom: 30px;
            color: #ffeb3b;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .footer-title i {
            font-size: 2rem;
        }
        
        .authors-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .authors-section h3 {
            color: #ff9800;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .authors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .author-card {
            background: rgba(33, 150, 243, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(33, 150, 243, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .author-card:hover {
            transform: translateY(-8px);
            background: rgba(33, 150, 243, 0.2);
            border-color: #2196f3;
            box-shadow: 0 10px 20px rgba(33, 150, 243, 0.2);
        }
        
        .author-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #2196f3, #4caf50);
        }
        
        .author-icon {
            font-size: 2.5rem;
            color: #ffeb3b;
            margin-bottom: 15px;
            display: block;
        }
        
        .author-name {
            font-weight: bold;
            color: white;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }
        
        .author-role {
            color: #bbdefb;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        
        .univesp-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 152, 0, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            color: #ff9800;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 25px;
            margin: 30px 0;
            padding: 20px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .footer-link {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #bbdefb;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        
        .footer-link:hover {
            background: rgba(255, 152, 0, 0.2);
            color: #ffeb3b;
            transform: translateY(-3px);
        }
        
        .footer-link i {
            font-size: 1.2rem;
        }
        
        .github-link {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: linear-gradient(90deg, #333, #444);
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: bold;
            margin: 25px auto;
            width: fit-content;
            transition: all 0.3s ease;
            border: 2px solid #555;
        }
        
        .github-link:hover {
            background: linear-gradient(90deg, #444, #555);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border-color: #ff9800;
        }
        
        .github-link i {
            font-size: 1.5rem;
        }
        
        .copyright {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #90caf9;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .copyright p {
            margin-bottom: 8px;
        }
        
        .math-formulas {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 25px 0;
            opacity: 0.7;
            font-size: 1.5rem;
        }
        
        .math-formula {
            animation: float 3s ease-in-out infinite;
        }
        
        .math-formula:nth-child(2) {
            animation-delay: 0.5s;
        }
        
        .math-formula:nth-child(3) {
            animation-delay: 1s;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @media (max-width: 768px) {
            .game-footer {
                padding: 20px;
            }
            
            .authors-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-links {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .footer-title {
                font-size: 1.5rem;
            }
        }

/* --- ATUALIZA√á√ÉO DO CSS --- */

/* Estilo para op√ß√£o selecionada (Ainda n√£o confirmada) - Cor Azul Neutra */
.option.selected {
    background: rgba(33, 150, 243, 0.2);
    border: 2px solid #2196f3;
    transform: translateX(10px);
    box-shadow: 0 0 15px rgba(33, 150, 243, 0.3);
}

/* Garante que o VERDE (Correto) sobrescreva o azul */
.option.correct {
    background: rgba(76, 175, 80, 0.2) !important;
    border-color: #4caf50 !important;
    transform: scale(1.02);
}

/* Garante que o VERMELHO (Incorreto) sobrescreva o azul */
.option.incorrect {
    background: rgba(244, 67, 54, 0.2) !important;
    border-color: #f44336 !important;
}

    </style>

    <script>
    window.MathJax = {
        tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']], // Permite usar $f√≥rmula$ no meio do texto
        displayMath: [['$$', '$$'], ['\\[', '\\]']] // Permite usar $$f√≥rmula$$ em linha separada
        },
        svg: {
        fontCache: 'global'
        }
    };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script" async></script>


</head>
<body>
    <div id="a11y-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>
    <canvas id="fireworks-canvas"></canvas>

    <div class="container"> <!-- IN√çCIO DO CONTAINER -->
        
        
        <h1>üéÆ LIAM - Laborat√≥rio Interativo de Alfabetiza√ß√£o Matem√°tica - 9¬∫ Ano üéÆ</h1>
        
<div style="text-align: center;">
    <button class="btn" onclick="openTutorialModal()" style="background: linear-gradient(90deg, #2196f3, #1976d2); margin-top: 10px;">
        üéì Tutorial Inicial
    </button>
    <button class="btn" id="theory-btn" style="background: linear-gradient(90deg, #9c27b0, #673ab7); margin-top: 10px;">
        üìö Revis√£o Te√≥rica
    </button>
    <button class="btn btn-secondary" onclick="showStats()">üìä Ver Estat√≠sticas</button>
    <button class="btn test-fireworks-btn" onclick="testFireworks()" style="margin-top: 10px;">üéÜ Testar Fogos de Artif√≠cio</button>
    <button class="btn" onclick="testAudio()" style="background: linear-gradient(90deg, #5cda2a, #1ead25); margin-top: 10px;">üîä Testar Som</button>
    
    <!-- Novo bot√£o de conquistas -->
    <button class="btn" onclick="toggleAchievements()" style="background: linear-gradient(90deg, #ff9800, #ff5722); margin-top: 10px;">
        üèÜ Conquistas
    </button>

</div>

<!-- Bot√£o de conquistas -->
        <div class="achievement-badge" id="achievement-btn" role="button" tabindex="0" aria-label="Abrir Conquistas">
    üèÜ      <span class="achievement-count" id="achievement-count">0</span>
        </div>
        <!-- Status do jogo -->
        <div class="game-status">
            <div class="status-item">
                <div class="status-label">Tema</div>
                <div class="status-value" id="current-theme">-</div>
            </div>
            <div class="status-item">
                <div class="status-label">Pontua√ß√£o</div>
                <div class="status-value" id="score">0</div>
                <div class="status-subtext" id="streak">Streak: 0</div>
            </div>
            <div class="status-item">
                <div class="status-label">Quest√£o</div>
                <div class="status-value" id="question-counter">0/20</div>
                <div class="status-subtext">Tempo: 60s</div>
            </div>
            <div class="status-item">
                <div class="status-label">N√≠vel</div>
                <div class="status-value" id="level">1</div>
                <div class="status-subtext" id="xp">0/100 XP</div>
            </div>
        </div>
        
        <!-- Barra de progresso do n√≠vel -->
        <div class="level-progress">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span>Progresso do N√≠vel</span>
                <span id="level-percentage">0%</span>
            </div>
            <div class="level-bar">
                <div class="level-fill" id="level-fill"></div>
            </div>
        </div>
        
        <!-- Streak indicator -->
        <div class="streak-indicator" id="streak-indicator">
            üî• Streak: <span id="current-streak">0</span>
        </div>
        
       
        <div class="calculator" id="calculator">
            <div class="calc-header" id="calc-header">
                <div class="calc-title">Calculadora</div>
                <div class="calc-controls">
                    <button id="minimize-calc">‚àí</button>
                    <button id="close-calc">√ó</button>
                </div>
            </div>
            <div class="calc-display">
                <div class="calc-expression" id="calc-expression">0</div>
                <div class="calc-result" id="calc-result">0</div>
            </div>
            <div class="calc-buttons">
                <button class="calc-button clear" onclick="calcClear()">C</button>
                <button class="calc-button clear" onclick="calcClearEntry()">CE</button>
                <button class="calc-button" onclick="calcBackspace()">‚å´</button>
                <button class="calc-button operator" onclick="calcOperator('/')">√∑</button>
                <button class="calc-button operator" onclick="calcSqrt()">‚àö</button>
                
                <button class="calc-button" onclick="calcNumber(7)">7</button>
                <button class="calc-button" onclick="calcNumber(8)">8</button>
                <button class="calc-button" onclick="calcNumber(9)">9</button>
                <button class="calc-button operator" onclick="calcOperator('*')">√ó</button>
                <button class="calc-button operator" onclick="calcPower()">x¬≤</button>
                
                <button class="calc-button" onclick="calcNumber(4)">4</button>
                <button class="calc-button" onclick="calcNumber(5)">5</button>
                <button class="calc-button" onclick="calcNumber(6)">6</button>
                <button class="calc-button operator" onclick="calcOperator('-')">‚àí</button>
                <button class="calc-button operator" onclick="calcPercent()">%</button>
                
                <button class="calc-button" onclick="calcNumber(1)">1</button>
                <button class="calc-button" onclick="calcNumber(2)">2</button>
                <button class="calc-button" onclick="calcNumber(3)">3</button>
                <button class="calc-button operator" onclick="calcOperator('+')">+</button>
                <button class="calc-button" onclick="calcPi()">œÄ</button>
                
                <button class="calc-button" onclick="calcPlusMinus()">¬±</button>
                <button class="calc-button" onclick="calcNumber(0)">0</button>
                <button class="calc-button" onclick="calcDecimal()">.</button>
                <button class="calc-button equals" onclick="calcEquals()">=</button>
            </div>
        </div>
        
        <!-- Timer circular -->
        <div class="timer-container" id="timer-container" style="display: none;">
            <svg width="100" height="100" viewBox="0 0 100 100" class="timer-circle">
                <circle cx="50" cy="50" r="45" class="timer-bg"></circle>
                <circle cx="50" cy="50" r="45" class="timer-progress" id="timer-progress"></circle>
            </svg>
            <div class="timer-text" id="timer-text">60</div>
        </div>
        
        <!-- Tela inicial -->
        <div class="screen" id="start-screen" style="display: block;">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="font-size: 60px; margin-bottom: 20px;">üßÆ</div>
                <h2>Escolha o Tema</h2>
                <p style="color: #bbdefb; max-width: 600px; margin: 0 auto;">Teste seus conhecimentos em Matem√°tica do 9¬∫ ano. Use a calculadora para ajudar nos c√°lculos!</p>
            </div>
            
            <div class="theme-selection">
                <div class="theme-card" data-theme="probabilidade">
                    <div class="theme-icon">üìä</div>
                    <h3>Probabilidade</h3>
                    <p>Eventos dependentes e independentes, c√°lculo de probabilidades</p>
                    <div class="theme-stats">
                        <span>üîì Conclu√≠do: <span id="probabilidade-progress">0%</span></span>
                        <span>üèÜ Recorde: <span id="probabilidade-record">0</span></span>
                    </div>
                </div>
                
                <div class="theme-card" data-theme="estatistica">
                    <div class="theme-icon">üìà</div>
                    <h3>Estat√≠stica</h3>
                    <p>Gr√°ficos, m√©dia, mediana, moda, an√°lise de dados</p>
                    <div class="theme-stats">
                        <span>üîì Conclu√≠do: <span id="estatistica-progress">0%</span></span>
                        <span>üèÜ Recorde: <span id="estatistica-record">0</span></span>
                    </div>
                </div>
            </div>

            <!-- BOT√ÉO INICIAR JOGO ABAIXO DA SELE√á√ÉO DE TEMA -->
<div style="text-align: center; margin: 40px 0;">
    <button class="btn" id="start-btn" style="padding: 20px 50px; font-size: 1.2em;">
        üéÆ Iniciar Jogo
    </button>
</div>
         
 <!-- Power-ups dispon√≠veis -->
            <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 30px 0;">
                <h3 style="color: #ffeb3b; margin-bottom: 15px;">‚ú® Power-ups e Calculadora</h3>
                <div class="power-ups" style="justify-content: center;">
                    <div class="power-up" data-power="hint" title="Dica extra (3 dispon√≠veis)">
                        üí°
                        <div class="power-up-count" id="hint-count">3</div>
                    </div>
                    <div class="power-up" data-power="skip" title="Pular quest√£o (2 dispon√≠veis)">
                        ‚è≠Ô∏è
                        <div class="power-up-count" id="skip-count">2</div>
                    </div>
                    <div class="power-up" data-power="time" title="+10 segundos (1 dispon√≠vel)">
                        ‚è±Ô∏è
                        <div class="power-up-count" id="time-count">1</div>
                    </div>
                    <div class="power-up" data-power="double" title="Pontos em dobro (1 dispon√≠vel)">
                        ‚ú®
                        <div class="power-up-count" id="double-count">1</div>
                    </div>
                    <button class="calc-btn open-calc-btn" id="open-calc" aria-label="Abrir Calculadora" title="Calculadora">
    üî¢
</button>
                </div>
            </div>


            <!-- Configura√ß√µes simplificadas -->
           

<div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 30px 0;">
                <h3 style="color: #ffeb3b; margin-bottom: 15px;">‚öôÔ∏è Configura√ß√µes</h3>
                
                <div style="display: grid; grid-template-columns: 1fr; gap: 15px; max-width: 300px; margin: 0 auto;">
                    
                    <div>
                        <label for="sound-toggle">Sons e Efeitos:</label>
                        <select id="sound-toggle">
                            <option value="true">Ligado üîä</option>
                            <option value="false">Desligado üîá</option>
                        </select>
                    </div>

                    <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;">
                        <button id="reset-progress-btn" class="btn" style="background: linear-gradient(90deg, #d32f2f, #b71c1c); width: 100%; font-size: 14px; padding: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">
                            üóëÔ∏è Apagar Todo o Progresso
                        </button>
                    </div>
                    </div>

                <div style="text-align: center; margin-top: 15px; color: #bbdefb; font-size: 14px;">
                    <p>üìù Cada tema tem 20 quest√µes</p>
                    <p>‚è±Ô∏è Tempo: 60 segundos por quest√£o</p>
                    <p>üéØ Dificuldade: Mista (F√°cil, M√©dio e Dif√≠cil)</p>
                </div>
            </div>



            
           
            
            
        </div>
        
        <!-- Tela de perguntas -->
        <div class="screen" id="question-screen" style="display: none;">
            <div class="question-header">
                <div class="question-number" id="question-number">1</div>
                <div class="question-difficulty" id="question-difficulty">M√©dio</div>
            </div>
            
            <div class="question-card">
                <div class="question-text" id="question-text">
                    Carregando pergunta...
                </div>
                
                <div class="options-grid" id="options-container">
                    <!-- Op√ß√µes ser√£o inseridas aqui -->
                </div>
            </div>
            
            <!-- Power-ups durante o jogo -->
            <div class="power-ups" id="game-power-ups">
                <div class="power-up" data-power="hint" title="Dica extra" onclick="usePowerUp('hint')">
                    üí°
                    <div class="power-up-count" id="game-hint-count">3</div>
                </div>
                <div class="power-up" data-power="skip" title="Pular quest√£o" onclick="usePowerUp('skip')">
                    ‚è≠Ô∏è
                    <div class="power-up-count" id="game-skip-count">2</div>
                </div>
                <div class="power-up" data-power="time" title="+10 segundos" onclick="usePowerUp('time')">
                    ‚è±Ô∏è
                    <div class="power-up-count" id="game-time-count">2</div>
                </div>
                <div class="power-up" data-power="double" title="Pontos em dobro" onclick="usePowerUp('double')">
                    ‚ú®
                    <div class="power-up-count" id="game-double-count">3</div>
                </div>
                
                <!-- Bot√£o da calculadora para as quest√µes -->
                <button class="calc-btn open-calc-btn" id="open-calc-game" aria-label="Abrir Calculadora" title="Calculadora">
                    üî¢
                </button>
                </div>
            </div>
            
            <!-- Feedback -->
            <div class="feedback-card correct" id="correct-feedback">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 30px;">‚úÖ</div>
                    <div>
                        <h3 style="color: #4caf50; margin-bottom: 5px;">Resposta Correta!</h3>
                        <p>Voc√™ ganhou <span id="points-earned">0</span> pontos!</p>
                        <p id="bonus-info" style="font-size: 12px; color: #90caf9;"></p>
                    </div>
                </div>
            </div>
            
            <div class="feedback-card incorrect" id="incorrect-feedback">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 30px;">‚ùå</div>
                    <div>
                        <h3 style="color: #f44336; margin-bottom: 5px;">Resposta Incorreta</h3>
                        <p>A resposta correta √©: <span id="correct-answer"></span></p>
                        <p id="explanation" style="font-size: 14px; margin-top: 10px;"></p>
                    </div>
                </div>
            </div>
            
            <div class="game-controls" style="display: flex; justify-content: center; gap: 20px; margin-top: 30px;">
                <button class="btn" id="next-btn" disabled>Pr√≥xima Quest√£o</button>
                <button class="btn btn-secondary" id="hint-btn" onclick="showHint()">üí° Pedir Dica</button>
            </div>
        </div>
        
        <!-- Tela de resultados -->
        <div class="screen" id="results-screen" style="display: none;">
            <div class="results-container">
                <div class="trophy" id="trophy">üèÜ</div>
                
                <h2 style="margin-bottom: 20px;">Desafio Conclu√≠do!</h2>
                
                <div class="score-display" id="final-score">0%</div>
                <div style="color: #bbdefb; font-size: 18px; margin-bottom: 30px;">Sua pontua√ß√£o final</div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="status-label">Acertos</div>
                        <div class="status-value" id="final-correct">0</div>
                        <div class="status-subtext" id="accuracy">0% de precis√£o</div>
                    </div>
                    <div class="stat-card">
                        <div class="status-label">Pontos</div>
                        <div class="status-value" id="final-points">0</div>
                        <div class="status-subtext" id="bonus-points">+0 b√¥nus</div>
                    </div>
                    <div class="stat-card">
                        <div class="status-label">Tempo M√©dio</div>
                        <div class="status-value" id="avg-time">0s</div>
                        <div class="status-subtext" id="time-saved">-0s com power-ups</div>
                    </div>
                    <div class="stat-card">
                        <div class="status-label">Streak M√°xima</div>
                        <div class="status-value" id="max-streak">0</div>
                        <div class="status-subtext" id="streak-bonus">+0 pontos</div>
                    </div>
                </div>
                
                <!-- Novas conquistas desbloqueadas -->
                <div id="new-achievements" style="display: none; background: rgba(255, 235, 59, 0.1); padding: 20px; border-radius: 15px; margin: 30px 0; border: 2px solid #ffeb3b;">
                    <h3 style="color: #ffeb3b; margin-bottom: 15px;">üéâ Novas Conquistas!</h3>
                    <div id="achievements-unlocked"></div>
                </div>
                
                <!-- Resumo das respostas -->
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 30px 0;">
                    <h3 style="color: #ffeb3b; margin-bottom: 15px;">üìã Resumo das Respostas</h3>
                    <div id="answers-summary" style="max-height: 300px; overflow-y: auto; padding-right: 10px;">
                        <!-- Resumo ser√° inserido aqui -->
                    </div>
                </div>
                
                <!-- Gr√°fico de desempenho -->
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 30px 0;">
                    <h3 style="color: #ffeb3b; margin-bottom: 15px;">üìä Seu Desempenho</h3>
                    <canvas id="performance-chart" width="400" height="200" style="width: 100%; max-width: 600px; margin: 0 auto;"></canvas>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" id="restart-btn">üîÑ Jogar Novamente</button>
                    <button class="btn btn-secondary" id="change-theme-btn">üéØ Mudar Tema</button>
                    <button class="btn" onclick="shareResults()" style="background: linear-gradient(90deg, #2196f3, #1976d2);">üì§ Compartilhar</button>
                    <button class="btn" id="download-stats-btn" style="background: linear-gradient(90deg, #4caf50, #2e7d32);">üì• Baixar Estat√≠sticas</button>
                </div>
            </div>
        </div>
        
        <!-- FOOTER APRIMORADO -->
        <footer class="game-footer">
            <div class="footer-content">
                <h2 class="footer-title"><i class="fas fa-graduation-cap"></i> Projeto Integrador IV</h2>
                
                <div class="math-formulas">
                    <div class="math-formula">œÄ</div>
                    <div class="math-formula">‚àë</div>
                    <div class="math-formula">‚à´</div>
                    <div class="math-formula">‚àö</div>
                    <div class="math-formula">‚àû</div>
                </div>
                
                <div class="footer-links">
                    <a href="#" class="footer-link">
                        <i class="fas fa-university"></i>
                        <span>UNIVESP</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-book"></i>
                        <span>BNCC Matem√°tica</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Licenciatura em Matem√°tica</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-chart-bar"></i>
                        <span>Estat√≠stica</span>
                    </a>
                    <a href="#" class="footer-link">
                        <i class="fas fa-percentage"></i>
                        <span>Probabilidade</span>
                    </a>
                </div>
                
                <a href="https://github.com/profsergioericmatematica/Projeto-Integrador-IV" class="github-link" target="_blank">
                    <i class="fab fa-github"></i>
                    <span>C√≥digo dispon√≠vel no GitHub</span>
                </a>
                
                <div class="copyright">
                    <p>¬© 2026 Antonio Antunes Junior, Fl√°vio Rabelo Barros, Giovani Machado de Lima, Mariane Mendes Coutinho, Priscilla Santiago Zamorra, Rodrigo Aires de Medeiros Correa, Sergio Eric Reis de Oliveira e Vitor Correa Uberti</p>
                    <p>Projeto Integrador IV - Licenciatura em Matem√°tica - UNIVESP</p>
                    <p>Licenciado sob MIT License | C√≥digo dispon√≠vel em GitHub</p>
                </div>
            </div>
        </footer>
    </div>

<!-- Modal de Conquistas FORA DO CONTAINER (CORRETO!) -->
<div class="achievements-modal" id="achievements-modal">
    <div class="modal-overlay" onclick="closeAchievements()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 style="color: #ffeb3b;">üèÜ Conquistas</h3>
            <button class="modal-close" onclick="closeAchievements()">&times;</button>
        </div>
        <div class="modal-body">
            <div id="achievements-list">
                <!-- Conquistas ser√£o adicionadas aqui -->
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn" onclick="closeAchievements()" style="width: 100%;">Fechar</button>
        </div>
    </div>
</div>

<!-- Modal de escolha de revis√£o -->
<div class="theory-modal" id="theory-modal">
    <div class="modal-overlay" onclick="closeTheoryModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 style="color: #ffeb3b;">üìö Escolha o Tema da Revis√£o</h3>
            <button class="modal-close" onclick="closeTheoryModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px;">
                <button class="theme-choice-btn" data-theory="probabilidade">
                    <div style="font-size: 40px;">üìä</div>
                    <h4>Probabilidade</h4>
                    <p>Revise conceitos de probabilidade para ajudar nas quest√µes.</p>
                </button>
                <button class="theme-choice-btn" data-theory="estatistica">
                    <div style="font-size: 40px;">üìà</div>
                    <h4>Estat√≠stica</h4>
                    <p>Revise conceitos de estat√≠stica para ajudar nas quest√µes.</p>
                </button>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeTheoryModal()" style="width: 100%;">Fechar</button>
        </div>
    </div>
</div>

<!-- Modal de Revis√£o de Probabilidade -->
<div class="theory-content-modal" id="probabilidade-modal">
    <div class="modal-overlay" onclick="closeTheoryContentModal('probabilidade')"></div>
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3 style="color: #ffeb3b;">üìä Revis√£o de Probabilidade</h3>
            <button class="modal-close" onclick="closeTheoryContentModal('probabilidade')">&times;</button>
        </div>
        <div class="modal-body">
            <div style="max-height: 60vh; overflow-y: auto; padding-right: 10px;">
                <h4>Conceitos B√°sicos</h4>
                <p><strong>Probabilidade</strong> √© a chance de um evento ocorrer.</p>
                <p>Espa√ßo amostral (S) √© o conjunto de todos os resultados poss√≠veis de um experimento aleat√≥rio.</p>
                <p>Evento (E) √© um subconjunto do espa√ßo amostral.</p>
                
                <h4>C√°lculo de Probabilidade</h4>
                <p>A probabilidade de um evento E ocorrer √© dada por:</p>
                <p style="text-align: center; font-size: 1.2em;">P(E) = n√∫mero de casos favor√°veis / n√∫mero de casos poss√≠veis</p>
                
                <h4>Exemplo</h4>
                <p>Jogar um dado: espa√ßo amostral S = {1,2,3,4,5,6}</p>
                <p>Evento "sair um n√∫mero par": E = {2,4,6}</p>
                <p>P(E) = 3/6 = 1/2 = 50%</p>
                
                <h4>Eventos Independentes</h4>
                <p>Dois eventos s√£o independentes quando a ocorr√™ncia de um n√£o afeta a probabilidade do outro.</p>
                <p>Exemplo: jogar uma moeda duas vezes. O resultado da primeira jogada n√£o afeta a segunda.</p>
                
                <h4>Eventos Dependentes</h4>
                <p>Dois eventos s√£o dependentes quando a ocorr√™ncia de um afeta a probabilidade do outro.</p>
                <p>Exemplo: tirar duas cartas de um baralho sem reposi√ß√£o. A segunda carta depende da primeira.</p>
                
                <h4>Probabilidade Condicional</h4>
                <p>√â a probabilidade de um evento ocorrer dado que outro evento j√° ocorreu.</p>
                <p>Nota√ß√£o: P(A|B) - probabilidade de A dado B.</p>
                
                <h4>Dicas para as Quest√µes</h4>
                <ul>
                    <li>Identifique sempre o espa√ßo amostral (total de possibilidades)</li>
                    <li>Conte cuidadosamente os casos favor√°veis</li>
                    <li>Para moedas e dados, lembre que todos os lados t√™m igual chance</li>
                    <li>Probabilidade varia de 0 (imposs√≠vel) a 1 (certo), ou 0% a 100%</li>
                    <li>A soma das probabilidades de todos os resultados poss√≠veis √© sempre 1</li>
                </ul>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeTheoryContentModal('probabilidade')" style="width: 100%;">Fechar</button>
        </div>
    </div>
</div>

<!-- Modal de Revis√£o de Estat√≠stica -->
<div class="theory-content-modal" id="estatistica-modal">
    <div class="modal-overlay" onclick="closeTheoryContentModal('estatistica')"></div>
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3 style="color: #ffeb3b;">üìà Revis√£o de Estat√≠stica</h3>
            <button class="modal-close" onclick="closeTheoryContentModal('estatistica')">&times;</button>
        </div>
        <div class="modal-body">
            <div style="max-height: 60vh; overflow-y: auto; padding-right: 10px;">
                <h4>Conceitos B√°sicos</h4>
                <p><strong>Estat√≠stica</strong> √© a ci√™ncia que coleta, organiza, analisa e interpreta dados.</p>
                
                <h4>Medidas de Tend√™ncia Central</h4>
                <p><strong>M√©dia Aritm√©tica:</strong> Soma de todos os valores dividida pelo n√∫mero de valores.</p>
                <p>F√≥rmula: M√©dia = (x‚ÇÅ + x‚ÇÇ + ... + x‚Çô) / n</p>
                <p>Exemplo: notas 5, 6, 7 ‚Üí m√©dia = (5+6+7)/3 = 6</p>
                
                <p><strong>Mediana:</strong> Valor que divide o conjunto de dados ordenados ao meio.</p>
                <p>Como calcular: 1) Ordene os dados; 2) Encontre o valor do meio.</p>
                <p>Exemplo: 1, 3, 3, 6, 7, 8, 9 ‚Üí mediana = 6</p>
                <p>Se houver n√∫mero par de valores, mediana √© a m√©dia dos dois centrais.</p>
                <p>Exemplo: 1, 2, 3, 4 ‚Üí mediana = (2+3)/2 = 2,5</p>
                
                <p><strong>Moda:</strong> Valor que aparece com maior frequ√™ncia.</p>
                <p>Exemplo: 1, 2, 2, 3, 4 ‚Üí moda = 2</p>
                
                <h4>Gr√°ficos</h4>
                <p><strong>Gr√°fico de Barras:</strong> Usado para comparar quantidades entre categorias.</p>
                <p><strong>Gr√°fico de Linhas:</strong> Usado para mostrar tend√™ncias ao longo do tempo.</p>
                <p><strong>Gr√°fico de Setores (Pizza):</strong> Usado para mostrar partes de um todo.</p>
                <p><strong>Histograma:</strong> Gr√°fico de barras para dados agrupados em intervalos.</p>
                
                <h4>Medidas de Dispers√£o</h4>
                <p><strong>Amplitude:</strong> Diferen√ßa entre o maior e o menor valor.</p>
                <p>F√≥rmula: Amplitude = valor m√°ximo - valor m√≠nimo</p>
                <p>Exemplo: no conjunto {2, 5, 8, 10}, amplitude = 10 - 2 = 8</p>
                
                <h4>Popula√ß√£o e Amostra</h4>
                <p><strong>Popula√ß√£o:</strong> Conjunto completo de elementos a ser estudado.</p>
                <p><strong>Amostra:</strong> Subconjunto da popula√ß√£o (parte selecionada para estudo).</p>
                <p>Exemplo: Pesquisa eleitoral: popula√ß√£o = todos os eleitores, amostra = parte dos eleitores entrevistados.</p>
                
                <h4>Dicas para as Quest√µes</h4>
                <ul>
                    <li>M√©dia: some todos e divida pela quantidade</li>
                    <li>Mediana: primeiro ORDENE os dados, depois ache o meio</li>
                    <li>Moda: √© o valor que mais se repete</li>
                    <li>Para gr√°ficos de pizza: o c√≠rculo inteiro = 100%</li>
                    <li>Dados qualitativos (cores, nomes) s√≥ t√™m moda, n√£o m√©dia</li>
                    <li>Amplitude mostra a varia√ß√£o dos dados</li>
                </ul>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeTheoryContentModal('estatistica')" style="width: 100%;">Fechar</button>
        </div>
    </div>
</div>


<!-- Modal do Tutorial -->
<div class="tutorial-modal" id="tutorial-modal">
    <div class="modal-overlay" onclick="closeTutorialModal()"></div>
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h3 style="color: #ffeb3b;">üéì Tutorial - LIAM - Laborat√≥rio Interativo de Alfabetiza√ß√£o Matem√°tica</h3>
            <button class="modal-close" onclick="closeTutorialModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div style="max-height: 70vh; overflow-y: auto; padding-right: 10px;">
                
                <!-- Se√ß√£o: Sobre o Projeto -->
                <div style="background: rgba(33, 150, 243, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #2196f3;">
                    <h4 style="color: #2196f3; margin-bottom: 15px;">üìã Sobre o Projeto</h4>
                    <p><strong>LIAM - Laborat√≥rio Interativo de Alfabetiza√ß√£o Matem√°tica</strong> √© um jogo educativo desenvolvido como parte do <strong>Projeto Integrador IV</strong> da Licenciatura em Matem√°tica da UNIVESP.</p>
                    <p><strong>Objetivo:</strong> Auxiliar estudantes do 9¬∫ ano do Ensino Fundamental no aprendizado de Probabilidade e Estat√≠stica, tornando o estudo mais interativo, divertido e eficaz.</p>
                    <p><strong>P√∫blico-alvo:</strong> Alunos do 9¬∫ ano, professores de matem√°tica e qualquer pessoa interessada em refor√ßar seus conhecimentos matem√°ticos.</p>
                </div>
                
                <!-- Se√ß√£o: Desenvolvedores -->
                <div style="background: rgba(76, 175, 80, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #4caf50;">
                    <h4 style="color: #4caf50; margin-bottom: 15px;">üë• Equipe de Desenvolvimento</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüíª</div>
                            <strong>Antonio Antunes Junior</strong>
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüíª</div>
                            <strong>Fl√°vio Rabelo Barros</strong>
                        </div>
                        
                                            
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüíª</div>
                            <strong>Giovani Machado de Lima</strong>
                        </div>


                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüíª</div>
                            <strong>Mariane Mendes Coutinho</strong>
                        </div>

                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë©‚Äçüíª</div>
                            <strong>Priscilla Santiago Zamorra</strong>
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüíª</div>
                            <strong>Rodrigo Aires de Medeiros Correa</strong>
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüè´</div>
                            <strong>Sergio Eric Reis de Oliveira</strong>
                        </div>
                        <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px;">
                            <div style="font-size: 24px; margin-bottom: 10px;">üë®‚Äçüíª</div>
                            <strong>Vitor Correa Uberti</strong>
                        </div>
                    </div>
                    <p style="margin-top: 15px; font-size: 14px; color: #bbdefb;">Projeto Integrador IV - Licenciatura em Matem√°tica - UNIVESP - 2026</p>
                </div>
                
                <!-- Se√ß√£o: Como Jogar -->
                <div style="background: rgba(255, 152, 0, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #ff9800;">
                    <h4 style="color: #ff9800; margin-bottom: 15px;">üéÆ Como Jogar</h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                        <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 40px; margin-bottom: 15px;">1Ô∏è‚É£</div>
                            <h5 style="color: #ffeb3b;">Escolha o Tema</h5>
                            <p style="font-size: 14px;">Selecione entre <strong>Probabilidade</strong> ou <strong>Estat√≠stica</strong>. Cada tema tem 20 quest√µes.</p>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 40px; margin-bottom: 15px;">2Ô∏è‚É£</div>
                            <h5 style="color: #ffeb3b;">Responda as Quest√µes</h5>
                            <p style="font-size: 14px;">Voc√™ tem <strong>60 segundos</strong> por quest√£o. Selecione a alternativa correta.</p>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 40px; margin-bottom: 15px;">3Ô∏è‚É£</div>
                            <h5 style="color: #ffeb3b;">Use Power-ups</h5>
                            <p style="font-size: 14px;">Utilize dicas, pule quest√µes, ganhe tempo extra ou ative pontos em dobro!</p>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 40px; margin-bottom: 15px;">4Ô∏è‚É£</div>
                            <h5 style="color: #ffeb3b;">Acompanhe Seu Progresso</h5>
                            <p style="font-size: 14px;">Ganhe XP, suba de n√≠vel e desbloqueie conquistas!</p>
                        </div>
                    </div>
                </div>
                
                <!-- Se√ß√£o: Sistema de Pontua√ß√£o -->
                <div style="background: rgba(156, 39, 176, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #9c27b0;">
                    <h4 style="color: #9c27b0; margin-bottom: 15px;">üèÖ Sistema de Pontua√ß√£o</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 30px; color: #4caf50;">10</div>
                            <p style="font-size: 14px;"><strong>Quest√µes F√°ceis</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px; color: #ff9800;">15</div>
                            <p style="font-size: 14px;"><strong>Quest√µes M√©dias</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px; color: #f44336;">20</div>
                            <p style="font-size: 14px;"><strong>Quest√µes Dif√≠ceis</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px; color: #ffeb3b;">+5</div>
                            <p style="font-size: 14px;"><strong>B√¥nus por Velocidade</strong><br>(resposta em <10s)</p>
                        </div>
                    </div>
                    <p style="margin-top: 15px; font-size: 14px;"><strong>Streak Bonus:</strong> A cada 3 acertos consecutivos, ganhe +5 pontos adicionais!</p>
                </div>
                
                <!-- Se√ß√£o: Recursos Dispon√≠veis -->
                <div style="background: rgba(0, 150, 136, 0.1); padding: 20px; border-radius: 10px; border-left: 5px solid #009688;">
                    <h4 style="color: #009688; margin-bottom: 15px;">üõ†Ô∏è Recursos Dispon√≠veis</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üßÆ</div>
                            <p><strong>Calculadora</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üìö</div>
                            <p><strong>Revis√£o Te√≥rica</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üí°</div>
                            <p><strong>Dicas</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üèÜ</div>
                            <p><strong>Conquistas</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üìä</div>
                            <p><strong>Estat√≠sticas</strong></p>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 30px;">üéÜ</div>
                            <p><strong>Efeitos Visuais</strong></p>
                        </div>
                    </div>
                </div>
                
                <!-- Se√ß√£o: Dicas Importantes -->
                <div style="background: rgba(244, 67, 54, 0.1); padding: 20px; border-radius: 10px; margin-top: 25px; border-left: 5px solid #f44336;">
                    <h4 style="color: #f44336; margin-bottom: 15px;">üí° Dicas Importantes</h4>
                    <ul style="margin-left: 20px;">
                        <li>Use a <strong>calculadora</strong> para ajudar nos c√°lculos complexos</li>
                        <li>Consulte a <strong>revis√£o te√≥rica</strong> se tiver d√∫vidas sobre os conceitos</li>
                        <li>Administre bem seus <strong>power-ups</strong> - use-os estrategicamente</li>
                        <li>Pratique ambos os temas para dominar Probabilidade e Estat√≠stica</li>
                        <li>Preste aten√ß√£o ao <strong>tempo</strong> - cada quest√£o tem 60 segundos</li>
                        <li>Quanto mais r√°pido responder corretamente, mais pontos ganha!</li>
                    </ul>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeTutorialModal()" style="width: 100%; background: linear-gradient(90deg, #2196f3, #1976d2);">Fechar Tutorial</button>
        </div>
    </div>
</div>

    <!-- √Åudio para efeitos sonoros - URLs alternativas -->
    <audio id="correct-sound" preload="auto">
        <source src="https://actions.google.com/sounds/v1/foley/firecrackers_exploding.ogg" type="audio/ogg">

        <!-- <source src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_12b0c7443c.mp3" type="audio/mpeg">   -->  
    </audio>
    
    <audio id="incorrect-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="level-up-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="achievement-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-trumpet-2018.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="powerup-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-magic-sparkles-300.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Som de fogos de artif√≠cio - URLs alternativas -->
    <audio id="firework-sound" preload="auto">
       <!--  <source src="https://assets.mixkit.co/sfx/preview/mixkit-fireworks-show-audio-3065.mp3" type="audio/mpeg"> -->
        <!-- <source src="https://cdn.pixabay.com/download/audio/2022/01/18/audio_82173f40f0.mp3" type="audio/mpeg"> -->

       <source src="https://cdn.pixabay.com/download/audio/2022/03/10/audio_5b6623642d.mp3"  type="audio/mpeg">
    </audio>

    <!-- Biblioteca Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>






    <script>
        // ================ DADOS DO JOGO ================
        const gameData = {
            theme: null,
            currentQuestion: 0,
            isQuestionAnswered: false,
            score: 0,
            correctAnswers: 0,
            totalQuestions: 20, // Fixo: 20 quest√µes
            questions: [],
            userAnswers: [],
            currentStreak: 0,
            maxStreak: 0,
            startTime: null,
            questionTimes: [],
            powerUps: {
                hint: { count: 3, used: 0 },
                skip: { count: 2, used: 0 },
                time: { count: 2, used: 0 },
                double: { count: 3, used: 0 }
            },
            xp: 0,
            level: 1,
            xpToNextLevel: 100,
            achievements: [],
            settings: {
                sound: true
            },
            timer: null,
            timeLeft: 60, // Fixo: 60 segundos
            doublePointsActive: false
        };

        // ================ DADOS DA CALCULADORA ================
        let calcData = {
            display: '0',
            expression: '0',
            firstNum: null,
            operator: null,
            waitingForSecond: false
        };

        // ================ CONQUISTAS ================
        const achievements = [
            { id: 'first_game', name: 'Primeiro Jogo', description: 'Complete seu primeiro jogo', icon: 'üéÆ', unlocked: false, xp: 50 },
            { id: 'perfect_score', name: 'Perfei√ß√£o', description: 'Acertar 100% das quest√µes', icon: 'üíØ', unlocked: false, xp: 100 },
            { id: 'speed_demon', name: 'Dem√¥nio da Velocidade', description: 'Responder todas em menos de 30s cada', icon: '‚ö°', unlocked: false, xp: 75 },
            { id: 'streak_master', name: 'Mestre da Sequ√™ncia', description: 'Alcan√ßar streak de 10 acertos', icon: 'üî•', unlocked: false, xp: 80 },
            { id: 'power_user', name: 'Usu√°rio de Power-ups', description: 'Usar todos os power-ups em um jogo', icon: '‚ú®', unlocked: false, xp: 60 },
            { id: 'calculator_pro', name: 'Profissional da Calculadora', description: 'Usar calculadora 10 vezes', icon: 'üßÆ', unlocked: false, xp: 40 },
            { id: 'theme_master', name: 'Mestre dos Temas', description: 'Completar todos os temas', icon: 'üëë', unlocked: false, xp: 150 },
            { id: 'level_10', name: 'N√≠vel 10', description: 'Alcan√ßar o n√≠vel 10', icon: 'üåü', unlocked: false, xp: 200 },
            { id: 'hint_saver', name: 'Economizador de Dicas', description: 'Completar jogo sem usar dicas', icon: 'üí°', unlocked: false, xp: 70 },
            { id: 'persistent', name: 'Persistente', description: 'Jogar 5 vezes', icon: 'üí™', unlocked: false, xp: 90 }
        ];

// ================ BANCO DE QUEST√ïES (20 Probabilidade + 20 Estat√≠stica) ================
       
const questions = {
    probabilidade: [
        // --- N√≠vel B√°sico (Intui√ß√£o) ---
        {
            question: "Se voc√™ jogar uma moeda comum para o alto, qual a chance de cair 'Cara'?",
            options: ["100% (Certeza)", "25%", "50% (Metade)", "0% (Imposs√≠vel)"],
            correct: 2,
            hint: "A moeda s√≥ tem dois lados iguais: cara e coroa.",
            explanation: "Como s√£o apenas 2 possibilidades iguais, a chance √© 1 em 2, ou seja, metade (50%).",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Em um dado comum de 6 lados, qual a chance de sair o n√∫mero 7?",
            options: ["0% (Imposs√≠vel)", "100%", "50%", "10%"],
            correct: 0,
            hint: "Olhe para um dado comum. Qual √© o maior n√∫mero que aparece nele?",
            explanation: "O dado s√≥ vai at√© o n√∫mero 6. Sair o n√∫mero 7 √© imposs√≠vel, por isso a chance √© 0%.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Uma urna tem 10 bolas: 9 brancas e 1 vermelha. Se voc√™ pegar uma sem olhar, o que √© mais prov√°vel?",
            options: ["Pegar a vermelha", "As chances s√£o iguais", "Nenhuma das anteriores", "Pegar a branca"],
            correct: 3,
            hint: "Pense em qual cor tem em maior quantidade dentro da urna.",
            explanation: "Como h√° muito mais bolas brancas (9) do que vermelhas (1), a chance de pegar uma branca √© muito maior.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Qual a probabilidade de tirar um n√∫mero PAR ao jogar um dado?",
            options: ["\\(\\frac{1}{6}\\)", "\\(\\frac{1}{2}\\)", "\\(\\frac{1}{3}\\)", "\\(\\frac{5}{6}\\)"],
            correct: 1,
            hint: "Os n√∫meros pares no dado s√£o 2, 4 e 6. Isso representa metade dos n√∫meros.",
            explanation: "S√£o 3 n√∫meros pares (2, 4, 6) em um total de 6 n√∫meros. \\(\\frac{3}{6}\\) simplificando √© igual a \\(\\frac{1}{2}\\) (metade).",
            difficulty: "easy",
            points: 10
        },
        {
            question: "O sorteio de uma rifa tem 100 n√∫meros. Se voc√™ comprou 1 n√∫mero, qual sua chance de ganhar?",
            options: ["50 em 100", "1 em 10", "1 em 100", "100 em 1"],
            correct: 2,
            hint: "Voc√™ tem apenas um bilhete contra o total de bilhetes da rifa.",
            explanation: "Sua chance √© de 1 bilhete favor√°vel (o seu) dividido pelo total de 100 bilhetes: \\(\\frac{1}{100}\\).",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Se a previs√£o do tempo diz que h√° 100% de chance de chuva, isso significa que:",
            options: ["Com certeza vai chover", "Talvez chova", "√â imposs√≠vel chover", "Vai chover pouco"],
            correct: 0,
            hint: "100% representa o total, a certeza completa.",
            explanation: "Na probabilidade, 100% (ou 1) representa um 'evento certo', ou seja, temos certeza absoluta que vai acontecer.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Escolhendo ao acaso uma letra da palavra 'ESCOLA', qual a chance de ser a letra 'A'?",
            options: ["\\(\\frac{1}{5}\\)", "\\(\\frac{2}{6}\\)", "\\(\\frac{1}{2}\\)", "\\(\\frac{1}{6}\\)"],
            correct: 3,
            hint: "Conte quantas letras tem a palavra ESCOLA no total e quantas s√£o a letra 'A'.",
            explanation: "A palavra E-S-C-O-L-A tem 6 letras no total. Apenas uma delas √© 'A'. Logo, a chance √© \\(\\frac{1}{6}\\).",
            difficulty: "easy",
            points: 10
        },
        // --- N√≠vel M√©dio (C√°lculos Simples) ---
        {
            question: "Em uma caixa h√° 3 bolas Azuis e 2 Vermelhas. Qual a chance de pegar uma Azul?",
            options: ["\\(\\frac{3}{5}\\)", "\\(\\frac{2}{5}\\)", "\\(\\frac{1}{2}\\)", "\\(\\frac{3}{2}\\)"],
            correct: 0,
            hint: "Primeiro, some todas as bolas para saber o total na caixa.",
            explanation: "Total de bolas = 3 azuis + 2 vermelhas = 5. Como queremos as azuis (3), a chance √© \\(\\frac{3}{5}\\).",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Qual a probabilidade de escolher um dia da semana que comece com a letra 'S'?",
            options: ["\\(\\frac{1}{7}\\)", "\\(\\frac{3}{7}\\)", "\\(\\frac{2}{7}\\)", "\\(\\frac{5}{7}\\)"],
            correct: 1,
            hint: "Os dias s√£o: Domingo, Segunda, Ter√ßa, Quarta, Quinta, Sexta, S√°bado. Quantos come√ßam com S?",
            explanation: "Os dias com S s√£o: Segunda, Sexta e S√°bado (3 dias). O total de dias √© 7. Probabilidade = \\(\\frac{3}{7}\\).",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Se voc√™ jogar dois dados e somar os n√∫meros, qual soma √© IMPOSS√çVEL de acontecer?",
            options: ["12", "7", "2", "1"],
            correct: 3,
            hint: "O menor n√∫mero em cada dado √© 1. Qual a menor soma poss√≠vel?",
            explanation: "O m√≠nimo que se pode tirar √© 1 em cada dado, somando 1+1=2. Portanto, obter soma 1 √© imposs√≠vel.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Uma prova tem 4 quest√µes de m√∫ltipla escolha (A, B, C, D). Se chutar uma, qual a chance de acertar?",
            options: ["50%", "10%", "25%", "75%"],
            correct: 2,
            hint: "Existe apenas uma op√ß√£o correta entre as quatro poss√≠veis.",
            explanation: "1 chance em 4 √© igual a \\(\\frac{1}{4}\\). Em porcentagem: 100% dividido por 4 √© igual a 25%.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Em um baralho comum, qual naipe tem mais cartas?",
            options: ["Copas", "Todos t√™m a mesma quantidade", "Espadas", "Ouros"],
            correct: 1,
            hint: "Um baralho padr√£o √© dividido igualmente entre os s√≠mbolos.",
            explanation: "Um baralho √© dividido igualmente em 4 naipes. A probabilidade de tirar qualquer naipe √© a mesma.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Se a chance de chover √© 30%, qual √© a chance de N√ÉO chover?",
            options: ["70%", "30%", "50%", "100%"],
            correct: 0,
            hint: "A soma das chances de acontecer (chuva) e n√£o acontecer (sol) deve ser 100%.",
            explanation: "O total √© 100%. Se tirarmos os 30% de chuva, sobra 70% para n√£o chover (100 - 30 = 70).",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Lan√ßando uma moeda 2 vezes, qual a chance de sair 'Cara' nas duas vezes?",
            options: ["\\(\\frac{1}{2}\\)", "\\(\\frac{1}{3}\\)", "\\(\\frac{1}{8}\\)", "\\(\\frac{1}{4}\\)"],
            correct: 3,
            hint: "As op√ß√µes s√£o: Cara-Cara, Cara-Coroa, Coroa-Cara, Coroa-Coroa.",
            explanation: "H√° 4 combina√ß√µes poss√≠veis. Apenas uma serve (Cara-Cara). Logo, \\(\\frac{1}{4}\\).",
            difficulty: "medium",
            points: 15
        },
        // --- N√≠vel Dif√≠cil (Racioc√≠nio L√≥gico) ---
        {
            question: "Uma caixa tem 5 bolas: 1 Amarela, 1 Azul, 1 Verde, 1 Branca, 1 Preta. Qual a chance de N√ÉO pegar a preta?",
            options: ["\\(\\frac{1}{5}\\)", "\\(\\frac{1}{2}\\)", "\\(\\frac{4}{5}\\)", "\\(\\frac{3}{5}\\)"],
            correct: 2,
            hint: "Quantas bolas sobram se excluirmos a bola preta?",
            explanation: "Existem 4 bolas que n√£o s√£o pretas num total de 5. Probabilidade = \\(\\frac{4}{5}\\).",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Se eu tenho 3 camisas e 2 cal√ßas, de quantas formas diferentes posso me vestir?",
            options: ["6", "5", "3", "2"],
            correct: 0,
            hint: "Para cada uma das 3 camisas, voc√™ pode usar 2 cal√ßas diferentes. Tente multiplicar.",
            explanation: "Pelo princ√≠pio multiplicativo: 3 camisas √ó 2 cal√ßas = 6 combina√ß√µes diferentes de roupa.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Em um jogo, voc√™ ganha se tirar um n√∫mero maior que 4 no dado. Qual sua chance?",
            options: ["\\(\\frac{1}{6}\\)", "\\(\\frac{2}{6}\\)", "\\(\\frac{1}{2}\\)", "\\(\\frac{4}{6}\\)"],
            correct: 1,
            hint: "Quais n√∫meros no dado s√£o maiores que 4?",
            explanation: "Os n√∫meros maiores que 4 s√£o o 5 e o 6. S√£o 2 n√∫meros favor√°veis em 6 poss√≠veis (\\(\\frac{2}{6}\\) ou \\(\\frac{1}{3}\\)).",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Qual a chance de tirar um n√∫mero PRIMO em um dado (2, 3, 5)?",
            options: ["20%", "30%", "50%", "60%"],
            correct: 2,
            hint: "Conte quantos n√∫meros primos existem at√© 6 (o 2, o 3 e o 5).",
            explanation: "Os primos no dado s√£o 2, 3 e 5. S√£o 3 n√∫meros em 6 totais. \\(\\frac{3}{6}\\) √© igual a metade, ou 50%.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Se voc√™ retirar uma carta de um baralho de 52 cartas, √© mais prov√°vel sair:",
            options: ["Um Rei", "Um √Ås vermelho", "O 7 de Ouros", "Uma carta de Copas"],
            correct: 3,
            hint: "Pense na quantidade de cada tipo. Existem 4 Reis, 2 √Åses vermelhos, 1 sete de ouros e 13 cartas de Copas.",
            explanation: "Existem 13 cartas de Copas, o que √© maior quantidade que Reis (4), √Åses vermelhos (2) ou 7 de Ouros (1).",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Em um sorteio entre 10 meninos e 15 meninas, qual a chance de o vencedor ser menino?",
            options: ["\\(\\frac{10}{25}\\)", "\\(\\frac{10}{15}\\)", "\\(\\frac{15}{25}\\)", "\\(\\frac{1}{2}\\)"],
            correct: 0,
            hint: "Lembre-se de somar meninos e meninas para achar o total de alunos.",
            explanation: "Total de alunos = 10 + 15 = 25. Meninos = 10. Probabilidade = \\(\\frac{10}{25}\\) (meninos sobre o total).",
            difficulty: "hard",
            points: 20
        }
    ],
    estatistica: [
        // --- N√≠vel B√°sico (Leitura e Conceitos) ---
        {
            question: "O que √© uma 'Pesquisa Censit√°ria' (Censo)?",
            options: ["Entrevistar algumas pessoas", "Adivinhar os dados", "Entrevistar TODA a popula√ß√£o", "Fazer um sorteio"],
            correct: 2,
            hint: "Lembre-se do Censo do IBGE, que tenta contar todos os brasileiros.",
            explanation: "Censo √© quando coletamos dados de 100% dos indiv√≠duos de um grupo ou popula√ß√£o, sem deixar ningu√©m de fora.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Para descobrir qual o sabor de sorvete favorito da turma, qual a melhor pergunta?",
            options: ["Qual seu sabor favorito?", "Voc√™ gosta de sorvete?", "Voc√™ gosta de chocolate?", "Quanto custa o sorvete?"],
            correct: 0,
            hint: "A pergunta deve permitir v√°rias respostas diferentes sobre sabores.",
            explanation: "Perguntar 'Qual seu sabor favorito?' permite coletar os dados variados (morango, chocolate, creme...) para fazer a estat√≠stica.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Em um gr√°fico de barras, o que a altura da barra geralmente representa?",
            options: ["A beleza do gr√°fico", "A largura dos dados", "A cor dos dados", "A quantidade ou frequ√™ncia"],
            correct: 3,
            hint: "Quanto mais alta a barra, mais gente escolheu aquela op√ß√£o.",
            explanation: "A altura (ou comprimento) da barra indica a frequ√™ncia ou quantidade daquela categoria (quantos votos ela teve).",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Se 5 alunos tiraram nota 10, dizemos que a FREQU√äNCIA da nota 10 √©:",
            options: ["10", "5", "50", "1"],
            correct: 1,
            hint: "Frequ√™ncia √© a quantidade de vezes que algo aconteceu.",
            explanation: "Frequ√™ncia absoluta √© o n√∫mero de vezes que o dado aparece. Se 5 alunos tiraram 10, a frequ√™ncia √© 5.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Qual gr√°fico usa 'fatias' para representar as partes de um todo?",
            options: ["Gr√°fico de Pizza (Setores)", "Gr√°fico de Linhas", "Gr√°fico de Barras", "Histograma"],
            correct: 0,
            hint: "Tem o formato de uma comida redonda dividida.",
            explanation: "O gr√°fico de setores √© popularmente conhecido como gr√°fico de pizza porque suas fatias representam partes do total.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "Jo√£o tirou notas 5, 5 e 5. Qual √© a m√©dia dele?",
            options: ["15", "3", "5", "10"],
            correct: 2,
            hint: "Se todas as notas s√£o iguais, a m√©dia √© esse mesmo valor.",
            explanation: "A m√©dia de valores iguais √© o pr√≥prio valor. (5+5+5) dividido por 3 √© igual a 5.",
            difficulty: "easy",
            points: 10
        },
        {
            question: "O que √© 'Amostra' em uma pesquisa?",
            options: ["Toda a popula√ß√£o", "O resultado final", "O gr√°fico", "Uma parte pequena escolhida para representar o todo"],
            correct: 3,
            hint: "√â como quando voc√™ prova um pedacinho do bolo para ver se est√° bom, sem comer o bolo inteiro.",
            explanation: "Amostra √© um pequeno grupo selecionado da popula√ß√£o para a pesquisa, pois muitas vezes √© imposs√≠vel perguntar a todos.",
            difficulty: "easy",
            points: 10
        },
        // --- N√≠vel M√©dio (Moda, M√©dia, Mediana) ---
        {
            question: "Observe os n√∫meros: 2, 5, 8, 5, 9. Qual √© a MODA?",
            options: ["5", "2", "8", "9"],
            correct: 0,
            hint: "Moda √© o que est√° 'na moda', ou seja, o que aparece mais vezes.",
            explanation: "O n√∫mero 5 aparece duas vezes, os outros apenas uma. Logo, 5 √© a moda.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Qual a M√©dia de idade entre dois irm√£os de 10 e 12 anos?",
            options: ["10", "12", "22", "11"],
            correct: 3,
            hint: "Qual n√∫mero est√° exatamente no meio de 10 e 12?",
            explanation: "Soma-se as idades (10+12=22) e divide pela quantidade de pessoas (2). A m√©dia √© 11.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Em uma corrida, os tempos foram: 10s, 12s, 15s. O tempo M√âDIO foi:",
            options: ["12s", "13s", "12,3s", "37s"],
            correct: 2,
            hint: "Some 10+12+15 e divida o resultado por 3.",
            explanation: "10+12+15 = 37. Dividindo 37 por 3, obtemos aproximadamente 12,33 segundos.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Para saber qual a fruta preferida da turma para o lanche, que medida usamos?",
            options: ["M√©dia", "Moda", "Mediana", "Amplitude"],
            correct: 1,
            hint: "Queremos saber a fruta que teve MAIS votos.",
            explanation: "A Moda indica o valor mais frequente (o vencedor). N√£o d√° para calcular a 'M√©dia' de ma√ß√£s e bananas.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Qual a Mediana dos n√∫meros: 1, 3, 5, 7, 9?",
            options: ["5", "1", "9", "7"],
            correct: 0,
            hint: "Coloque em ordem (j√° est√£o) e pegue o n√∫mero que est√° bem no meio.",
            explanation: "Os n√∫meros j√° est√£o ordenados. O termo central √© o 5.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "A Amplitude dos dados 10, 20, 50 √©:",
            options: ["50", "10", "40", "30"],
            correct: 2,
            hint: "√â a diferen√ßa (dist√¢ncia) entre o maior valor e o menor valor.",
            explanation: "Amplitude = Maior valor (50) menos o Menor valor (10). 50 - 10 = 40.",
            difficulty: "medium",
            points: 15
        },
        {
            question: "Qual gr√°fico √© melhor para mostrar se a temperatura subiu ou desceu durante a semana?",
            options: ["Gr√°fico de Pizza", "Tabela", "Pictograma", "Gr√°fico de Linha"],
            correct: 3,
            hint: "As linhas conectam pontos e mostram a evolu√ß√£o ou mudan√ßa.",
            explanation: "Gr√°ficos de linha s√£o ideais para mostrar evolu√ß√£o ou varia√ß√£o ao longo do tempo (como temperatura, crescimento, etc).",
            difficulty: "medium",
            points: 15
        },
        // --- N√≠vel Dif√≠cil (Interpreta√ß√£o) ---
        {
            question: "Em uma lista ordenada: 2, 3, X, 8, 10. Se a mediana √© 6, qual o valor de X?",
            options: ["6", "5", "7", "4"],
            correct: 0,
            hint: "A mediana √© o n√∫mero do meio. Olhe para a posi√ß√£o do X.",
            explanation: "Como s√£o 5 n√∫meros, o X est√° exatamente na posi√ß√£o do meio. Para a mediana ser 6, o X deve valer 6.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Se a m√©dia de 4 provas foi 7,0. Qual a soma total das notas?",
            options: ["21", "30", "28", "14"],
            correct: 2,
            hint: "Se ele tivesse tirado 7 em todas as 4 provas, qual seria o total?",
            explanation: "Se a m√©dia √© 7 e foram 4 provas, fazemos 7 vezes 4 = 28 pontos no total.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Uma vari√°vel 'Qualitativa' representa:",
            options: ["N√∫meros e contas", "Qualidades ou categorias (ex: cor dos olhos)", "Apenas notas de prova", "A quantidade de alunos"],
            correct: 1,
            hint: "Qualitativa vem de 'Qualidade', n√£o de quantidade (n√∫meros).",
            explanation: "Vari√°veis qualitativas expressam caracter√≠sticas (cor, g√™nero, nome, escolaridade), e n√£o n√∫meros que podemos somar.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Se em um gr√°fico de pizza a parte do 'Futebol' ocupa metade do c√≠rculo, quantos % gostam de futebol?",
            options: ["25%", "75%", "100%", "50%"],
            correct: 3,
            hint: "O c√≠rculo inteiro vale 100%. Quanto vale a metade?",
            explanation: "Metade do c√≠rculo corresponde a metade do total, ou seja, 50%.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Em estat√≠stica, o que significa organizar os dados em 'Rol'?",
            options: ["Misturar os dados", "Colocar em ordem crescente ou decrescente", "Apagar os dados", "Somar os dados"],
            correct: 1,
            hint: "√â o primeiro passo importante antes de achar a mediana.",
            explanation: "Rol √© a organiza√ß√£o dos dados brutos em uma ordem (geralmente do menor para o maior) para facilitar a an√°lise.",
            difficulty: "hard",
            points: 20
        },
        {
            question: "Se a moda de um conjunto √© 7, isso significa que:",
            options: ["A m√©dia √© 7", "O maior n√∫mero √© 7", "O n√∫mero 7 √© o que mais se repete", "A mediana √© 7"],
            correct: 2,
            hint: "Lembre-se da defini√ß√£o de Moda (o mais popular).",
            explanation: "A Moda √© o valor com maior frequ√™ncia absoluta, ou seja, o que mais aparece na lista.",
            difficulty: "hard",
            points: 20
        }
    ]
};


// ================ INICIALIZA√á√ÉO ================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM carregado, inicializando...");
            
            // Carregar dados salvos
            loadGameData();
            
            // Configurar sele√ß√£o de temas
            document.querySelectorAll('.theme-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.theme-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    gameData.theme = card.dataset.theme;
                    updateThemeDisplay();
                    console.log("Tema selecionado:", gameData.theme);
                });
            });
            
            // Configurar bot√µes
            document.getElementById('start-btn').addEventListener('click', startGame);
            document.getElementById('restart-btn').addEventListener('click', restartGame);
            document.getElementById('change-theme-btn').addEventListener('click', () => {
                showScreen('start-screen');
            });
            
            // Configurar conquistas
            document.getElementById('achievement-btn').addEventListener('click', toggleAchievements);
            
            // Configurar calculadora
            initCalculator();
            
            // Configurar controle de som
            document.getElementById('sound-toggle').addEventListener('change', (e) => {
                const isEnabled = e.target.value === 'true';
                
                // Atualiza o gameData
                gameData.settings.sound = isEnabled;
                
                // Atualiza o localStorage
                localStorage.setItem('soundEnabled', isEnabled.toString());
                
                // Feedback
                if (isEnabled) {
                    audioEnabled = true; 
                    playSound('powerup');
                }
                
                saveGameData();
            }); // <--- O C√ìDIGO DO SOM TERMINA AQUI

            // ============================================================
            // C√ìDIGO DO RESET AGORA EST√Å FORA DO SOM (LUGAR CORRETO)
            // ============================================================
            const resetBtn = document.getElementById('reset-progress-btn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    // Tocar um som de alerta
                    if (typeof playSound === "function") playSound('incorrect');

                    // Pergunta de seguran√ßa
                    const confirmReset = confirm(
                        "‚ö†Ô∏è PERIGO: ATEN√á√ÉO! ‚ö†Ô∏è\n\n" +
                        "Voc√™ est√° prestes a APAGAR TODO O SEU PROGRESSO.\n" +
                        "Isto inclui:\n" +
                        "- O seu N√≠vel e XP\n" +
                        "- Todas as Conquistas/Trof√©us\n" +
                        "- Estat√≠sticas de acertos\n\n" +
                        "Tem a certeza absoluta que quer come√ßar do zero?"
                    );
                    
                    if (confirmReset) {
                        // 1. Apagar chaves espec√≠ficas do localStorage
                        localStorage.removeItem('mathGameData');   // Dados do jogo
                        localStorage.removeItem('themeProgress');  // Progresso dos temas
                        localStorage.removeItem('gamesPlayed');    // Contador de jogos
                        
                        // 2. Feedback visual
                        alert("üóëÔ∏è Mem√≥ria limpa com sucesso!\nO jogo ser√° reiniciado agora.");
                        
                        // 3. Recarregar a p√°gina
                        window.location.reload();
                    }
                });
            }
            // ============================================================
            
            // Configurar bot√£o de download de estat√≠sticas
            document.getElementById('download-stats-btn')?.addEventListener('click', downloadStatistics);
            
            // Selecionar tema padr√£o
            document.querySelector('[data-theme="probabilidade"]').click();
            
            console.log("üéÆ Jogo inicializado com sucesso!");
            
            // Inicializar √°udios
            initAudio();

            // Fechar modal com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && document.getElementById('achievements-modal').classList.contains('active')) {
                    closeAchievements();
                }
            });

// --- C√ìDIGO QUE FALTA PARA A REVIS√ÉO TE√ìRICA ---

    // 1. Configurar o bot√£o principal "Revis√£o Te√≥rica"
    const theoryBtn = document.getElementById('theory-btn');
    if (theoryBtn) {
        theoryBtn.addEventListener('click', openTheoryModal);
    }

    // 2. Configurar os bot√µes de escolha (Probabilidade vs Estat√≠stica) dentro do modal
    document.querySelectorAll('.theme-choice-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const theoryType = btn.dataset.theory; // Pega 'probabilidade' ou 'estatistica'
            closeTheoryModal(); // Fecha o menu de escolha
            openTheoryContentModal(theoryType); // Abre o conte√∫do
        });
    });
            
        });
    
        

// ================ FUN√á√ïES DO MODAL DE TUTORIAL ================

function openTutorialModal() {
    const modal = document.getElementById('tutorial-modal');
    if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
}

function closeTutorialModal() {
    const modal = document.getElementById('tutorial-modal');
    if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
    }
}

// Fechar modal com ESC
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        if (document.getElementById('tutorial-modal').classList.contains('active')) {
            closeTutorialModal();
        }
    }
});





        function switchTheoryContent(targetTheme) {
    // Fecha o modal atual
    if (document.getElementById('probabilidade-modal').classList.contains('active')) {
        closeTheoryContentModal('probabilidade');
    } else if (document.getElementById('estatistica-modal').classList.contains('active')) {
        closeTheoryContentModal('estatistica');
    }
    
    // Abre o novo modal
    setTimeout(() => {
        openTheoryContentModal(targetTheme);
    }, 300);
}

function createPerformanceChart() {
            // === IN√çCIO DA CORRE√á√ÉO ===
            // Verifica se j√° existe um gr√°fico no canvas e o destr√≥i antes de criar um novo
            const existingChart = Chart.getChart("performance-chart");
            if (existingChart) {
                existingChart.destroy();
            }
            // === FIM DA CORRE√á√ÉO ===

            const ctx = document.getElementById('performance-chart').getContext('2d');
            
            // Dados para o gr√°fico
            const questionNumbers = Array.from({length: gameData.userAnswers.length}, (_, i) => i + 1);
            const correctness = gameData.userAnswers.map(a => a.isCorrect ? 1 : 0);
            const responseTimes = gameData.userAnswers.map(a => a.time);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: questionNumbers,
                    datasets: [
                        {
                            label: 'Acertos (1=sim, 0=n√£o)',
                            data: correctness,
                            borderColor: '#4caf50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.3,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Tempo de resposta (s)',
                            data: responseTimes,
                            borderColor: '#2196f3',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.3,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#bbdefb'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        }
                    }
                }
            });
        }




        // ================ FUN√á√ÉO DE DOWNLOAD DE ESTAT√çSTICAS ================
        function downloadStatistics() {
            // Coletar dados da partida
            const accuracy = (gameData.correctAnswers / gameData.totalQuestions) * 100;
            const avgTime = gameData.questionTimes.length > 0 ? 
                (gameData.questionTimes.reduce((a, b) => a + b) / gameData.questionTimes.length).toFixed(1) : 0;
            
            // Formatar data e hora
            const now = new Date();
            const dateStr = now.toLocaleDateString('pt-BR');
            const timeStr = now.toLocaleTimeString('pt-BR');
            
            // Criar conte√∫do do arquivo
            const statsContent = `
==========================================
ESTAT√çSTICAS DA PARTIDA - LIAM - Laborat√≥rio Interativo de Alfabetiza√ß√£o Matem√°tica
==========================================

üìÖ Data: ${dateStr}
‚è∞ Hora: ${timeStr}

üéÆ INFORMA√á√ïES DA PARTIDA
========================
‚Ä¢ Tema: ${gameData.theme === 'probabilidade' ? 'Probabilidade' : 'Estat√≠stica'}
‚Ä¢ N√∫mero de quest√µes: ${gameData.totalQuestions}
‚Ä¢ Tempo por quest√£o: 60 segundos

üìä RESULTADOS
=============
‚Ä¢ Pontua√ß√£o total: ${gameData.score} pontos
‚Ä¢ Acertos: ${gameData.correctAnswers}/${gameData.totalQuestions}
‚Ä¢ Precis√£o: ${accuracy.toFixed(1)}%
‚Ä¢ Streak m√°xima: ${gameData.maxStreak} acertos consecutivos
‚Ä¢ Tempo m√©dio por quest√£o: ${avgTime}s

‚ö° DESEMPENHO
=============
‚Ä¢ N√≠vel atual: ${gameData.level}
‚Ä¢ XP ganho na partida: ${gameData.score} XP
‚Ä¢ Total de XP: ${gameData.xp}/${gameData.xpToNextLevel}

‚ú® POWER-UPS UTILIZADOS
=======================
‚Ä¢ Dicas usadas: ${gameData.powerUps.hint.used}
‚Ä¢ Quest√µes puladas: ${gameData.powerUps.skip.used}
‚Ä¢ Tempo extra usado: ${gameData.powerUps.time.used}
‚Ä¢ Pontos em dobro ativados: ${gameData.powerUps.double.used}

üèÜ DETALHES DAS QUEST√ïES
========================
${gameData.userAnswers.map((answer, index) => {
    const q = gameData.questions[index];
    let status = answer.isCorrect ? '‚úÖ CORRETO' : '‚ùå ERRADO';
    if (answer.skipped) status = '‚è≠Ô∏è PULADA';
    if (answer.timeout) status = '‚è∞ TEMPO ESGOTADO';
    
    return `Quest√£o ${index + 1}: ${status}
   Pergunta: ${answer.question}
   ${answer.isCorrect ? 
        `Pontos: ${answer.points} | Tempo: ${answer.time.toFixed(1)}s` : 
        `Resposta correta: ${q.options[answer.correctAnswer]}`
   }
   ----------------------------------------`;
}).join('\n')}

üìà RECOMENDA√á√ïES
================
${accuracy >= 90 ? 
    'Excelente desempenho! Continue assim!' :
accuracy >= 70 ?
    'Bom trabalho! Pratique um pouco mais para alcan√ßar a perfei√ß√£o.' :
accuracy >= 50 ?
    'Resultado razo√°vel. Recomendamos revisar os conceitos b√°sicos.' :
    'H√° espa√ßo para melhoria. Sugerimos estudar os conte√∫dos novamente.'}

==========================================
Jogo desenvolvido para o 9¬∫ Ano do Ensino Fundamental
==========================================
    `.trim();

            // Criar arquivo para download
            const blob = new Blob([statsContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `estatisticas-matematica-${dateStr.replace(/\//g, '-')}-${timeStr.replace(/:/g, '-')}.txt`;
            
            // Adicionar ao documento, clicar e remover
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // Liberar o objeto URL
            URL.revokeObjectURL(url);
            
            // Feedback visual
            const originalText = document.getElementById('download-stats-btn').innerHTML;
            document.getElementById('download-stats-btn').innerHTML = '‚úÖ Baixado!';
            document.getElementById('download-stats-btn').disabled = true;
            
            setTimeout(() => {
                document.getElementById('download-stats-btn').innerHTML = originalText;
                document.getElementById('download-stats-btn').disabled = false;
            }, 2000);
        }

        // ================ CALCULADORA - C√ìDIGO SIMPLIFICADO E FUNCIONAL ================
        function initCalculator() {
    console.log("Inicializando calculadora...");
    
    // Elementos da calculadora
    const calculator = document.getElementById('calculator');
    const openCalcBtns = document.querySelectorAll('.open-calc-btn'); // Seleciona TODOS os bot√µes
    const closeCalcBtn = document.getElementById('close-calc');
    const minimizeCalcBtn = document.getElementById('minimize-calc');
    
    if (!calculator || openCalcBtns.length === 0) {
        console.error("Elementos da calculadora n√£o encontrados!");
        return;
    }
    
    // Abrir calculadora - para TODOS os bot√µes
    openCalcBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.stopPropagation();
            console.log("Abrindo calculadora...");
            calculator.classList.add('active');
        });
    });
    
    // Fechar calculadora
    closeCalcBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        calculator.classList.remove('active');
    });
    
    // Minimizar calculadora
    let minimized = false;
    minimizeCalcBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        const buttons = calculator.querySelector('.calc-buttons');
        const display = calculator.querySelector('.calc-display');
        
        if (!minimized) {
            buttons.style.display = 'none';
            display.style.display = 'none';
            calculator.style.height = '60px';
            minimized = true;
        } else {
            buttons.style.display = 'grid';
            display.style.display = 'block';
            calculator.style.height = 'auto';
            minimized = false;
        }
    });
    
    console.log("Calculadora inicializada com m√∫ltiplos bot√µes!");
}

        // Fun√ß√µes da calculadora
        function calcNumber(num) {
            if (calcData.waitingForSecond) {
                calcData.display = num.toString();
                calcData.waitingForSecond = false;
            } else {
                calcData.display = calcData.display === '0' ? num.toString() : calcData.display + num;
            }
            calcData.expression = calcData.display;
            updateCalcDisplay();
        }

        function calcOperator(op) {
            if (calcData.firstNum === null) {
                calcData.firstNum = parseFloat(calcData.display);
            } else if (calcData.operator && !calcData.waitingForSecond) {
                calcData.firstNum = calcCalculate();
                calcData.display = calcData.firstNum.toString();
            }
            calcData.operator = op;
            calcData.waitingForSecond = true;
            calcData.expression = `${calcData.firstNum} ${getOperatorSymbol(op)}`;
            updateCalcDisplay();
        }

        function calcEquals() {
            if (calcData.operator && calcData.firstNum !== null) {
                const result = calcCalculate();
                calcData.display = result.toString();
                calcData.expression = `${calcData.firstNum} ${getOperatorSymbol(calcData.operator)} ${calcData.display} =`;
                calcData.firstNum = null;
                calcData.operator = null;
                calcData.waitingForSecond = true;
                updateCalcDisplay();
            }
        }

        function calcClear() {
            calcData.display = '0';
            calcData.expression = '0';
            calcData.firstNum = null;
            calcData.operator = null;
            calcData.waitingForSecond = false;
            updateCalcDisplay();
        }

        function calcClearEntry() {
            calcData.display = '0';
            calcData.expression = '0';
            updateCalcDisplay();
        }

        function calcBackspace() {
            if (calcData.display.length > 1) {
                calcData.display = calcData.display.slice(0, -1);
            } else {
                calcData.display = '0';
            }
            calcData.expression = calcData.display;
            updateCalcDisplay();
        }

        function calcDecimal() {
            if (!calcData.display.includes('.')) {
                calcData.display += '.';
                calcData.expression = calcData.display;
                updateCalcDisplay();
            }
        }

        function calcSqrt() {
            calcData.display = Math.sqrt(parseFloat(calcData.display)).toString();
            calcData.expression = `‚àö(${calcData.display})`;
            updateCalcDisplay();
        }

        function calcPower() {
            calcData.display = Math.pow(parseFloat(calcData.display), 2).toString();
            calcData.expression = `(${calcData.display})¬≤`;
            updateCalcDisplay();
        }

        function calcPercent() {
            calcData.display = (parseFloat(calcData.display) / 100).toString();
            calcData.expression = `${calcData.display}%`;
            updateCalcDisplay();
        }

        function calcPi() {
            calcData.display = Math.PI.toString();
            calcData.expression = 'œÄ';
            updateCalcDisplay();
        }

        function calcPlusMinus() {
            calcData.display = (-parseFloat(calcData.display)).toString();
            calcData.expression = calcData.display;
            updateCalcDisplay();
        }

        function calcCalculate() {
            const a = calcData.firstNum;
            const b = parseFloat(calcData.display);
            
            switch(calcData.operator) {
                case '+': return a + b;
                case '-': return a - b;
                case '*': return a * b;
                case '/': return a / b;
                default: return b;
            }
        }

        function getOperatorSymbol(op) {
            switch(op) {
                case '+': return '+';
                case '-': return '‚àí';
                case '*': return '√ó';
                case '/': return '√∑';
                default: return op;
            }
        }

        function updateCalcDisplay() {
            const calcExpression = document.getElementById('calc-expression');
            const calcResult = document.getElementById('calc-result');
            
            if (calcExpression) calcExpression.textContent = calcData.expression;
            if (calcResult) calcResult.textContent = calcData.display;
        }

        // ================ FUN√á√ïES DO JOGO ================
        function startGame() {
            if (!gameData.theme) {
                alert('Escolha um tema primeiro!');
                return;
            }

            // Resetar dados do jogo
            resetGameData();
            
            // Configurar com base nas settings fixas
            gameData.totalQuestions = 20; // Fixo
            gameData.timeLeft = 60; // Fixo
            
            // Selecionar quest√µes
            selectQuestions();
            
            // Atualizar interface
            updateGameStatus();
            showQuestion();
            updatePowerUpDisplay();
            
            // Mostrar tela de quest√µes
            showScreen('question-screen');
            
            // Iniciar timer (sempre 60 segundos)
            document.getElementById('timer-container').style.display = 'block';
            startTimer();
            
            // Registrar in√≠cio do jogo
            gameData.startTime = Date.now();
            
            console.log("Jogo iniciado!");
        }

        function selectQuestions() {
            const allQuestions = questions[gameData.theme];
            
            // Embaralhar todas as quest√µes
            let shuffledQuestions = [...allQuestions].sort(() => Math.random() - 0.5);
            
            // Pegar as primeiras 20 quest√µes
            gameData.questions = shuffledQuestions.slice(0, 20);
            
            // Se n√£o houver quest√µes suficientes, repetir algumas
            if (gameData.questions.length < 20) {
                const needed = 20 - gameData.questions.length;
                const extraQuestions = shuffledQuestions.slice(0, needed);
                gameData.questions = gameData.questions.concat(extraQuestions);
            }
        }



// 1. Vari√°vel Global para armazenar a escolha tempor√°ria
let selectedOptionIndex = null;

// 2. Nova Fun√ß√£o para Confirmar a Resposta (O intermedi√°rio)
function confirmAnswer() {
    if (selectedOptionIndex === null) return; // Seguran√ßa

    // Chama a corre√ß√£o oficial
    checkAnswer(selectedOptionIndex);

    // Transforma o bot√£o em "Pr√≥xima Quest√£o"
    const actionBtn = document.getElementById('next-btn');
    actionBtn.textContent = "Pr√≥xima Quest√£o ‚ûî";
    actionBtn.onclick = nextQuestion; // Muda o evento do clique
}



// 3. Atualiza√ß√£o da fun√ß√£o showQuestion (Reseta o bot√£o)


function showQuestion() {
    const q = gameData.questions[gameData.currentQuestion];
    
    // === RESETAR ESTADO ===
    gameData.isQuestionAnswered = false;
    updatePowerUpDisplay();

    // === ACESSIBILIDADE: Anunciar nova quest√£o ===
    setTimeout(() => {
        announceToScreenReader(`Quest√£o ${gameData.currentQuestion + 1}. Dificuldade ${q.difficulty === 'easy' ? 'F√°cil' : q.difficulty === 'medium' ? 'M√©dio' : 'Dif√≠cil'}.`);
    }, 500);
    
    // === CONFIGURA√á√ÉO DO BOT√ÉO ===
    selectedOptionIndex = null; 
    const actionBtn = document.getElementById('next-btn');
    actionBtn.textContent = "Confirmar Resposta"; 
    actionBtn.onclick = confirmAnswer; 
    actionBtn.disabled = true; 

    // Atualizar n√∫mero e texto
    document.getElementById('question-number').textContent = gameData.currentQuestion + 1;
    document.getElementById('question-text').innerHTML = q.question;
    
    // Dificuldade
    const diffEl = document.getElementById('question-difficulty');
    diffEl.textContent = q.difficulty === 'easy' ? 'F√°cil' : 
                         q.difficulty === 'medium' ? 'M√©dio' : 'Dif√≠cil';
    diffEl.className = 'question-difficulty'; 
    diffEl.classList.add(`difficulty-${q.difficulty}`);
    
    // === GERA√á√ÉO DAS OP√á√ïES ===
    const optionsContainer = document.getElementById('options-container');
    optionsContainer.innerHTML = '';
    
    ['A', 'B', 'C', 'D'].forEach((letter, index) => {
        const option = document.createElement('button');
        option.className = 'option';
        
        // ARIA Label para acessibilidade
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = q.options[index];
        const cleanText = tempDiv.textContent || tempDiv.innerText || "";
        option.setAttribute('aria-label', `Op√ß√£o ${letter}: ${cleanText}`);
        
        option.innerHTML = `
            <div class="option-letter">${letter}</div>
            <div style="flex: 1; text-align: left;">${q.options[index]}</div>
        `;
        
        option.addEventListener('click', () => selectOption(option, index));
        optionsContainer.appendChild(option);
    });
    
    // Resetar feedback
    document.getElementById('correct-feedback').style.display = 'none';
    document.getElementById('incorrect-feedback').style.display = 'none';
    
    // Timer
    gameData.timeLeft = 60;
    updateTimerDisplay();
    gameData.questionStartTime = Date.now();
    
    // === MATHJAX - AGORA COM TIMEOUT PARA GARANTIR QUE O DOM EST√Å PRONTO ===
    setTimeout(() => {
        if (window.MathJax && window.MathJax.typesetPromise) {
            // Garante que tanto a pergunta quanto as op√ß√µes sejam processadas
            const elementsToTypeset = [
                document.getElementById('question-text'),
                document.getElementById('options-container')
            ];
            
            MathJax.typesetPromise(elementsToTypeset)
                .then(() => {
                    console.log('LaTeX renderizado com sucesso!');
                })
                .catch((err) => {
                    console.log('Erro MathJax:', err);
                    // Tentativa alternativa se a primeira falhar
                    setTimeout(() => {
                        if (window.MathJax && window.MathJax.typeset) {
                            MathJax.typeset(elementsToTypeset);
                        }
                    }, 500);
                });
        }
    }, 100); // 100ms √© suficiente para o DOM atualizar
}

function renderMathJaxWithRetry(attempt = 0) {
    if (window.MathJax && window.MathJax.typesetPromise) {
        const elementsToTypeset = [
            document.getElementById('question-text'),
            document.getElementById('options-container')
        ];
        
        MathJax.typesetPromise(elementsToTypeset)
            .then(() => {
                console.log('LaTeX renderizado com sucesso!');
            })
            .catch((err) => {
                console.log('Erro MathJax, tentativa:', attempt + 1, err);
                if (attempt < 3) {
                    setTimeout(() => renderMathJaxWithRetry(attempt + 1), 300 * (attempt + 1));
                }
            });
    } else if (attempt < 5) {
        // Se MathJax ainda n√£o carregou, tenta novamente
        setTimeout(() => renderMathJaxWithRetry(attempt + 1), 500);
    }
}

// Chama a primeira vez
setTimeout(() => renderMathJaxWithRetry(), 150);


function forceMathJaxRender(elementId) {
    const element = document.getElementById(elementId);
    if (!element) return;
    
    if (window.MathJax && window.MathJax.typesetPromise) {
        MathJax.typesetPromise([element]).catch(err => {
            console.log('Erro ao renderizar MathJax para', elementId, err);
        });
    }
}

// 4. Atualiza√ß√£o da fun√ß√£o selectOption (Apenas visual)
function selectOption(optionElement, index) {
    // Se o bot√£o j√° virou "Pr√≥xima Quest√£o", n√£o deixa mudar a resposta (j√° foi corrigido)
    const actionBtn = document.getElementById('next-btn');
    if (actionBtn.textContent.includes("Pr√≥xima")) return;

    // Remove sele√ß√£o visual das outras
    document.querySelectorAll('.option').forEach(o => {
        o.classList.remove('selected');
    });
    
    // Adiciona na atual
    optionElement.classList.add('selected');
    
    // Salva o √≠ndice na mem√≥ria
    selectedOptionIndex = index;
    
    // Libera o bot√£o para confirmar
    actionBtn.disabled = false;
    
    // Opcional: Feedback sonoro leve de "clique" (se tiver √°udio de UI)
    // playSound('click'); 
}

// 5. Atualiza√ß√£o da fun√ß√£o checkAnswer (Corre√ß√£o Final)
function checkAnswer(selectedIndex) {
            clearInterval(gameData.timer);

            // === BLOQUEAR POWER-UPS ===
            gameData.isQuestionAnswered = true; // Marca como respondida
            
            document.querySelectorAll('.power-up').forEach(btn => btn.disabled = true); // Desabilita visualmente todos
            updatePowerUpDisplay();
            // ==========================


            const q = gameData.questions[gameData.currentQuestion];
            const isCorrect = selectedIndex === q.correct;
            const options = document.querySelectorAll('.option');
            
            options.forEach(o => o.style.pointerEvents = 'none');

            const responseTime = (Date.now() - gameData.questionStartTime) / 1000;
            gameData.questionTimes.push(responseTime);
            
            options[q.correct].classList.add('correct');
            
            if (isCorrect) {
                options[selectedIndex].classList.add('correct');
                
                let points = q.points;
                let bonusText = [];
                
                gameData.currentStreak++;
                if (gameData.currentStreak > gameData.maxStreak) gameData.maxStreak = gameData.currentStreak;
                
                if (gameData.currentStreak >= 3) {
                    const streakBonus = Math.floor(gameData.currentStreak / 3) * 5;
                    points += streakBonus;
                    bonusText.push(`Streak +${streakBonus}`);
                    if (gameData.currentStreak >= 5) showStreakIndicator();
                }
                
                if (responseTime < 10) {
                    points += 5;
                    bonusText.push(`R√°pido +5`);
                }
                
                if (gameData.doublePointsActive) {
                    points *= 2;
                    bonusText.push(`‚ú® Dobro!`);
                    gameData.doublePointsActive = false; // RESETA DEPOIS DE USAR
                }
                
                gameData.score += points;
                gameData.correctAnswers++;
                addXP(points);
                
                document.getElementById('correct-feedback').style.display = 'block';
                document.getElementById('points-earned').textContent = points;
                document.getElementById('bonus-info').textContent = bonusText.length > 0 ? `B√¥nus: ${bonusText.join(', ')}` : '';
                
                // === ACESSIBILIDADE: Anunciar acerto ===
                announceToScreenReader(`Resposta Correta! Voc√™ ganhou ${points} pontos.`);
                
                if (typeof playSound === "function") playSound('correct');
                createFireworksEffect(); // Usa a nova fun√ß√£o de canvas
                checkAchievements();
                
            } else {
        options[selectedIndex].classList.add('incorrect');
        gameData.currentStreak = 0;
        
        document.getElementById('incorrect-feedback').style.display = 'block';
        document.getElementById('correct-answer').innerHTML = q.options[q.correct];
        document.getElementById('explanation').innerHTML = q.explanation;
        
        // === ACESSIBILIDADE: Anunciar erro ===
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = q.options[q.correct];
        const cleanAnswer = tempDiv.textContent || "";
        announceToScreenReader(`Resposta Incorreta. A resposta correta era: ${cleanAnswer}`);
        
        if (typeof playSound === "function") playSound('incorrect');
        
        // === ADICIONE ESTAS LINHAS: Atualizar MathJax ===
        setTimeout(() => {
            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise([
                    document.getElementById('correct-answer'),
                    document.getElementById('explanation')
                ]).catch(err => console.log('Erro ao processar MathJax:', err));
            }
        }, 100);
    }
            
            gameData.userAnswers.push({
                question: q.question,
                userAnswer: selectedIndex,
                correctAnswer: q.correct,
                isCorrect: isCorrect,
                time: responseTime,
                points: isCorrect ? q.points : 0
            });
            
            updateGameStatus();
        }


        
        function nextQuestion() {
            gameData.currentQuestion++;
            
            if (gameData.currentQuestion < gameData.totalQuestions) {
                showQuestion();
                startTimer();
            } else {
                finishGame();
            }
        }

        function finishGame() {
            // Parar timer
            clearInterval(gameData.timer);
            
            // Calcular estat√≠sticas finais
            const accuracy = (gameData.correctAnswers / gameData.totalQuestions) * 100;
            const avgTime = gameData.questionTimes.length > 0 ? 
                (gameData.questionTimes.reduce((a, b) => a + b) / gameData.questionTimes.length).toFixed(1) : 0;
            
            // Atualizar resultados
            document.getElementById('final-score').textContent = `${accuracy.toFixed(1)}%`;
            document.getElementById('final-correct').textContent = gameData.correctAnswers;
            document.getElementById('accuracy').textContent = `${accuracy.toFixed(1)}% de precis√£o`;
            document.getElementById('final-points').textContent = gameData.score;
            document.getElementById('avg-time').textContent = `${avgTime}s`;
            document.getElementById('max-streak').textContent = gameData.maxStreak;
            
            // Trof√©u baseado na pontua√ß√£o
            let trophy = 'üèÜ';
            if (accuracy >= 90) trophy = 'üëë';
            else if (accuracy >= 70) trophy = 'ü•á';
            else if (accuracy >= 50) trophy = 'ü•à';
            else trophy = 'üéñÔ∏è';
            document.getElementById('trophy').textContent = trophy;
            
            // Criar resumo
            createAnswersSummary();
            
            // Criar gr√°fico
            createPerformanceChart();
            
            // Verificar se desbloqueou novas conquistas
            checkGameAchievements();
            
            // Salvar recordes
            saveRecords();
            
            // Mostrar tela de resultados
            showScreen('results-screen');
            
            // Tocar som de vit√≥ria e fogos de artif√≠cio se boa pontua√ß√£o
            if (accuracy >= 70) {
                playSound('achievement');
                // Fogos de artif√≠cio para celebrar uma boa pontua√ß√£o
                setTimeout(() => createFireworksEffect(), 500);
            }
        }

        
        // ================ POWER-UPS ================
        function usePowerUp(power) {
            
            // === PROTE√á√ÉO NOVA ===
            if (gameData.isQuestionAnswered) {
                showNotification("‚è∏Ô∏è Quest√£o j√° respondida!", "warning");
                return;
            }
            // =====================

            if (gameData.timeLeft <= 0) {
                showNotification("‚åõ Tempo esgotado!", "warning");
                return;
            }


        if (gameData.powerUps[power].count <= 0) {
                // Feedback visual sutil
                const btn = document.querySelector(`.power-up[data-power="${power}"]`);
                if (btn) {
                    btn.classList.add('shake');
                    setTimeout(() => btn.classList.remove('shake'), 500);
                }
                return;
            }   

            switch(power) {
                case 'hint':
                    showHint();
                    break;
                case 'skip':
                    skipQuestion();
                    break;
                case 'time':
                    addTime(10);
                    break;
                case 'double':
                    activateDoublePoints();
                    break;
            }
            
            gameData.powerUps[power].count--;
            gameData.powerUps[power].used++;
            updatePowerUpDisplay();
            playSound('powerup');
        }

 function showHint() {
    const q = gameData.questions[gameData.currentQuestion];
    
    // Criar tooltip tempor√°rio
    const hintTooltip = document.createElement('div');
    hintTooltip.className = 'hint-tooltip';
    hintTooltip.innerHTML = `
        <div style="padding: 10px; background: rgba(0,0,0,0.9); border-radius: 10px; 
                    border: 2px solid #ff9800; color: white; max-width: 300px;">
            <strong>üí° Dica:</strong> ${q.hint}
        </div>
    `;
    
    hintTooltip.style.position = 'fixed';
    hintTooltip.style.top = '50%';
    hintTooltip.style.left = '50%';
    hintTooltip.style.transform = 'translate(-50%, -50%)';
    hintTooltip.style.zIndex = '10000';
    
    document.body.appendChild(hintTooltip);
    
    // Auto-remover ap√≥s 5 segundos
    setTimeout(() => {
        hintTooltip.style.opacity = '0';
        setTimeout(() => hintTooltip.remove(), 300);
    }, 5000);
}

        function skipQuestion() {
            clearInterval(gameData.timer);
            gameData.doublePointsActive = false;
            // Registrar como errada
            gameData.userAnswers.push({
                question: gameData.questions[gameData.currentQuestion].question,
                userAnswer: -1,
                correctAnswer: gameData.questions[gameData.currentQuestion].correct,
                isCorrect: false,
                time: (Date.now() - gameData.questionStartTime) / 1000,
                points: 0,
                skipped: true
            });
            
            gameData.currentStreak = 0;
            nextQuestion();
        }

        function addTime(seconds) {
            gameData.timeLeft += seconds;
            updateTimerDisplay();
            
            // Efeito visual
            const timerText = document.getElementById('timer-text');
            timerText.style.color = '#4caf50';
            setTimeout(() => {
                timerText.style.color = '#ffeb3b';
            }, 1000);
        }

        function activateDoublePoints() {
            gameData.doublePointsActive = true;
            
            // Efeito visual
            const indicator = document.createElement('div');
            indicator.textContent = '‚ú® Pontos em Dobro Ativo!';
            indicator.style.position = 'fixed';
            indicator.style.top = '50%';
            indicator.style.left = '50%';
            indicator.style.transform = 'translate(-50%, -50%)';
            indicator.style.background = 'linear-gradient(90deg, #ff9800, #ff5722)';
            indicator.style.color = 'white';
            indicator.style.padding = '15px 30px';
            indicator.style.borderRadius = '30px';
            indicator.style.fontWeight = 'bold';
            indicator.style.zIndex = '10000';
            indicator.style.animation = 'fadeIn 0.5s';
            document.body.appendChild(indicator);
            
            setTimeout(() => {
                indicator.style.opacity = '0';
                indicator.style.transform = 'translate(-50%, -50%) scale(0.8)';
                setTimeout(() => indicator.remove(), 500);
            }, 2000);
        }

        // ================ TIMER ================
        function startTimer() {
            clearInterval(gameData.timer);
            updateTimerDisplay();
            
            gameData.timer = setInterval(() => {
                gameData.timeLeft--;
                updateTimerDisplay();
                
                if (gameData.timeLeft <= 0) {
                    clearInterval(gameData.timer);
                    timeUp();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerText = document.getElementById('timer-text');
    const timerProgress = document.getElementById('timer-progress');
    
    // Exibir o tempo real
    timerText.textContent = gameData.timeLeft;
    
    const circumference = 283;
    const maxTime = 60;
    
    // Para c√°lculo visual, limitar a 60s m√°ximo
    let displayTime = Math.min(gameData.timeLeft, maxTime);
    const offset = circumference - (displayTime / maxTime) * circumference;
    
    timerProgress.style.strokeDashoffset = offset;
            
           
            
            // Mudar cor conforme o tempo
            if (gameData.timeLeft < 10) {
                timerProgress.style.stroke = '#f44336';
                timerText.style.color = '#f44336';
            } else if (gameData.timeLeft < 20) {
                timerProgress.style.stroke = '#ff9800';
                timerText.style.color = '#ff9800';
            } else {
                timerProgress.style.stroke = '#4caf50';
                timerText.style.color = '#ffeb3b';
            }
        }

        function timeUp() {
            gameData.doublePointsActive = false; 
    // Desabilitar op√ß√µes
    document.querySelectorAll('.option').forEach(o => {
        o.style.pointerEvents = 'none';
    });
    
    // Mostrar feedback de tempo esgotado
    alert('‚è∞ Tempo esgotado!');
    
    // Registrar como resposta errada
    const q = gameData.questions[gameData.currentQuestion];
    const options = document.querySelectorAll('.option');
    options[q.correct].classList.add('correct');
    
    // Mostrar feedback incorreto
    document.getElementById('incorrect-feedback').style.display = 'block';
    document.getElementById('correct-answer').innerHTML = q.options[q.correct];
    document.getElementById('explanation').innerHTML = "Tempo esgotado! " + q.explanation;
    
    // === ADICIONE ESTAS LINHAS: Atualizar MathJax ===
    setTimeout(() => {
        if (window.MathJax && window.MathJax.typesetPromise) {
            MathJax.typesetPromise([
                document.getElementById('correct-answer'),
                document.getElementById('explanation')
            ]).catch(err => console.log('Erro ao processar MathJax:', err));
        }
    }, 100); 
            
            gameData.userAnswers.push({
                question: q.question,
                userAnswer: -1,
                correctAnswer: q.correct,
                isCorrect: false,
                time: 60,
                points: 0,
                timeout: true
            });
            
            gameData.currentStreak = 0;
            document.getElementById('next-btn').disabled = false;
        }

function updateMathJax(elements) {
    if (!elements) return;
    
    if (window.MathJax && window.MathJax.typesetPromise) {
        setTimeout(() => {
            MathJax.typesetPromise(elements).catch(err => {
                console.log('Erro ao processar MathJax:', err);
                // Tentativa alternativa
                if (window.MathJax && window.MathJax.typeset) {
                    MathJax.typeset(elements);
                }
            });
        }, 50);
    }
}


        // ================ SISTEMA DE XP E N√çVEIS ================
        function addXP(points) {
            gameData.xp += points;
            
            // Verificar se subiu de n√≠vel
            while (gameData.xp >= gameData.xpToNextLevel) {
                gameData.xp -= gameData.xpToNextLevel;
                gameData.level++;
                gameData.xpToNextLevel = Math.floor(gameData.xpToNextLevel * 1.2); // Aumenta 20% a cada n√≠vel
                
                // Efeitos de level up
                levelUpEffects();
            }
            
            updateLevelDisplay();
            saveGameData();
        }

        function levelUpEffects() {
            // Tocar som
            playSound('level-up');
            
            // Efeito visual
           
           
           const levelUp = document.createElement('div');
levelUp.innerHTML = `
    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
               background: rgba(0,0,0,0.9); color: white; padding: 30px; border-radius: 20px; 
               text-align: center; border: 3px solid #ffeb3b;
               z-index: 2000;">
        <div style="font-size: 50px; margin-bottom: 20px;">üéâ</div>
        <h2 style="color: #ffeb3b; margin-bottom: 10px;">N√≠vel Up!</h2>
        <h3 style="font-size: 40px; color: #4caf50;">N√≠vel ${gameData.level}</h3>
        <p style="margin-top: 20px;">Novos power-ups desbloqueados!</p>
    </div>
`;
document.body.appendChild(levelUp); // Adiciona o elemento na tela
           
          /*(Nota: No JS inline n√£o d√° para usar `var(--z...)` facilmente sem configurar antes, ent√£o usamos `2000` que √© o valor equivalente √† nossa camada de notifica√ß√£o).*/

/*### Por que isso √© melhor? */
/*Se amanh√£ voc√™ criar um novo "Menu de Configura√ß√µes" e quiser que ele fique em cima da calculadora, mas embaixo do aviso de "Level Up", voc√™ s√≥ precisa definir `z-index: var(--z-modal)`. N√£o precisa ficar lembrando se o n√∫mero era 1001 ou 10005. */
                  


            
            // Fogos de artif√≠cio para celebrar level up
            setTimeout(() => createFireworksEffect(), 300);
            
            setTimeout(() => {
                levelUp.style.opacity = '0';
                levelUp.style.transform = 'translate(-50%, -50%) scale(0.8)';
                setTimeout(() => levelUp.remove(), 500);
            }, 3000);
            
            // Desbloquear power-ups adicionais
           // PREMIA√á√ÉO: D√° +1 de cada item a cada 3 n√≠veis
    if (gameData.level % 3 === 0) {
        gameData.powerUps.hint.count++;
        gameData.powerUps.skip.count++;
        gameData.powerUps.time.count++;
        gameData.powerUps.double.count++;
        
        // Salva imediatamente para n√£o perder o pr√™mio se fechar o navegador
        saveGameData(); 
        updatePowerUpDisplay();
        alert("üéÅ B√¥nus de N√≠vel: Voc√™ ganhou +1 de todos os Power-ups!");
    }
}
        // ================ CONQUISTAS ================
        function checkAchievements() {
            const newAchievements = [];
            
            // Verificar conquistas de streak
            if (gameData.currentStreak >= 10 && !achievements.find(a => a.id === 'streak_master').unlocked) {
                unlockAchievement('streak_master');
                newAchievements.push('streak_master');
            }
            
            // Verificar conquistas de tempo
            const avgTime = gameData.questionTimes.reduce((a, b) => a + b, 0) / gameData.questionTimes.length;
            if (avgTime < 30 && gameData.questionTimes.length >= 5 && !achievements.find(a => a.id === 'speed_demon').unlocked) {
                unlockAchievement('speed_demon');
                newAchievements.push('speed_demon');
            }
            
            return newAchievements;
        }

        function checkGameAchievements() {
            const newAchievements = [];
            
            // Primeiro jogo
            if (!achievements.find(a => a.id === 'first_game').unlocked) {
                unlockAchievement('first_game');
                newAchievements.push('first_game');
            }
            
            // Pontua√ß√£o perfeita
            if (gameData.correctAnswers === gameData.totalQuestions && !achievements.find(a => a.id === 'perfect_score').unlocked) {
                unlockAchievement('perfect_score');
                newAchievements.push('perfect_score');
            }
            
            // Usou todos os power-ups
            const totalUsed = Object.values(gameData.powerUps).reduce((sum, p) => sum + p.used, 0);
            if (totalUsed >= 4 && !achievements.find(a => a.id === 'power_user').unlocked) {
                unlockAchievement('power_user');
                newAchievements.push('power_user');
            }
            
            // N√≠vel 10
            if (gameData.level >= 10 && !achievements.find(a => a.id === 'level_10').unlocked) {
                unlockAchievement('level_10');
                newAchievements.push('level_10');
            }
            
            // Mostrar conquistas desbloqueadas
            if (newAchievements.length > 0) {
                showUnlockedAchievements(newAchievements);
                
                // Fogos de artif√≠cio para celebrar conquistas
                setTimeout(() => createFireworksEffect(), 100);
            }
        }

        function unlockAchievement(id) {
            const achievement = achievements.find(a => a.id === id);
            if (achievement && !achievement.unlocked) {
                achievement.unlocked = true;
                gameData.achievements.push(id);
                addXP(achievement.xp);
                updateAchievementsDisplay();
                saveGameData();
                return true;
            }
            return false;
        }

        // ================ INTERFACE ================
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(screenId).style.display = 'block';
        }

       function updateGameStatus() {
            document.getElementById('score').textContent = gameData.score;
            document.getElementById('question-counter').textContent = 
                `${gameData.currentQuestion + 1}/${gameData.totalQuestions}`;
            
            // Verifica se o elemento streak existe antes de atualizar
            const streakEl = document.getElementById('streak');
            if (streakEl) {
                streakEl.textContent = `Streak: ${gameData.currentStreak}`;
            }

            document.getElementById('current-theme').textContent = 
                gameData.theme === 'probabilidade' ? 'Probabilidade' : 'Estat√≠stica';
            
            // A LINHA QUE CAUSAVA ERRO FOI REMOVIDA AQUI (document.getElementById('difficulty')...)
            
            updateLevelDisplay();
        }
        function updateLevelDisplay() {
            document.getElementById('level').textContent = gameData.level;
            document.getElementById('xp').textContent = `${gameData.xp}/${gameData.xpToNextLevel} XP`;
            
            const percentage = (gameData.xp / gameData.xpToNextLevel) * 100;
            document.getElementById('level-fill').style.width = `${percentage}%`;
            document.getElementById('level-percentage').textContent = `${Math.floor(percentage)}%`;
        }


        function updatePowerUpDisplay() {
            // Atualiza os contadores na tela inicial e no jogo
            ['hint', 'skip', 'time', 'double'].forEach(type => {
                // Tenta atualizar contador da tela inicial (se existir)
                const homeCount = document.getElementById(`${type}-count`);
                if (homeCount) homeCount.textContent = gameData.powerUps[type].count;
                
                // Tenta atualizar contador do jogo (se existir)
                const gameCount = document.getElementById(`game-${type}-count`);
                if (gameCount) gameCount.textContent = gameData.powerUps[type].count;
            });

            // L√≥gica para habilitar/desabilitar visualmente (ADICIONAR/REMOVER CLASSE .disabled)
            document.querySelectorAll('.power-up').forEach(powerUp => {
                const power = powerUp.dataset.power;
                
                // O power-up deve ficar desabilitado se:
                // 1. O estoque for 0 OU
                // 2. A pergunta j√° tiver sido respondida (bloqueio p√≥s-confirma√ß√£o)
                const shouldDisable = (gameData.powerUps[power].count <= 0) || gameData.isQuestionAnswered;

                if (shouldDisable) {
                    powerUp.classList.add('disabled'); // Aplica o estilo sombreado
                    // Mant√©m o atributo disabled para acessibilidade se for button
                    if (powerUp.tagName === 'BUTTON') powerUp.disabled = true; 
                } else {
                    powerUp.classList.remove('disabled'); // Remove o sombreado (volta a cor)
                    if (powerUp.tagName === 'BUTTON') powerUp.disabled = false;
                }
            });
        }



        function updateThemeDisplay() {
            // Atualizar progresso dos temas
            const themeProgress = JSON.parse(localStorage.getItem('themeProgress') || '{}');
            
            document.getElementById('probabilidade-progress').textContent = 
                `${themeProgress.probabilidade?.completed || 0}%`;
            document.getElementById('probabilidade-record').textContent = 
                themeProgress.probabilidade?.record || 0;
            
            document.getElementById('estatistica-progress').textContent = 
                `${themeProgress.estatistica?.completed || 0}%`;
            document.getElementById('estatistica-record').textContent = 
                themeProgress.estatistica?.record || 0;
        }

        function showStreakIndicator() {
            const indicator = document.getElementById('streak-indicator');
            document.getElementById('current-streak').textContent = gameData.currentStreak;
            indicator.style.display = 'block';
            
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 3000);
        }

        function createAnswersSummary() {
            const summary = document.getElementById('answers-summary');
            summary.innerHTML = '';
            
            gameData.userAnswers.forEach((answer, index) => {
                const q = gameData.questions[index];
                const item = document.createElement('div');
                item.style.marginBottom = '15px';
                item.style.padding = '15px';
                item.style.background = answer.isCorrect ? 'rgba(76,175,80,0.1)' : 'rgba(244,67,54,0.1)';
                item.style.borderRadius = '10px';
                item.style.borderLeft = `4px solid ${answer.isCorrect ? '#4caf50' : '#f44336'}`;
                
                let status = answer.isCorrect ? '‚úÖ' : '‚ùå';
                if (answer.skipped) status = '‚è≠Ô∏è';
                if (answer.timeout) status = '‚è∞';
                
                item.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px;">
                        ${status} Quest√£o ${index + 1}: ${answer.question}
                    </div>
                    <div style="font-size: 14px; color: ${answer.isCorrect ? '#4caf50' : '#f44336'};">
                        ${answer.isCorrect ? 
                            `Acertou! +${answer.points} pontos (${answer.time.toFixed(1)}s)` : 
                            `Resposta correta: ${q.options[answer.correctAnswer]}`
                        }
                        ${answer.skipped ? ' (Pulada)' : ''}
                        ${answer.timeout ? ' (Tempo esgotado)' : ''}
                    </div>
                `;
                
                summary.appendChild(item);

setTimeout(() => {
            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise([item]).catch(err => {
                    console.log('Erro MathJax no resumo:', err);
                });
            }
        }, 100);
    });
}



       function createPerformanceChart() {
            // === IN√çCIO DA CORRE√á√ÉO ===
            // Verifica se j√° existe um gr√°fico no canvas e o destr√≥i antes de criar um novo
            const existingChart = Chart.getChart("performance-chart");
            if (existingChart) {
                existingChart.destroy();
            }
            // === FIM DA CORRE√á√ÉO ===

            const ctx = document.getElementById('performance-chart').getContext('2d');
            
            // Dados para o gr√°fico
            const questionNumbers = Array.from({length: gameData.userAnswers.length}, (_, i) => i + 1);
            const correctness = gameData.userAnswers.map(a => a.isCorrect ? 1 : 0);
            const responseTimes = gameData.userAnswers.map(a => a.time);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: questionNumbers,
                    datasets: [
                        {
                            label: 'Acertos (1=sim, 0=n√£o)',
                            data: correctness,
                            borderColor: '#4caf50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.3,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Tempo de resposta (s)',
                            data: responseTimes,
                            borderColor: '#2196f3',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.3,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#bbdefb'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        }
                    }
                }
            });
        }
        // ================ AUDIO CORRIGIDO DEFINITIVAMENTE ================
        let audioEnabled = false;
        
        function initAudio() {
            console.log("Inicializando √°udios...");
            
            // Tentar carregar todos os √°udios
            const audioElements = document.querySelectorAll('audio');
            audioElements.forEach(audio => {
                // Configurar volume
                audio.volume = 1.0;
                
                // Tentar carregar (sem .catch, pois load() n√£o retorna promessa)
                try {
                    audio.load();
                } catch (e) {
                    console.log("Erro ao carregar √°udio:", e);
                }
            });
            
            console.log("√Åudios inicializados");
        }
        
        function testAudio() {
            console.log("Testando √°udio...");
            audioEnabled = true;
            playSound('firework');
            alert("üîä Teste de som realizado! Se voc√™ ouviu fogos de artif√≠cio, o som est√° funcionando.");
        }
        
        function playSound(type) {
            // Verificar se o som est√° habilitado
            if (localStorage.getItem('soundEnabled') === 'false') return;
            
            // Se o √°udio ainda n√£o foi habilitado (primeira intera√ß√£o), n√£o tenta tocar
            if (!audioEnabled) {
                console.log("√Åudio n√£o habilitado ainda. Clique em 'Testar Som' primeiro.");
                return;
            }
            
            const audio = document.getElementById(`${type}-sound`);
            if (audio) {
                try {
                    // Para o √°udio e reinicia
                    audio.pause();
                    audio.currentTime = 0;
                    
                    // Ajustar volume espec√≠fico para fogos de artif√≠cio
                    // Ajustar volume espec√≠fico para fogos de artif√≠cio
                  // Ajustar volume espec√≠fico para fogos de artif√≠cio
                    if (type === 'firework') {
                        audio.volume = 1.0; // Volume M√ÅXIMO
                        audio.currentTime = 0; // Reinicia o som para dar o estalo imediato
                    } else {
                        // Se n√£o for fogo, toca um pouco mais baixo (60%) 
                        // para que, quando os fogos entrarem (100%), eles pare√ßam muito altos
                        audio.volume = 0.6; 
                    }
                    
                    // Tenta tocar
                    const playPromise = audio.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.catch(error => {
                            console.log(`N√£o foi poss√≠vel tocar o som ${type}:`, error);
                            // Tentativa alternativa - usar √°udio embutido
                            fallbackAudio(type);
                        });
                    }
                } catch (error) {
                    console.log(`Erro ao tocar som ${type}:`, error);
                    fallbackAudio(type);
                }
            } else {
                console.log(`√Åudio n√£o encontrado: ${type}`);
                fallbackAudio(type);
            }
        }
        
        // Fallback para √°udio usando Web Audio API se os URLs externos falharem
        function fallbackAudio(type) {
            console.log(`Usando fallback para: ${type}`);
            
            // Criar contexto de √°udio
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioContext = new AudioContext();
            
            // Gerar som baseado no tipo
            let frequency = 440; // Hz
            let duration = 0.3; // segundos
            
            switch(type) {
                case 'correct':
                    frequency = 523.25; // C5
                    break;
                case 'incorrect':
                    frequency = 349.23; // F4
                    break;
                case 'level-up':
                    frequency = 659.25; // E5
                    break;
                case 'achievement':
                    // Acorde maior
                    playChord([523.25, 659.25, 783.99], 1.0);
                    return;
                case 'powerup':
                    frequency = 587.33; // D5
                    break;
                case 'firework':
                    // Som de explos√£o
                    playExplosionSound();
                    return;
            }
            
            // Criar oscilador
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = 'sine';
            
            // Configurar envelope
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        function playChord(frequencies, duration) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioContext = new AudioContext();
            const gainNode = audioContext.createGain();
            
            gainNode.connect(audioContext.destination);
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            frequencies.forEach(freq => {
                const oscillator = audioContext.createOscillator();
                oscillator.connect(gainNode);
                oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                oscillator.type = 'sine';
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            });
        }
        
        function playExplosionSound() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioContext = new AudioContext();
            const bufferSize = audioContext.sampleRate * 0.5;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const output = buffer.getChannelData(0);
            
            // Gerar ru√≠do branco
            for (let i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }
            
            const whiteNoise = audioContext.createBufferSource();
            whiteNoise.buffer = buffer;
            
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            whiteNoise.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(1000, audioContext.currentTime);
            filter.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 1);
            
            gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            
            whiteNoise.start(audioContext.currentTime);
            whiteNoise.stop(audioContext.currentTime + 1);
        }

        // ================ LOCAL STORAGE ================
        function saveGameData() {
            const data = {
                xp: gameData.xp,
                level: gameData.level,
                xpToNextLevel: gameData.xpToNextLevel,
                achievements: gameData.achievements,
                settings: gameData.settings,
                powerUps: gameData.powerUps
            };
            localStorage.setItem('mathGameData', JSON.stringify(data));
        }

function loadGameData() {
    try {
        const data = JSON.parse(localStorage.getItem('mathGameData'));
        if (data) {
            // Carrega dados persistentes
            gameData.xp = data.xp || 0;
            gameData.level = data.level || 1;
            gameData.xpToNextLevel = data.xpToNextLevel || 100;
            gameData.achievements = data.achievements || [];
            gameData.settings = data.settings || { sound: true };
            
            // IMPORTANTE: Carrega o estoque de power-ups salvo
            if (data.powerUps) {
                gameData.powerUps = data.powerUps;
            }

            // Atualizar status das conquistas
            achievements.forEach(ach => {
                ach.unlocked = gameData.achievements.includes(ach.id);
            });
        }
    } catch (e) {
        console.error("Erro ao carregar save:", e);
    }

    // Configurar som na UI
    const soundToggle = document.getElementById('sound-toggle');
    if (soundToggle && gameData.settings) {
        soundToggle.value = gameData.settings.sound.toString();
        localStorage.setItem('soundEnabled', gameData.settings.sound);
    }

    // === ATUALIZA√á√ÉO VISUAL IMEDIATA ===
    // Isso garante que a tela inicial mostre os n√∫meros reais do banco de dados
    updateAchievementsDisplay();
    updateThemeDisplay();
    updateLevelDisplay();
    updatePowerUpDisplay(); // <--- Essa linha corrige o n√∫mero na tela inicial
}

        function saveRecords() {
            const accuracy = (gameData.correctAnswers / gameData.totalQuestions) * 100;
            const themeProgress = JSON.parse(localStorage.getItem('themeProgress') || '{}');
            
            if (!themeProgress[gameData.theme]) {
                themeProgress[gameData.theme] = { completed: 0, record: 0 };
            }
            
            // Atualizar porcentagem de conclus√£o
            themeProgress[gameData.theme].completed = Math.max(
                themeProgress[gameData.theme].completed,
                Math.floor(accuracy)
            );
            
            // Atualizar recorde de pontua√ß√£o
            if (gameData.score > (themeProgress[gameData.theme].record || 0)) {
                themeProgress[gameData.theme].record = gameData.score;
            }
            
            localStorage.setItem('themeProgress', JSON.stringify(themeProgress));
            updateThemeDisplay();
        }

        // ================ CONQUISTAS UI ================
        function updateAchievementsDisplay() {
            const list = document.getElementById('achievements-list');
            list.innerHTML = '';
            
            let unlockedCount = 0;
            
            achievements.forEach(ach => {
                const item = document.createElement('div');
                item.className = `achievement-item ${ach.unlocked ? 'unlocked' : 'locked'}`;
                
                item.innerHTML = `
                    <div class="achievement-icon">${ach.icon}</div>
                    <div class="achievement-info">
                        <h4>${ach.name}</h4>
                        <p>${ach.description}</p>
                        <p style="font-size: 10px; color: ${ach.unlocked ? '#4caf50' : '#f44336'}">
                            ${ach.unlocked ? '‚úÖ Desbloqueado' : 'üîí Bloqueado'} ‚Ä¢ ${ach.xp} XP
                        </p>
                    </div>
                `;
                
                list.appendChild(item);
                if (ach.unlocked) unlockedCount++;
            });
            
            document.getElementById('achievement-count').textContent = unlockedCount;
        }

       function showUnlockedAchievements(achievementIds) {
    const container = document.getElementById('new-achievements');
    const list = document.getElementById('achievements-unlocked');
    list.innerHTML = '';
    
    achievementIds.forEach(id => {
        const ach = achievements.find(a => a.id === id);
        if (ach) {
            const item = document.createElement('div');
            item.className = 'achievement-item unlocked';
            item.style.marginBottom = '10px';
            item.innerHTML = `
                <div class="achievement-icon">${ach.icon}</div>
                <div class="achievement-info">
                    <h4>${ach.name}</h4>
                    <p>${ach.description}</p>
                    <p style="color: #4caf50; font-size: 12px;">+${ach.xp} XP ganhos!</p>
                </div>
            `;
            list.appendChild(item);
        }
    });
    
    container.style.display = 'block';
    
    // Auto-fechar ap√≥s 5 segundos
    setTimeout(() => {
        container.style.display = 'none';
    }, 5000);
}

        function toggleAchievements() {
    document.getElementById('achievements-modal').classList.add('active');
    document.body.style.overflow = 'hidden'; // Previne scroll do body
}

function closeAchievements() {
    document.getElementById('achievements-modal').classList.remove('active');
    document.body.style.overflow = ''; // Restaura scroll do body
}

       function resetGameData() {
    // 1. Resetar APENAS dados da partida moment√¢nea (Pontos, Streak, Tempo)
    gameData.currentQuestion = 0;
    gameData.score = 0;
    gameData.correctAnswers = 0;
    gameData.userAnswers = [];
    gameData.currentStreak = 0;
    gameData.maxStreak = 0;
    gameData.questionTimes = [];
    gameData.doublePointsActive = false;
    gameData.questionStartTime = null;
    gameData.timeLeft = 60; // Reinicia o tempo base

    // 2. L√≥gica de Estoque de Power-ups (CORRE√á√ÉO)
    // Se os power-ups N√ÉO existirem ou estiverem vazios (Primeira vez jogando), cria o pacote inicial.
    // Se j√° existirem (carregados do save), N√ÉO MEXE NELES.
    if (!gameData.powerUps || !gameData.powerUps.hint) {
        gameData.powerUps = {
            hint: { count: 3, used: 0 },
            skip: { count: 2, used: 0 },
            time: { count: 2, used: 0 },
            double: { count: 3, used: 0 }
        };
    }
    // Nota: Removemos a matem√°tica de "n√≠vel" daqui para n√£o resetar o estoque toda vez.
    // O jogador ganhar√° mais itens apenas na fun√ß√£o levelUpEffects().
}
        function restartGame() {
            resetGameData();
            showScreen('start-screen');
        }

        function showStats() {
            alert('üìä Estat√≠sticas:\n' +
                  `N√≠vel: ${gameData.level}\n` +
                  `XP: ${gameData.xp}/${gameData.xpToNextLevel}\n` +
                  `Conquistas: ${gameData.achievements.length}/${achievements.length}\n` +
                  `Jogos completados: ${localStorage.getItem('gamesPlayed') || 0}`);
        }

        function shareResults() {
            const accuracy = (gameData.correctAnswers / gameData.totalQuestions) * 100;
            const text = `üéÆ Acabei de jogar Matem√°tica do 9¬∫ Ano!\n` +
                        `Pontua√ß√£o: ${gameData.score} pontos\n` +
                        `Acertos: ${gameData.correctAnswers}/${gameData.totalQuestions} (${accuracy.toFixed(1)}%)\n` +
                        `N√≠vel: ${gameData.level}\n` +
                        `#Matematica #Educacao #JogoEducativo`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Meu Resultado - LIAM - Laborat√≥rio Interativo de Alfabetiza√ß√£o Matem√°tica',
                    text: text,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(text);
                alert('üìã Resultado copiado para a √°rea de transfer√™ncia!');
            }
        }

        // ================ INICIALIZA√á√ÉO FINAL ================
        // Configurar som
        if (localStorage.getItem('soundEnabled') === null) {
            localStorage.setItem('soundEnabled', 'true');
        }
        
        // Habilitar √°udio no primeiro clique do usu√°rio
        document.addEventListener('click', function enableAudio() {
            audioEnabled = true;
            // Remover o listener ap√≥s o primeiro clique
            document.removeEventListener('click', enableAudio);
        });
        
        // Contar jogos jogados
        let gamesPlayed = parseInt(localStorage.getItem('gamesPlayed') || '0');
        localStorage.setItem('gamesPlayed', (gamesPlayed + 1).toString());
        
        console.log('üéÆ Jogo de Matem√°tica carregado com sucesso!');

// ============================================================
    //  NOVOS RECURSOS: ACESSIBILIDADE E FOGOS OTIMIZADOS
    // ============================================================

    // 1. Fun√ß√£o Auxiliar de Acessibilidade (Leitor de Tela)
    function announceToScreenReader(message) {
        const announcer = document.getElementById('a11y-announcer');
        if (announcer) {
            announcer.textContent = ''; // Limpa para for√ßar o an√∫ncio
            setTimeout(() => {
                announcer.textContent = message;
            }, 100);
        }
    }

    // 2. Sistema de Fogos de Artif√≠cio Otimizado (Canvas)
    const canvas = document.getElementById('fireworks-canvas');
    let ctx = null;
    let particles = [];

    // Inicializa o contexto do canvas se ele existir
    if (canvas) {
        ctx = canvas.getContext('2d');
        
        // Ajustar tamanho
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Loop de anima√ß√£o
        function animationLoop() {
            if (particles.length > 0) {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.globalCompositeOperation = 'lighter';

                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.05;
                    p.alpha -= 0.01;

                    ctx.fillStyle = `rgba(${p.r}, ${p.g}, ${p.b}, ${p.alpha})`;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();

                    if (p.alpha <= 0) particles.splice(i, 1);
                }
            } else {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            requestAnimationFrame(animationLoop);
        }
        animationLoop();
    }

    // Fun√ß√£o principal de criar fogos (Substitui a antiga)
    function createFireworksEffect() {
        if (!ctx) return; // Seguran√ßa caso o canvas n√£o carregue
        console.log("Criando fogos (Canvas)...");
        
        // Tenta tocar som se existir
        if (typeof playSound === "function") playSound('firework');
        
        // Cria 5 explos√µes
        for(let i=0; i<5; i++) {
            setTimeout(() => {
                const x = Math.random() * canvas.width;
                const y = Math.random() * (canvas.height * 0.6);
                createExplosion(x, y);
            }, i * 300);
        }
    }

    // Fun√ß√£o auxiliar da explos√£o
    function createExplosion(x, y) {
        const particleCount = 50;
        const r = Math.floor(Math.random() * 255);
        const g = Math.floor(Math.random() * 255);
        const b = Math.floor(Math.random() * 255);

        for (let i = 0; i < particleCount; i++) {
            const angle = Math.random() * Math.PI * 2;
            const velocity = Math.random() * 6 + 2;
            
            particles.push({
                x: x, y: y,
                vx: Math.cos(angle) * velocity,
                vy: Math.sin(angle) * velocity,
                size: Math.random() * 3 + 1,
                r: r, g: g, b: b,
                alpha: 1
            });
        }
    }
    
    // Fun√ß√£o de teste para o bot√£o
    function testFireworks() {
        createFireworksEffect();
    }


    // ================ FUN√á√ïES DOS MODAIS DE TEORIA ================

function openTheoryModal() {
    const modal = document.getElementById('theory-modal');
    if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden'; // Impede a rolagem da p√°gina de fundo
    }
}

function closeTheoryModal() {
    const modal = document.getElementById('theory-modal');
    if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = ''; // Libera a rolagem
    }
}

function openTheoryContentModal(type) {
    const modal = document.getElementById(`${type}-modal`);
    if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
}

function closeTheoryContentModal(type) {
    const modal = document.getElementById(`${type}-modal`);
    if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
    }
}

// Esta fun√ß√£o voc√™ j√° tinha parcialmente, mas precisa garantir que ela existe:
function switchTheoryContent(targetTheme) {
    // Fecha qualquer modal aberto
    closeTheoryContentModal('probabilidade');
    closeTheoryContentModal('estatistica');
    
    // Abre o novo ap√≥s um breve delay para transi√ß√£o visual
    setTimeout(() => {
        openTheoryContentModal(targetTheme);
    }, 300);
}

    </script>
</body>
</html>
