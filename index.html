<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de Matem√°tica - 9¬∫ Ano</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e, #283593);
            color: white;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            position: relative;
            z-index: 10;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        


        h1 {
            text-align: center;
            margin-bottom: 25px;
            color: #ffeb3b;
            text-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
            font-size: 2.5rem;
            background: linear-gradient(90deg, #ffeb3b, #ff9800);
            background-clip: text; /* LINHA ADICIONADA */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 235, 59, 0.3);
        }
        
        /* Painel de status do jogo */
        .game-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .status-item:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .status-label {
            color: #bbdefb;
            font-size: 14px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .status-value {
            font-size: 28px;
            font-weight: bold;
            color: #ffeb3b;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .status-subtext {
            font-size: 12px;
            color: #90caf9;
            margin-top: 5px;
        }
        
        /* Sistema de conquistas */
        .achievement-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff9800, #ff5722);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
            z-index: 100;
            transition: all 0.3s;
        }
        
        .achievement-badge:hover {
            transform: scale(1.1) rotate(15deg);
        }
        
        .achievements-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 350px;
            height: 100vh;
            background: rgba(26, 35, 126, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            transition: right 0.4s ease;
            z-index: 1000;
            overflow-y: auto;
            border-left: 2px solid #ff9800;
        }
        
        .achievements-panel.active {
            right: 0;
        }
        
        .achievement-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            transition: all 0.3s;
        }
        
        .achievement-item.locked {
            opacity: 0.5;
        }
        
        .achievement-item.unlocked {
            border: 2px solid #ffeb3b;
            box-shadow: 0 0 15px rgba(255, 235, 59, 0.3);
        }
        
        .achievement-icon {
            font-size: 30px;
            margin-right: 15px;
            min-width: 50px;
            text-align: center;
        }
        
        .achievement-info h4 {
            color: #ffeb3b;
            margin-bottom: 5px;
        }
        
        .achievement-info p {
            font-size: 12px;
            color: #bbdefb;
        }
        
        /* Progresso do n√≠vel */
        .level-progress {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            position: relative;
        }
        
        .level-bar {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }
        
        .level-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .level-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Calculadora aprimorada */
        .calc-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, #4caf50, #2e7d32);
            color: white;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            border: none;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .calc-btn:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.6);
        }
        
        .calculator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 320px;
            background: #1e1e1e;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.7);
            display: none;
            flex-direction: column;
            z-index: 1001;
            border: 2px solid #444;
            overflow: hidden;
        }
        
        .calculator.active {
            display: flex;
        }
        
        .calc-header {
            background: linear-gradient(90deg, #2196f3, #1976d2);
            padding: 12px 20px;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
            color: white;
            font-weight: bold;
        }
        
        .calc-controls {
            display: flex;
            gap: 5px;
        }
        
        .calc-controls button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .calc-controls button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .calc-display {
            background: #1a1a1a;
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #444;
        }
        
        .calc-expression {
            color: #888;
            font-size: 14px;
            min-height: 20px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .calc-result {
            color: white;
            font-size: 28px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            padding: 15px;
            background: #2a2a2a;
        }
        
        .calc-button {
            background: #3a3a3a;
            color: white;
            border: none;
            height: 50px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calc-button:hover {
            background: #4a4a4a;
        }
        
        .calc-button.operator {
            background: #ff9800;
        }
        
        .calc-button.operator:hover {
            background: #ffb74d;
        }
        
        .calc-button.equals {
            background: #4caf50;
            grid-column: span 2;
        }
        
        .calc-button.clear {
            background: #f44336;
        }
        
        /* Temas de jogo */
        .theme-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .theme-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }
        
        .theme-card:hover {
            transform: translateY(-10px);
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 152, 0, 0.3);
        }
        
        .theme-card.selected {
            background: rgba(255, 152, 0, 0.2);
            border: 2px solid #ff9800;
            box-shadow: 0 10px 25px rgba(255, 152, 0, 0.3);
        }
        
        .theme-icon {
            font-size: 50px;
            margin-bottom: 15px;
            color: #ffeb3b;
        }
        
        .theme-card h3 {
            margin-bottom: 10px;
            color: #ffeb3b;
            font-size: 1.5rem;
        }
        
        .theme-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 12px;
            color: #90caf9;
        }
        
        /* Configura√ß√µes - CORRIGIDO */
        select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: #ffeb3b;
            border: 1px solid rgba(255, 235, 59, 0.3);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        select:hover {
            border-color: #ff9800;
        }
        
        select option {
            background: #1a237e;
            color: white;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #bbdefb;
            font-weight: 500;
        }
        
        /* Quest√µes */
        .question-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #ff9800;
            animation: fadeIn 0.5s ease;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .question-number {
            background: linear-gradient(135deg, #ff9800, #ff5722);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
            box-shadow: 0 4px 10px rgba(255, 152, 0, 0.3);
        }
        
        .question-difficulty {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .difficulty-easy { color: #4caf50; }
        .difficulty-medium { color: #ff9800; }
        .difficulty-hard { color: #f44336; }
        
        .question-text {
            font-size: 1.2rem;
            line-height: 1.6;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 4px solid #2196f3;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin: 25px 0;
        }
        
        .option {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        
        .option:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateX(5px);
        }
        
        .option.selected {
            background: rgba(255, 152, 0, 0.2);
            border-color: #ff9800;
        }
        
        .option.correct {
            background: rgba(76, 175, 80, 0.2);
            border-color: #4caf50;
            animation: pulseCorrect 0.5s ease;
        }
        
        .option.incorrect {
            background: rgba(244, 67, 54, 0.2);
            border-color: #f44336;
        }
        
        @keyframes pulseCorrect {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .option-letter {
            background: rgba(255, 255, 255, 0.15);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            color: #ffeb3b;
            font-size: 16px;
        }
        
        /* Power-ups */
        .power-ups {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .power-up {
            background: rgba(156, 39, 176, 0.3);
            border: 2px solid #9c27b0;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .power-up:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(156, 39, 176, 0.5);
        }
        
        .power-up:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .power-up-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Bot√µes */
        .btn {
            background: linear-gradient(90deg, #ff9800, #ff5722);
            color: white;
            border: none;
            padding: 15px 35px;
            font-size: 16px;
            border-radius: 30px;
            cursor: pointer;
            margin: 10px;
            font-weight: bold;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
        }
        
        .btn:hover:not(:disabled) {
            opacity: 0.9;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 152, 0, 0.6);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, #2196f3, #1976d2);
        }
        
        /* Feedback */
        .feedback-card {
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            animation: slideIn 0.5s ease;
            display: none;
        }
        
        .feedback-card.correct {
            background: rgba(76, 175, 80, 0.2);
            border: 2px solid #4caf50;
        }
        
        .feedback-card.incorrect {
            background: rgba(244, 67, 54, 0.2);
            border: 2px solid #f44336;
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Tela de resultados */
        .results-container {
            text-align: center;
            animation: fadeIn 0.8s ease;
        }
        
        .trophy {
            font-size: 80px;
            color: #ffeb3b;
            margin: 20px 0;
            animation: bounce 1s ease infinite alternate;
        }
        
        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-20px); }
        }
        
        .score-display {
            font-size: 60px;
            font-weight: bold;
            background: linear-gradient(90deg, #ffeb3b, #ff9800);
            background-clip: text; /* LINHA ADICIONADA */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 20px 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Anima√ß√µes */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .theme-selection {
                grid-template-columns: 1fr;
            }
            
            .game-status {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .calculator {
                width: 90%;
                left: 5%;
                top: 50px;
                transform: translateX(-50%);
            }
            
            .achievements-panel {
                width: 100%;
                right: -100%;
            }
        }
        
        /* Efeitos especiais - Fogos de artif√≠cio */
        .firework {
            position: fixed;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
        }
        
        .firework-particle {
            position: fixed;
            pointer-events: none;
            border-radius: 50%;
            z-index: 9998;
        }
        
        .firework-trail {
            position: fixed;
            pointer-events: none;
            border-radius: 50%;
            z-index: 9997;
        }
        
        /* Streak indicator */
        .streak-indicator {
            position: absolute;
            top: -40px;
            right: 20px;
            background: linear-gradient(135deg, #ff5722, #d81b60);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: none;
            animation: pulseStreak 1s infinite;
        }
        
        @keyframes pulseStreak {
            0% { box-shadow: 0 0 0 0 rgba(255, 87, 34, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 87, 34, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 87, 34, 0); }
        }
        
        /* Timer */
        .timer-container {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto;
        }
        
        .timer-circle {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        .timer-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 8;
        }
        
        .timer-progress {
            fill: none;
            stroke: #4caf50;
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 1s linear;
        }
        
/* Adicione este estilo na se√ß√£o .btn */
.download-btn {
    background: linear-gradient(90deg, #4caf50, #2e7d32);
}

.download-btn:hover:not(:disabled) {
    background: linear-gradient(90deg, #66bb6a, #388e3c);
}


        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            font-weight: bold;
            color: #ffeb3b;
        }
        
        /* Bot√£o de teste de fogos */
        .test-fireworks-btn {
            background: linear-gradient(90deg, #ff5722, #d81b60);
        }
        
        /* Anima√ß√£o de explos√£o de fogos */
        @keyframes firework {
            0% { 
                transform: translate(var(--x), var(--initialY));
                width: var(--initialSize);
                height: var(--initialSize);
                opacity: 1;
            }
            50% { 
                width: 0.5vmin;
                height: 0.5vmin;
            }
            100% { 
                transform: translate(var(--x), var(--y));
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Bot√£o de conquistas -->
        <div class="achievement-badge" id="achievement-btn">
            üèÜ
            <span class="achievement-count" id="achievement-count">0</span>
        </div>
        
        <!-- Painel de conquistas -->
        <div class="achievements-panel" id="achievements-panel">
            <h3 style="color: #ffeb3b; margin-bottom: 20px;">üèÜ Conquistas</h3>
            <div id="achievements-list">
                <!-- Conquistas ser√£o adicionadas aqui -->
            </div>
            <button class="btn" onclick="closeAchievements()" style="margin-top: 20px; width: 100%;">Fechar</button>
        </div>
        
        <h1>üéÆ Jogo de Matem√°tica - 9¬∫ Ano</h1>
        
        <!-- Status do jogo -->
        <div class="game-status">
            <div class="status-item">
                <div class="status-label">Tema</div>
                <div class="status-value" id="current-theme">-</div>
            </div>
            <div class="status-item">
                <div class="status-label">Pontua√ß√£o</div>
                <div class="status-value" id="score">0</div>
                <div class="status-subtext" id="streak">Streak: 0</div>
            </div>
            <div class="status-item">
                <div class="status-label">Quest√£o</div>
                <div class="status-value" id="question-counter">0/10</div>
                <div class="status-subtext" id="difficulty">N√≠vel: -</div>
            </div>
            <div class="status-item">
                <div class="status-label">N√≠vel</div>
                <div class="status-value" id="level">1</div>
                <div class="status-subtext" id="xp">0/100 XP</div>
            </div>
        </div>
        
        <!-- Barra de progresso do n√≠vel -->
        <div class="level-progress">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span>Progresso do N√≠vel</span>
                <span id="level-percentage">0%</span>
            </div>
            <div class="level-bar">
                <div class="level-fill" id="level-fill"></div>
            </div>
        </div>
        
        <!-- Streak indicator -->
        <div class="streak-indicator" id="streak-indicator">
            üî• Streak: <span id="current-streak">0</span>
        </div>
        
        <!-- Bot√£o da calculadora -->
        <button class="calc-btn" id="open-calc">üî¢</button>
        
        <!-- Calculadora - AGORA FUNCIONAL -->
        <div class="calculator" id="calculator">
            <div class="calc-header" id="calc-header">
                <div class="calc-title">Calculadora Cient√≠fica</div>
                <div class="calc-controls">
                    <button id="minimize-calc">‚àí</button>
                    <button id="close-calc">√ó</button>
                </div>
            </div>
            <div class="calc-display">
                <div class="calc-expression" id="calc-expression">0</div>
                <div class="calc-result" id="calc-result">0</div>
            </div>
            <div class="calc-buttons">
                <button class="calc-button clear" onclick="calcClear()">C</button>
                <button class="calc-button clear" onclick="calcClearEntry()">CE</button>
                <button class="calc-button" onclick="calcBackspace()">‚å´</button>
                <button class="calc-button operator" onclick="calcOperator('/')">√∑</button>
                <button class="calc-button operator" onclick="calcSqrt()">‚àö</button>
                
                <button class="calc-button" onclick="calcNumber(7)">7</button>
                <button class="calc-button" onclick="calcNumber(8)">8</button>
                <button class="calc-button" onclick="calcNumber(9)">9</button>
                <button class="calc-button operator" onclick="calcOperator('*')">√ó</button>
                <button class="calc-button operator" onclick="calcPower()">x¬≤</button>
                
                <button class="calc-button" onclick="calcNumber(4)">4</button>
                <button class="calc-button" onclick="calcNumber(5)">5</button>
                <button class="calc-button" onclick="calcNumber(6)">6</button>
                <button class="calc-button operator" onclick="calcOperator('-')">‚àí</button>
                <button class="calc-button operator" onclick="calcPercent()">%</button>
                
                <button class="calc-button" onclick="calcNumber(1)">1</button>
                <button class="calc-button" onclick="calcNumber(2)">2</button>
                <button class="calc-button" onclick="calcNumber(3)">3</button>
                <button class="calc-button operator" onclick="calcOperator('+')">+</button>
                <button class="calc-button" onclick="calcPi()">œÄ</button>
                
                <button class="calc-button" onclick="calcPlusMinus()">¬±</button>
                <button class="calc-button" onclick="calcNumber(0)">0</button>
                <button class="calc-button" onclick="calcDecimal()">.</button>
                <button class="calc-button equals" onclick="calcEquals()">=</button>
            </div>
        </div>
        
        <!-- Timer circular -->
        <div class="timer-container" id="timer-container" style="display: none;">
            <svg width="100" height="100" viewBox="0 0 100 100" class="timer-circle">
                <circle cx="50" cy="50" r="45" class="timer-bg"></circle>
                <circle cx="50" cy="50" r="45" class="timer-progress" id="timer-progress"></circle>
            </svg>
            <div class="timer-text" id="timer-text">30</div>
        </div>
        
        <!-- Tela inicial -->
        <div class="screen" id="start-screen" style="display: block;">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="font-size: 60px; margin-bottom: 20px;">üßÆ</div>
                <h2>Escolha o Tema</h2>
                <p style="color: #bbdefb; max-width: 600px; margin: 0 auto;">Teste seus conhecimentos em Matem√°tica do 9¬∫ ano. Use a calculadora para ajudar nos c√°lculos!</p>
            </div>
            
            <div class="theme-selection">
                <div class="theme-card" data-theme="probabilidade">
                    <div class="theme-icon">üìä</div>
                    <h3>Probabilidade</h3>
                    <p>Aulas 1-8: Eventos dependentes e independentes, c√°lculo de probabilidades</p>
                    <div class="theme-stats">
                        <span>üîì Conclu√≠do: <span id="probabilidade-progress">0%</span></span>
                        <span>üèÜ Recorde: <span id="probabilidade-record">0</span></span>
                    </div>
                </div>
                
                <div class="theme-card" data-theme="estatistica">
                    <div class="theme-icon">üìà</div>
                    <h3>Estat√≠stica</h3>
                    <p>Aulas 18-35: Gr√°ficos, m√©dia, mediana, moda, an√°lise de dados</p>
                    <div class="theme-stats">
                        <span>üîì Conclu√≠do: <span id="estatistica-progress">0%</span></span>
                        <span>üèÜ Recorde: <span id="estatistica-record">0</span></span>
                    </div>
                </div>
            </div>
            
            <!-- Configura√ß√µes - CORRIGIDO -->
            <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 30px 0;">
                <h3 style="color: #ffeb3b; margin-bottom: 15px;">‚öôÔ∏è Configura√ß√µes</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div>
                        <label for="question-count">N√∫mero de quest√µes:</label>
                        <select id="question-count">
                            <option value="5">5 quest√µes</option>
                            <option value="10" selected>10 quest√µes</option>
                            <option value="15">15 quest√µes</option>
                            <option value="20">20 quest√µes</option>
                        </select>
                    </div>
                    <div>
                        <label for="time-limit">Tempo por quest√£o:</label>
                        <select id="time-limit">
                            <option value="0">Sem limite</option>
                            <option value="30">30 segundos</option>
                            <option value="60" selected>1 minuto</option>
                            <option value="90">1 minuto 30</option>
                        </select>
                    </div>
                    <div>
                        <label for="difficulty-level">Dificuldade:</label>
                        <select id="difficulty-level">
                            <option value="mixed">Misturada</option>
                            <option value="easy">F√°cil</option>
                            <option value="medium" selected>M√©dio</option>
                            <option value="hard">Dif√≠cil</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Power-ups dispon√≠veis -->
            <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 30px 0;">
                <h3 style="color: #ffeb3b; margin-bottom: 15px;">‚ú® Power-ups</h3>
                <div class="power-ups" style="justify-content: center;">
                    <div class="power-up" data-power="hint" title="Dica extra (3 dispon√≠veis)">
                        üí°
                        <div class="power-up-count" id="hint-count">3</div>
                    </div>
                    <div class="power-up" data-power="skip" title="Pular quest√£o (2 dispon√≠veis)">
                        ‚è≠Ô∏è
                        <div class="power-up-count" id="skip-count">2</div>
                    </div>
                    <div class="power-up" data-power="time" title="+30 segundos (1 dispon√≠vel)">
                        ‚è±Ô∏è
                        <div class="power-up-count" id="time-count">1</div>
                    </div>
                    <div class="power-up" data-power="double" title="Pontos em dobro (1 dispon√≠vel)">
                        ‚ú®
                        <div class="power-up-count" id="double-count">1</div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button class="btn" id="start-btn">üéÆ Iniciar Jogo</button>
                <button class="btn btn-secondary" onclick="showStats()">üìä Ver Estat√≠sticas</button>
                <button class="btn test-fireworks-btn" onclick="testFireworks()" style="margin-top: 10px;">üéÜ Testar Fogos de Artif√≠cio</button>
                <button class="btn" onclick="testAudio()" style="background: linear-gradient(90deg, #2196f3, #1976d2); margin-top: 10px;">üîä Testar Som</button>
            </div>
        </div>
        
        <!-- Tela de perguntas -->
        <div class="screen" id="question-screen" style="display: none;">
            <div class="question-header">
                <div class="question-number" id="question-number">1</div>
                <div class="question-difficulty" id="question-difficulty">M√©dio</div>
            </div>
            
            <div class="question-card">
                <div class="question-text" id="question-text">
                    Carregando pergunta...
                </div>
                
                <div class="options-grid" id="options-container">
                    <!-- Op√ß√µes ser√£o inseridas aqui -->
                </div>
            </div>
            
            <!-- Power-ups durante o jogo -->
            <div class="power-ups" id="game-power-ups">
                <div class="power-up" data-power="hint" title="Dica extra" onclick="usePowerUp('hint')">
                    üí°
                    <div class="power-up-count" id="game-hint-count">3</div>
                </div>
                <div class="power-up" data-power="skip" title="Pular quest√£o" onclick="usePowerUp('skip')">
                    ‚è≠Ô∏è
                    <div class="power-up-count" id="game-skip-count">2</div>
                </div>
                <div class="power-up" data-power="time" title="+30 segundos" onclick="usePowerUp('time')">
                    ‚è±Ô∏è
                    <div class="power-up-count" id="game-time-count">1</div>
                </div>
                <div class="power-up" data-power="double" title="Pontos em dobro" onclick="usePowerUp('double')">
                    ‚ú®
                    <div class="power-up-count" id="game-double-count">1</div>
                </div>
            </div>
            
            <!-- Feedback -->
            <div class="feedback-card correct" id="correct-feedback">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 30px;">‚úÖ</div>
                    <div>
                        <h3 style="color: #4caf50; margin-bottom: 5px;">Resposta Correta!</h3>
                        <p>Voc√™ ganhou <span id="points-earned">0</span> pontos!</p>
                        <p id="bonus-info" style="font-size: 12px; color: #90caf9;"></p>
                    </div>
                </div>
            </div>
            
            <div class="feedback-card incorrect" id="incorrect-feedback">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 30px;">‚ùå</div>
                    <div>
                        <h3 style="color: #f44336; margin-bottom: 5px;">Resposta Incorreta</h3>
                        <p>A resposta correta √©: <span id="correct-answer"></span></p>
                        <p id="explanation" style="font-size: 14px; margin-top: 10px;"></p>
                    </div>
                </div>
            </div>
            
            <div class="game-controls" style="display: flex; justify-content: center; gap: 20px; margin-top: 30px;">
                <button class="btn" id="next-btn" disabled>Pr√≥xima Quest√£o</button>
                <button class="btn btn-secondary" id="hint-btn" onclick="showHint()">üí° Pedir Dica</button>
            </div>
        </div>
        
        <!-- Tela de resultados -->
        <div class="screen" id="results-screen" style="display: none;">
            <div class="results-container">
                <div class="trophy" id="trophy">üèÜ</div>
                
                <h2 style="margin-bottom: 20px;">Desafio Conclu√≠do!</h2>
                
                <div class="score-display" id="final-score">0%</div>
                <div style="color: #bbdefb; font-size: 18px; margin-bottom: 30px;">Sua pontua√ß√£o final</div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="status-label">Acertos</div>
                        <div class="status-value" id="final-correct">0</div>
                        <div class="status-subtext" id="accuracy">0% de precis√£o</div>
                    </div>
                    <div class="stat-card">
                        <div class="status-label">Pontos</div>
                        <div class="status-value" id="final-points">0</div>
                        <div class="status-subtext" id="bonus-points">+0 b√¥nus</div>
                    </div>
                    <div class="stat-card">
                        <div class="status-label">Tempo M√©dio</div>
                        <div class="status-value" id="avg-time">0s</div>
                        <div class="status-subtext" id="time-saved">-0s com power-ups</div>
                    </div>
                    <div class="stat-card">
                        <div class="status-label">Streak M√°xima</div>
                        <div class="status-value" id="max-streak">0</div>
                        <div class="status-subtext" id="streak-bonus">+0 pontos</div>
                    </div>
                </div>
                
                <!-- Novas conquistas desbloqueadas -->
                <div id="new-achievements" style="display: none; background: rgba(255, 235, 59, 0.1); padding: 20px; border-radius: 15px; margin: 30px 0; border: 2px solid #ffeb3b;">
                    <h3 style="color: #ffeb3b; margin-bottom: 15px;">üéâ Novas Conquistas!</h3>
                    <div id="achievements-unlocked"></div>
                </div>
                
                <!-- Resumo das respostas -->
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 30px 0;">
                    <h3 style="color: #ffeb3b; margin-bottom: 15px;">üìã Resumo das Respostas</h3>
                    <div id="answers-summary" style="max-height: 300px; overflow-y: auto; padding-right: 10px;">
                        <!-- Resumo ser√° inserido aqui -->
                    </div>
                </div>
                
                <!-- Gr√°fico de desempenho -->
                <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin: 30px 0;">
                    <h3 style="color: #ffeb3b; margin-bottom: 15px;">üìä Seu Desempenho</h3>
                    <canvas id="performance-chart" width="400" height="200" style="width: 100%; max-width: 600px; margin: 0 auto;"></canvas>
                </div>
                
                
                <!-- No final da tela de resultados, ap√≥s os outros bot√µes -->
<div style="text-align: center; margin-top: 30px;">
    <button class="btn" id="restart-btn">üîÑ Jogar Novamente</button>
    <button class="btn btn-secondary" id="change-theme-btn">üéØ Mudar Tema</button>
    <button class="btn" onclick="shareResults()" style="background: linear-gradient(90deg, #2196f3, #1976d2);">üì§ Compartilhar</button>
    <!-- NOVO BOT√ÉO DE DOWNLOAD -->
    <button class="btn" id="download-stats-btn" style="background: linear-gradient(90deg, #4caf50, #2e7d32);">üì• Baixar Estat√≠sticas</button>
</div>
            </div>
        </div>
    </div>

    <!-- √Åudio para efeitos sonoros - URLs alternativas -->
    <audio id="correct-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="incorrect-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="level-up-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="achievement-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-trumpet-2018.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="powerup-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-magic-sparkles-300.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Som de fogos de artif√≠cio - URLs alternativas -->
    <audio id="firework-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-fireworks-show-audio-3065.mp3" type="audio/mpeg">
    </audio>

    <!-- Biblioteca Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // ================ DADOS DO JOGO ================
        const gameData = {
            theme: null,
            currentQuestion: 0,
            score: 0,
            correctAnswers: 0,
            totalQuestions: 10,
            questions: [],
            userAnswers: [],
            currentStreak: 0,
            maxStreak: 0,
            startTime: null,
            questionTimes: [],
            powerUps: {
                hint: { count: 3, used: 0 },
                skip: { count: 2, used: 0 },
                time: { count: 1, used: 0 },
                double: { count: 1, used: 0 }
            },
            xp: 0,
            level: 1,
            xpToNextLevel: 100,
            achievements: [],
            settings: {
                questionCount: 10,
                timeLimit: 60,
                difficulty: 'medium'
            },
            timer: null,
            timeLeft: 60,
            doublePointsActive: false
        };

        // ================ DADOS DA CALCULADORA ================
        let calcData = {
            display: '0',
            expression: '0',
            firstNum: null,
            operator: null,
            waitingForSecond: false
        };

        // ================ CONQUISTAS ================
        const achievements = [
            { id: 'first_game', name: 'Primeiro Jogo', description: 'Complete seu primeiro jogo', icon: 'üéÆ', unlocked: false, xp: 50 },
            { id: 'perfect_score', name: 'Perfei√ß√£o', description: 'Acertar 100% das quest√µes', icon: 'üíØ', unlocked: false, xp: 100 },
            { id: 'speed_demon', name: 'Dem√¥nio da Velocidade', description: 'Responder todas em menos de 30s cada', icon: '‚ö°', unlocked: false, xp: 75 },
            { id: 'streak_master', name: 'Mestre da Sequ√™ncia', description: 'Alcan√ßar streak de 10 acertos', icon: 'üî•', unlocked: false, xp: 80 },
            { id: 'power_user', name: 'Usu√°rio de Power-ups', description: 'Usar todos os power-ups em um jogo', icon: '‚ú®', unlocked: false, xp: 60 },
            { id: 'calculator_pro', name: 'Profissional da Calculadora', description: 'Usar calculadora 10 vezes', icon: 'üßÆ', unlocked: false, xp: 40 },
            { id: 'theme_master', name: 'Mestre dos Temas', description: 'Completar todos os temas', icon: 'üëë', unlocked: false, xp: 150 },
            { id: 'level_10', name: 'N√≠vel 10', description: 'Alcan√ßar o n√≠vel 10', icon: 'üåü', unlocked: false, xp: 200 },
            { id: 'hint_saver', name: 'Economizador de Dicas', description: 'Completar jogo sem usar dicas', icon: 'üí°', unlocked: false, xp: 70 },
            { id: 'persistent', name: 'Persistente', description: 'Jogar 5 vezes', icon: 'üí™', unlocked: false, xp: 90 }
        ];

        // ================ BANCO DE QUEST√ïES AMPLIADO ================
        const questions = {
            probabilidade: [
                {
                    question: "Em uma urna h√° 5 bolas vermelhas, 3 azuis e 2 verdes. Qual a probabilidade de retirar uma bola azul?",
                    options: ["3/10", "1/2", "3/5", "2/5"],
                    correct: 0,
                    hint: "Probabilidade = casos favor√°veis / casos totais. Casos favor√°veis: 3, Total: 10",
                    explanation: "P = 3/10 = 0.3 = 30%",
                    difficulty: "easy",
                    points: 10
                },
                {
                    question: "Dois eventos A e B s√£o independentes se:",
                    options: [
                        "A ocorr√™ncia de A n√£o afeta a probabilidade de B",
                        "A e B n√£o podem ocorrer ao mesmo tempo",
                        "A ocorr√™ncia de A sempre leva √† ocorr√™ncia de B",
                        "A e B t√™m a mesma probabilidade"
                    ],
                    correct: 0,
                    hint: "Eventos independentes n√£o se influenciam mutuamente",
                    explanation: "Eventos independentes t√™m P(A‚à©B) = P(A) √ó P(B)",
                    difficulty: "medium",
                    points: 15
                },
                {
                    question: "Jo√£o lan√ßa um dado honesto. Qual a probabilidade de sair um n√∫mero primo?",
                    options: ["1/2", "2/3", "1/3", "1/6"],
                    correct: 0,
                    hint: "N√∫meros primos no dado: 2, 3, 5",
                    explanation: "N√∫meros primos: {2, 3, 5} ‚Üí 3 casos favor√°veis de 6",
                    difficulty: "easy",
                    points: 10
                },
                {
                    question: "Uma moeda √© lan√ßada 3 vezes. Qual a probabilidade de obter exatamente 2 caras?",
                    options: ["3/8", "1/2", "1/4", "1/8"],
                    correct: 0,
                    hint: "Use combina√ß√µes: C(3,2) = 3 combina√ß√µes poss√≠veis",
                    explanation: "Total de casos: 2¬≥ = 8. Casos com 2 caras: 3. P = 3/8",
                    difficulty: "medium",
                    points: 15
                },
                {
                    question: "Para eventos dependentes, P(A e B) = ?",
                    options: ["P(A) √ó P(B|A)", "P(A) + P(B)", "P(A) √ó P(B)", "P(A) / P(B)"],
                    correct: 0,
                    hint: "Probabilidade condicional considera a influ√™ncia entre eventos",
                    explanation: "P(A‚à©B) = P(A) √ó P(B|A) quando A e B s√£o dependentes",
                    difficulty: "hard",
                    points: 20
                },
                {
                    question: "Qual a probabilidade de tirar um √°s de um baralho de 52 cartas?",
                    options: ["1/13", "1/4", "1/52", "4/52"],
                    correct: 0,
                    hint: "H√° 4 ases em 52 cartas",
                    explanation: "4/52 = 1/13 ‚âà 7.69%",
                    difficulty: "easy",
                    points: 10
                },
                {
                    question: "Se P(A) = 0.3 e P(B) = 0.4, e A e B s√£o independentes, qual √© P(A e B)?",
                    options: ["0.12", "0.7", "0.1", "0.3"],
                    correct: 0,
                    hint: "Para eventos independentes: P(A‚à©B) = P(A) √ó P(B)",
                    explanation: "0.3 √ó 0.4 = 0.12",
                    difficulty: "medium",
                    points: 15
                },
                {
                    question: "Em uma sala com 30 alunos, 18 gostam de matem√°tica. Qual a probabilidade de escolher aleatoriamente um aluno que N√ÉO goste de matem√°tica?",
                    options: ["2/5", "3/5", "12/30", "18/30"],
                    correct: 0,
                    hint: "Alunos que n√£o gostam: 30 - 18 = 12",
                    explanation: "12/30 = 2/5 = 40%",
                    difficulty: "easy",
                    points: 10
                },
                {
                    question: "Qual √© o espa√ßo amostral no lan√ßamento de dois dados?",
                    options: ["36 resultados", "12 resultados", "6 resultados", "24 resultados"],
                    correct: 0,
                    hint: "Cada dado tem 6 faces, totalizando 6√ó6 combina√ß√µes",
                    explanation: "6 √ó 6 = 36 resultados poss√≠veis",
                    difficulty: "medium",
                    points: 15
                },
                {
                    question: "Se a probabilidade de chover √© 0.3 e a probabilidade de tr√¢nsito intenso √© 0.5, qual a probabilidade de N√ÉO chover?",
                    options: ["0.7", "0.5", "0.2", "0.3"],
                    correct: 0,
                    hint: "P(n√£o A) = 1 - P(A)",
                    explanation: "1 - 0.3 = 0.7 = 70%",
                    difficulty: "easy",
                    points: 10
                }
            ],
            estatistica: [
                {
                    question: "Qual medida de tend√™ncia central √© mais afetada por valores extremos?",
                    options: ["M√©dia", "Mediana", "Moda", "Amplitude"],
                    correct: 0,
                    hint: "Ela considera todos os valores na sua f√≥rmula",
                    explanation: "A m√©dia aritm√©tica √© sens√≠vel a valores extremos (outliers)",
                    difficulty: "easy",
                    points: 10
                },
                {
                    question: "No conjunto {2, 4, 6, 8, 10}, qual √© a mediana?",
                    options: ["6", "5", "4", "8"],
                    correct: 0,
                    hint: "Valor do meio quando ordenado",
                    explanation: "Conjunto j√° ordenado, valor central: 6",
                    difficulty: "easy",
                    points: 10
                },
                {
                    question: "Qual gr√°fico √© melhor para mostrar partes de um todo?",
                    options: ["Gr√°fico de pizza", "Gr√°fico de barras", "Histograma", "Gr√°fico de linha"],
                    correct: 0,
                    hint: "Pense em fatias de pizza representando porcentagens",
                    explanation: "Gr√°fico de pizza (setores) mostra propor√ß√µes de um total",
                    difficulty: "easy",
                    points: 10
                },
                {
                    question: "Amplitude = ?",
                    options: ["Maior valor - menor valor", "(Maior + menor)/2", "Soma/quantidade", "Valor mais frequente"],
                    correct: 0,
                    hint: "Diferen√ßa entre os valores extremos",
                    explanation: "Amplitude = valor m√°ximo - valor m√≠nimo",
                    difficulty: "easy",
                    points: 10
                },
                {
                    question: "Moda de {3, 5, 5, 7, 7, 7, 9, 9} √©:",
                    options: ["7", "5", "9", "N√£o tem"],
                    correct: 0,
                    hint: "Valor que mais se repete",
                    explanation: "O n√∫mero 7 aparece 3 vezes, mais que qualquer outro",
                    difficulty: "easy",
                    points: 10
                },
                {
                    question: "Qual √© a m√©dia de {10, 15, 20, 25, 30}?",
                    options: ["20", "25", "22", "18"],
                    correct: 0,
                    hint: "Soma todos e divide pela quantidade",
                    explanation: "(10+15+20+25+30)/5 = 100/5 = 20",
                    difficulty: "easy",
                    points: 10
                },
                {
                    question: "Para dados agrupados em classes, usamos:",
                    options: ["Histograma", "Gr√°fico de pizza", "Gr√°fico de linha", "Gr√°fico de dispers√£o"],
                    correct: 0,
                    hint: "Gr√°fico de barras para intervalos de valores",
                    explanation: "Histograma √© usado para distribui√ß√£o de frequ√™ncias em classes",
                    difficulty: "medium",
                    points: 15
                },
                {
                    question: "Qual medida n√£o √© de tend√™ncia central?",
                    options: ["Amplitude", "M√©dia", "Mediana", "Moda"],
                    correct: 0,
                    hint: "Esta √© uma medida de dispers√£o",
                    explanation: "Amplitude mede a variabilidade, n√£o a tend√™ncia central",
                    difficulty: "medium",
                    points: 15
                },
                {
                    question: "No conjunto {1, 2, 2, 3, 4, 4, 4, 5}, qual √© a moda?",
                    options: ["4", "2", "3", "Bimodal (2 e 4)"],
                    correct: 0,
                    hint: "Valor com maior frequ√™ncia",
                    explanation: "O n√∫mero 4 aparece 3 vezes, mais que qualquer outro",
                    difficulty: "easy",
                    points: 10
                },
                {
                    question: "Desvio padr√£o mede:",
                    options: ["Dispers√£o dos dados", "Tend√™ncia central", "Assimetria", "Correla√ß√£o"],
                    correct: 0,
                    hint: "Como os dados est√£o espalhados em rela√ß√£o √† m√©dia",
                    explanation: "Desvio padr√£o mede a dispers√£o (variabilidade) dos dados",
                    difficulty: "medium",
                    points: 15
                }
            ]
        };

        // ================ INICIALIZA√á√ÉO ================
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM carregado, inicializando...");
            
            // Carregar dados salvos
            loadGameData();
            
            // Configurar sele√ß√£o de temas
            document.querySelectorAll('.theme-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.theme-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    gameData.theme = card.dataset.theme;
                    updateThemeDisplay();
                    console.log("Tema selecionado:", gameData.theme);
                });
            });
            
            // Configurar bot√µes
            document.getElementById('start-btn').addEventListener('click', startGame);
            document.getElementById('next-btn').addEventListener('click', nextQuestion);
            document.getElementById('restart-btn').addEventListener('click', restartGame);
            document.getElementById('change-theme-btn').addEventListener('click', () => {
                showScreen('start-screen');
            });
            
            // Configurar conquistas
            document.getElementById('achievement-btn').addEventListener('click', toggleAchievements);
            
            // Configurar calculadora - CORRE√á√ÉO SIMPLIFICADA
            initCalculator();
            
            // Configurar configura√ß√µes
            document.getElementById('question-count').addEventListener('change', (e) => {
                gameData.settings.questionCount = parseInt(e.target.value);
                saveGameData();
            });
            
            document.getElementById('time-limit').addEventListener('change', (e) => {
                gameData.settings.timeLimit = parseInt(e.target.value);
                saveGameData();
            });
            
            document.getElementById('difficulty-level').addEventListener('change', (e) => {
                gameData.settings.difficulty = e.target.value;
                saveGameData();
            });
            
            // Selecionar tema padr√£o
            document.querySelector('[data-theme="probabilidade"]').click();
            
            console.log("üéÆ Jogo inicializado com sucesso!");
            
            // Inicializar √°udios
            initAudio();
        });


// ================ FUN√á√ÉO DE DOWNLOAD DE ESTAT√çSTICAS ================
function downloadStatistics() {
    // Coletar dados da partida
    const accuracy = (gameData.correctAnswers / gameData.totalQuestions) * 100;
    const avgTime = gameData.questionTimes.length > 0 ? 
        (gameData.questionTimes.reduce((a, b) => a + b) / gameData.questionTimes.length).toFixed(1) : 0;
    
    // Formatar data e hora
    const now = new Date();
    const dateStr = now.toLocaleDateString('pt-BR');
    const timeStr = now.toLocaleTimeString('pt-BR');
    
    // Criar conte√∫do do arquivo
    const statsContent = `
==========================================
ESTAT√çSTICAS DA PARTIDA - JOGO DE MATEM√ÅTICA
==========================================

üìÖ Data: ${dateStr}
‚è∞ Hora: ${timeStr}

üéÆ INFORMA√á√ïES DA PARTIDA
========================
‚Ä¢ Tema: ${gameData.theme === 'probabilidade' ? 'Probabilidade' : 'Estat√≠stica'}
‚Ä¢ Dificuldade: ${gameData.settings.difficulty}
‚Ä¢ N√∫mero de quest√µes: ${gameData.totalQuestions}
‚Ä¢ Tempo limite por quest√£o: ${gameData.settings.timeLimit > 0 ? `${gameData.settings.timeLimit}s` : 'Sem limite'}

üìä RESULTADOS
=============
‚Ä¢ Pontua√ß√£o total: ${gameData.score} pontos
‚Ä¢ Acertos: ${gameData.correctAnswers}/${gameData.totalQuestions}
‚Ä¢ Precis√£o: ${accuracy.toFixed(1)}%
‚Ä¢ Streak m√°xima: ${gameData.maxStreak} acertos consecutivos
‚Ä¢ Tempo m√©dio por quest√£o: ${avgTime}s

‚ö° DESEMPENHO
=============
‚Ä¢ N√≠vel atual: ${gameData.level}
‚Ä¢ XP ganho na partida: ${gameData.score} XP
‚Ä¢ Total de XP: ${gameData.xp}/${gameData.xpToNextLevel}

‚ú® POWER-UPS UTILIZADOS
=======================
‚Ä¢ Dicas usadas: ${gameData.powerUps.hint.used}
‚Ä¢ Quest√µes puladas: ${gameData.powerUps.skip.used}
‚Ä¢ Tempo extra usado: ${gameData.powerUps.time.used}
‚Ä¢ Pontos em dobro ativados: ${gameData.powerUps.double.used}

üèÜ DETALHES DAS QUEST√ïES
========================
${gameData.userAnswers.map((answer, index) => {
    const q = gameData.questions[index];
    let status = answer.isCorrect ? '‚úÖ CORRETO' : '‚ùå ERRADO';
    if (answer.skipped) status = '‚è≠Ô∏è PULADA';
    if (answer.timeout) status = '‚è∞ TEMPO ESGOTADO';
    
    return `Quest√£o ${index + 1}: ${status}
   Pergunta: ${answer.question}
   ${answer.isCorrect ? 
        `Pontos: ${answer.points} | Tempo: ${answer.time.toFixed(1)}s` : 
        `Resposta correta: ${q.options[answer.correctAnswer]}`
   }
   ----------------------------------------`;
}).join('\n')}

üìà RECOMENDA√á√ïES
================
${accuracy >= 90 ? 
    'Excelente desempenho! Continue assim!' :
accuracy >= 70 ?
    'Bom trabalho! Pratique um pouco mais para alcan√ßar a perfei√ß√£o.' :
accuracy >= 50 ?
    'Resultado razo√°vel. Recomendamos revisar os conceitos b√°sicos.' :
    'H√° espa√ßo para melhoria. Sugerimos estudar os conte√∫dos novamente.'}

==========================================
Jogo desenvolvido para o 9¬∫ Ano do Ensino Fundamental
==========================================
    `.trim();

    // Criar arquivo para download
    const blob = new Blob([statsContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `estatisticas-matematica-${dateStr.replace(/\//g, '-')}-${timeStr.replace(/:/g, '-')}.txt`;
    
    // Adicionar ao documento, clicar e remover
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    
    // Liberar o objeto URL
    URL.revokeObjectURL(url);
    
    // Feedback visual
    const originalText = document.getElementById('download-stats-btn').innerHTML;
    document.getElementById('download-stats-btn').innerHTML = '‚úÖ Baixado!';
    document.getElementById('download-stats-btn').disabled = true;
    
    setTimeout(() => {
        document.getElementById('download-stats-btn').innerHTML = originalText;
        document.getElementById('download-stats-btn').disabled = false;
    }, 2000);
}

// ================ CONFIGURAR O BOT√ÉO ================
// Adicione esta linha na inicializa√ß√£o (na fun√ß√£o DOMContentLoaded):
document.getElementById('download-stats-btn')?.addEventListener('click', downloadStatistics);


        // ================ CALCULADORA - C√ìDIGO SIMPLIFICADO E FUNCIONAL ================
        function initCalculator() {
            console.log("Inicializando calculadora...");
            
            // Elementos da calculadora
            const calculator = document.getElementById('calculator');
            const openCalcBtn = document.getElementById('open-calc');
            const closeCalcBtn = document.getElementById('close-calc');
            const minimizeCalcBtn = document.getElementById('minimize-calc');
            
            if (!calculator || !openCalcBtn) {
                console.error("Elementos da calculadora n√£o encontrados!");
                return;
            }
            
            // Abrir calculadora
            openCalcBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                console.log("Abrindo calculadora...");
                calculator.classList.add('active');
            });
            
            // Fechar calculadora
            closeCalcBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                calculator.classList.remove('active');
            });
            
            // Minimizar calculadora
            let minimized = false;
            minimizeCalcBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                const buttons = calculator.querySelector('.calc-buttons');
                const display = calculator.querySelector('.calc-display');
                
                if (!minimized) {
                    buttons.style.display = 'none';
                    display.style.display = 'none';
                    calculator.style.height = '60px';
                    minimized = true;
                } else {
                    buttons.style.display = 'grid';
                    display.style.display = 'block';
                    calculator.style.height = 'auto';
                    minimized = false;
                }
            });
            
            console.log("Calculadora inicializada!");
        }

        // Fun√ß√µes da calculadora
        function calcNumber(num) {
            if (calcData.waitingForSecond) {
                calcData.display = num.toString();
                calcData.waitingForSecond = false;
            } else {
                calcData.display = calcData.display === '0' ? num.toString() : calcData.display + num;
            }
            calcData.expression = calcData.display;
            updateCalcDisplay();
        }

        function calcOperator(op) {
            if (calcData.firstNum === null) {
                calcData.firstNum = parseFloat(calcData.display);
            } else if (calcData.operator && !calcData.waitingForSecond) {
                calcData.firstNum = calcCalculate();
                calcData.display = calcData.firstNum.toString();
            }
            calcData.operator = op;
            calcData.waitingForSecond = true;
            calcData.expression = `${calcData.firstNum} ${getOperatorSymbol(op)}`;
            updateCalcDisplay();
        }

        function calcEquals() {
            if (calcData.operator && calcData.firstNum !== null) {
                const result = calcCalculate();
                calcData.display = result.toString();
                calcData.expression = `${calcData.firstNum} ${getOperatorSymbol(calcData.operator)} ${calcData.display} =`;
                calcData.firstNum = null;
                calcData.operator = null;
                calcData.waitingForSecond = true;
                updateCalcDisplay();
            }
        }

        function calcClear() {
            calcData.display = '0';
            calcData.expression = '0';
            calcData.firstNum = null;
            calcData.operator = null;
            calcData.waitingForSecond = false;
            updateCalcDisplay();
        }

        function calcClearEntry() {
            calcData.display = '0';
            calcData.expression = '0';
            updateCalcDisplay();
        }

        function calcBackspace() {
            if (calcData.display.length > 1) {
                calcData.display = calcData.display.slice(0, -1);
            } else {
                calcData.display = '0';
            }
            calcData.expression = calcData.display;
            updateCalcDisplay();
        }

        function calcDecimal() {
            if (!calcData.display.includes('.')) {
                calcData.display += '.';
                calcData.expression = calcData.display;
                updateCalcDisplay();
            }
        }

        function calcSqrt() {
            calcData.display = Math.sqrt(parseFloat(calcData.display)).toString();
            calcData.expression = `‚àö(${calcData.display})`;
            updateCalcDisplay();
        }

        function calcPower() {
            calcData.display = Math.pow(parseFloat(calcData.display), 2).toString();
            calcData.expression = `(${calcData.display})¬≤`;
            updateCalcDisplay();
        }

        function calcPercent() {
            calcData.display = (parseFloat(calcData.display) / 100).toString();
            calcData.expression = `${calcData.display}%`;
            updateCalcDisplay();
        }

        function calcPi() {
            calcData.display = Math.PI.toString();
            calcData.expression = 'œÄ';
            updateCalcDisplay();
        }

        function calcPlusMinus() {
            calcData.display = (-parseFloat(calcData.display)).toString();
            calcData.expression = calcData.display;
            updateCalcDisplay();
        }

        function calcCalculate() {
            const a = calcData.firstNum;
            const b = parseFloat(calcData.display);
            
            switch(calcData.operator) {
                case '+': return a + b;
                case '-': return a - b;
                case '*': return a * b;
                case '/': return a / b;
                default: return b;
            }
        }

        function getOperatorSymbol(op) {
            switch(op) {
                case '+': return '+';
                case '-': return '‚àí';
                case '*': return '√ó';
                case '/': return '√∑';
                default: return op;
            }
        }

        function updateCalcDisplay() {
            const calcExpression = document.getElementById('calc-expression');
            const calcResult = document.getElementById('calc-result');
            
            if (calcExpression) calcExpression.textContent = calcData.expression;
            if (calcResult) calcResult.textContent = calcData.display;
        }

        // ================ FUN√á√ïES DO JOGO ================
        function startGame() {
            if (!gameData.theme) {
                alert('Escolha um tema primeiro!');
                return;
            }

            // Resetar dados do jogo
            resetGameData();
            
            // Configurar com base nas settings
            gameData.totalQuestions = gameData.settings.questionCount;
            gameData.timeLeft = gameData.settings.timeLimit;
            
            // Selecionar quest√µes
            selectQuestions();
            
            // Atualizar interface
            updateGameStatus();
            showQuestion();
            updatePowerUpDisplay();
            
            // Mostrar tela de quest√µes
            showScreen('question-screen');
            
            // Iniciar timer se configurado
            if (gameData.settings.timeLimit > 0) {
                document.getElementById('timer-container').style.display = 'block';
                startTimer();
            } else {
                document.getElementById('timer-container').style.display = 'none';
            }
            
            // Registrar in√≠cio do jogo
            gameData.startTime = Date.now();
            
            console.log("Jogo iniciado!");
        }

        function selectQuestions() {
            const allQuestions = questions[gameData.theme];
            let filteredQuestions = [...allQuestions];
            
            // Filtrar por dificuldade se n√£o for "mixed"
            if (gameData.settings.difficulty !== 'mixed') {
                filteredQuestions = filteredQuestions.filter(q => 
                    q.difficulty === gameData.settings.difficulty
                );
            }
            
            // Embaralhar e selecionar
            filteredQuestions = filteredQuestions.sort(() => Math.random() - 0.5);
            gameData.questions = filteredQuestions.slice(0, gameData.totalQuestions);
            
            // Se n√£o houver quest√µes suficientes, usar todas
            if (gameData.questions.length < gameData.totalQuestions) {
                gameData.questions = allQuestions.slice(0, gameData.totalQuestions);
            }
        }

        function showQuestion() {
            const q = gameData.questions[gameData.currentQuestion];
            
            // Atualizar interface
            document.getElementById('question-number').textContent = gameData.currentQuestion + 1;
            document.getElementById('question-text').textContent = q.question;
            document.getElementById('question-difficulty').textContent = 
                q.difficulty === 'easy' ? 'F√°cil' : 
                q.difficulty === 'medium' ? 'M√©dio' : 'Dif√≠cil';
            document.getElementById('question-difficulty').className = 
                `question-difficulty difficulty-${q.difficulty}`;
            
            // Limpar op√ß√µes anteriores
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            // Adicionar novas op√ß√µes
            ['A', 'B', 'C', 'D'].forEach((letter, index) => {
                const option = document.createElement('div');
                option.className = 'option';
                option.innerHTML = `
                    <div class="option-letter">${letter}</div>
                    <div>${q.options[index]}</div>
                `;
                
                option.addEventListener('click', () => selectOption(option, index));
                optionsContainer.appendChild(option);
            });
            
            // Resetar feedback
            document.getElementById('correct-feedback').style.display = 'none';
            document.getElementById('incorrect-feedback').style.display = 'none';
            document.getElementById('next-btn').disabled = true;
            
            // Habilitar op√ß√µes
            document.querySelectorAll('.option').forEach(o => {
                o.style.pointerEvents = 'auto';
                o.classList.remove('selected', 'correct', 'incorrect');
            });
            
            // Resetar timer
            if (gameData.settings.timeLimit > 0) {
                gameData.timeLeft = gameData.settings.timeLimit;
                updateTimerDisplay();
            }
            
            // Registrar tempo de in√≠cio da quest√£o
            gameData.questionStartTime = Date.now();
        }

        function selectOption(optionElement, selectedIndex) {
            // Desabilitar todas as op√ß√µes
            document.querySelectorAll('.option').forEach(o => {
                o.style.pointerEvents = 'none';
            });
            
            // Marcar como selecionada
            optionElement.classList.add('selected');
            
            // Verificar resposta
            checkAnswer(selectedIndex);
        }

        function checkAnswer(selectedIndex) {
            const q = gameData.questions[gameData.currentQuestion];
            const isCorrect = selectedIndex === q.correct;
            const options = document.querySelectorAll('.option');
            
            // Calcular tempo de resposta
            const responseTime = (Date.now() - gameData.questionStartTime) / 1000;
            gameData.questionTimes.push(responseTime);
            
            // Mostrar resposta correta
            options[q.correct].classList.add('correct');
            
            if (isCorrect) {
                // Acertou
                options[selectedIndex].classList.add('correct');
                
                // Calcular pontos
                let points = q.points;
                let bonusText = [];
                
                // B√¥nus por streak
                gameData.currentStreak++;
                if (gameData.currentStreak > gameData.maxStreak) {
                    gameData.maxStreak = gameData.currentStreak;
                }
                
                if (gameData.currentStreak >= 3) {
                    const streakBonus = Math.floor(gameData.currentStreak / 3) * 5;
                    points += streakBonus;
                    bonusText.push(`Streak +${streakBonus}`);
                    
                    // Mostrar indicador de streak
                    if (gameData.currentStreak >= 5) {
                        showStreakIndicator();
                    }
                }
                
                // B√¥nus por velocidade
                if (responseTime < 10) {
                    const speedBonus = 5;
                    points += speedBonus;
                    bonusText.push(`R√°pido +${speedBonus}`);
                }
                
                // B√¥nus por dificuldade
                if (q.difficulty === 'hard') points += 5;
                
                // Pontos em dobro
                if (gameData.doublePointsActive) {
                    points *= 2;
                    bonusText.push(`Dobro!`);
                    gameData.doublePointsActive = false;
                }
                
                // Adicionar pontos
                gameData.score += points;
                gameData.correctAnswers++;
                
                // Adicionar XP
                addXP(points);
                
                // Mostrar feedback
                document.getElementById('correct-feedback').style.display = 'block';
                document.getElementById('points-earned').textContent = points;
                document.getElementById('bonus-info').textContent = bonusText.length > 0 ? 
                    `B√¥nus: ${bonusText.join(', ')}` : '';
                
                // Tocar som de acerto
                playSound('correct');
                
                // Criar fogos de artif√≠cio para comemorar
                createFireworksEffect();
                
                // Verificar conquistas
                checkAchievements();
                
            } else {
                // Errou
                options[selectedIndex].classList.add('incorrect');
                gameData.currentStreak = 0;
                
                document.getElementById('incorrect-feedback').style.display = 'block';
                document.getElementById('correct-answer').textContent = 
                    q.options[q.correct];
                document.getElementById('explanation').textContent = q.explanation;
                
                playSound('incorrect');
            }
            
            // Registrar resposta do usu√°rio
            gameData.userAnswers.push({
                question: q.question,
                userAnswer: selectedIndex,
                correctAnswer: q.correct,
                isCorrect: isCorrect,
                time: responseTime,
                points: isCorrect ? q.points : 0
            });
            
            // Atualizar status
            updateGameStatus();
            
            // Habilitar pr√≥ximo bot√£o
            document.getElementById('next-btn').disabled = false;
            
            // Parar timer
            clearInterval(gameData.timer);
        }

        function nextQuestion() {
            gameData.currentQuestion++;
            
            if (gameData.currentQuestion < gameData.totalQuestions) {
                showQuestion();
                if (gameData.settings.timeLimit > 0) {
                    startTimer();
                }
            } else {
                finishGame();
            }
        }

        function finishGame() {
            // Parar timer
            clearInterval(gameData.timer);
            
            // Calcular estat√≠sticas finais
            const accuracy = (gameData.correctAnswers / gameData.totalQuestions) * 100;
            const avgTime = gameData.questionTimes.length > 0 ? 
                (gameData.questionTimes.reduce((a, b) => a + b) / gameData.questionTimes.length).toFixed(1) : 0;
            
            // Atualizar resultados
            document.getElementById('final-score').textContent = `${accuracy.toFixed(1)}%`;
            document.getElementById('final-correct').textContent = gameData.correctAnswers;
            document.getElementById('accuracy').textContent = `${accuracy.toFixed(1)}% de precis√£o`;
            document.getElementById('final-points').textContent = gameData.score;
            document.getElementById('avg-time').textContent = `${avgTime}s`;
            document.getElementById('max-streak').textContent = gameData.maxStreak;
            
            // Trof√©u baseado na pontua√ß√£o
            let trophy = 'üèÜ';
            if (accuracy >= 90) trophy = 'üëë';
            else if (accuracy >= 70) trophy = 'ü•á';
            else if (accuracy >= 50) trophy = 'ü•à';
            else trophy = 'üéñÔ∏è';
            document.getElementById('trophy').textContent = trophy;
            
            // Criar resumo
            createAnswersSummary();
            
            // Criar gr√°fico
            createPerformanceChart();
            
            // Verificar se desbloqueou novas conquistas
            checkGameAchievements();
            
            // Salvar recordes
            saveRecords();
            
            // Mostrar tela de resultados
            showScreen('results-screen');
            
            // Tocar som de vit√≥ria e fogos de artif√≠cio se boa pontua√ß√£o
            if (accuracy >= 70) {
                playSound('achievement');
                // Fogos de artif√≠cio para celebrar uma boa pontua√ß√£o
                setTimeout(() => createFireworksEffect(), 500);
            }
        }

        // ================ FOGOS DE ARTIF√çCIO - NOVO EFEITO ================
        function createFireworksEffect() {
            console.log("Criando fogos de artif√≠cio...");
            
            // Tocar som de fogos de artif√≠cio
            playSound('firework');
            
            // Cores vibrantes para os fogos
            const colors = [
                '#ff0000', '#ff8800', '#ffff00', '#00ff00', 
                '#00ffff', '#0088ff', '#8800ff', '#ff00ff',
                '#ff1493', '#ff4500', '#ffd700', '#00ff7f'
            ];
            
            // Criar m√∫ltiplas explos√µes de fogos de artif√≠cio
            const explosionCount = 8 + Math.floor(gameData.currentStreak / 2);
            
            for (let i = 0; i < explosionCount; i++) {
                // Tempo aleat√≥rio para cada explos√£o (entre 0 e 2 segundos)
                const delay = Math.random() * 2000;
                
                setTimeout(() => {
                    createSingleFireworkExplosion(colors);
                }, delay);
            }
        }
        
        function createSingleFireworkExplosion(colors) {
            // Posi√ß√£o aleat√≥ria na tela
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight * 0.7; // Limitar ao topo da tela
            
            // Criar elemento de foguete (que sobe)
            const rocket = document.createElement('div');
            rocket.className = 'firework';
            rocket.style.left = `${x}px`;
            rocket.style.top = `${window.innerHeight}px`;
            rocket.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            rocket.style.boxShadow = `0 0 10px ${rocket.style.backgroundColor}`;
            document.body.appendChild(rocket);
            
            // Anima√ß√£o do foguete subindo
            const rocketDuration = 800;
            rocket.animate([
                { 
                    transform: 'translateY(0) scale(1)', 
                    opacity: 1 
                },
                { 
                    transform: `translateY(-${window.innerHeight - y}px) scale(0.5)`, 
                    opacity: 0.8 
                }
            ], {
                duration: rocketDuration,
                easing: 'cubic-bezier(0.1, 0.8, 0.2, 1)'
            });
            
            // Quando o foguete chegar ao topo, explodir
            setTimeout(() => {
                // Remover o foguete
                if (rocket.parentNode) rocket.parentNode.removeChild(rocket);
                
                // Criar explos√£o
                createExplosion(x, y, colors);
            }, rocketDuration);
        }
        
        function createExplosion(x, y, colors) {
            const particleCount = 60 + Math.floor(Math.random() * 40);
            const explosionRadius = 80 + Math.random() * 70;
            
            for (let i = 0; i < particleCount; i++) {
                // Criar part√≠cula
                const particle = document.createElement('div');
                particle.className = 'firework-particle';
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.width = '8px';
                particle.style.height = '8px';
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                particle.style.borderRadius = '50%';
                particle.style.boxShadow = `0 0 15px ${particle.style.backgroundColor}`;
                document.body.appendChild(particle);
                
                // √Çngulo aleat√≥rio
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * explosionRadius;
                
                // Dura√ß√£o da anima√ß√£o
                const duration = 1000 + Math.random() * 1000;
                
                // Animar part√≠cula
                particle.animate([
                    { 
                        transform: 'translate(0, 0) scale(1)', 
                        opacity: 1 
                    },
                    { 
                        transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0)`, 
                        opacity: 0 
                    }
                ], {
                    duration: duration,
                    easing: 'cubic-bezier(0.1, 0.2, 0.8, 1)'
                });
                
                // Remover part√≠cula ap√≥s a anima√ß√£o
                setTimeout(() => {
                    if (particle.parentNode) particle.parentNode.removeChild(particle);
                }, duration);
            }
            
            // Criar rastros (part√≠culas menores)
            const trailCount = 20;
            for (let i = 0; i < trailCount; i++) {
                const trail = document.createElement('div');
                trail.className = 'firework-trail';
                trail.style.left = `${x}px`;
                trail.style.top = `${y}px`;
                trail.style.width = '4px';
                trail.style.height = '4px';
                trail.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                trail.style.borderRadius = '50%';
                trail.style.opacity = '0.7';
                document.body.appendChild(trail);
                
                const trailAngle = Math.random() * Math.PI * 2;
                const trailDistance = Math.random() * explosionRadius * 0.7;
                const trailDuration = 600 + Math.random() * 600;
                
                trail.animate([
                    { 
                        transform: 'translate(0, 0) scale(1)', 
                        opacity: 0.7 
                    },
                    { 
                        transform: `translate(${Math.cos(trailAngle) * trailDistance}px, ${Math.sin(trailAngle) * trailDistance}px) scale(0)`, 
                        opacity: 0 
                    }
                ], {
                    duration: trailDuration,
                    easing: 'cubic-bezier(0.1, 0.2, 0.8, 1)'
                });
                
                setTimeout(() => {
                    if (trail.parentNode) trail.parentNode.removeChild(trail);
                }, trailDuration);
            }
        }
        
        // Fun√ß√£o para testar fogos de artif√≠cio
        function testFireworks() {
            console.log("Testando fogos de artif√≠cio...");
            createFireworksEffect();
        }

        // ================ POWER-UPS ================
        function usePowerUp(power) {
            if (gameData.powerUps[power].count <= 0) return;
            
            switch(power) {
                case 'hint':
                    showHint();
                    break;
                case 'skip':
                    skipQuestion();
                    break;
                case 'time':
                    addTime(30);
                    break;
                case 'double':
                    activateDoublePoints();
                    break;
            }
            
            gameData.powerUps[power].count--;
            gameData.powerUps[power].used++;
            updatePowerUpDisplay();
            playSound('powerup');
        }

        function showHint() {
            const q = gameData.questions[gameData.currentQuestion];
            alert(`üí° Dica: ${q.hint}`);
        }

        function skipQuestion() {
            // Registrar como errada
            gameData.userAnswers.push({
                question: gameData.questions[gameData.currentQuestion].question,
                userAnswer: -1,
                correctAnswer: gameData.questions[gameData.currentQuestion].correct,
                isCorrect: false,
                time: (Date.now() - gameData.questionStartTime) / 1000,
                points: 0,
                skipped: true
            });
            
            gameData.currentStreak = 0;
            nextQuestion();
        }

        function addTime(seconds) {
            gameData.timeLeft += seconds;
            updateTimerDisplay();
            
            // Efeito visual
            const timerText = document.getElementById('timer-text');
            timerText.style.color = '#4caf50';
            setTimeout(() => {
                timerText.style.color = '#ffeb3b';
            }, 1000);
        }

        function activateDoublePoints() {
            gameData.doublePointsActive = true;
            
            // Efeito visual
            const indicator = document.createElement('div');
            indicator.textContent = '‚ú® Pontos em Dobro Ativo!';
            indicator.style.position = 'fixed';
            indicator.style.top = '50%';
            indicator.style.left = '50%';
            indicator.style.transform = 'translate(-50%, -50%)';
            indicator.style.background = 'linear-gradient(90deg, #ff9800, #ff5722)';
            indicator.style.color = 'white';
            indicator.style.padding = '15px 30px';
            indicator.style.borderRadius = '30px';
            indicator.style.fontWeight = 'bold';
            indicator.style.zIndex = '10000';
            indicator.style.animation = 'fadeIn 0.5s';
            document.body.appendChild(indicator);
            
            setTimeout(() => {
                indicator.style.opacity = '0';
                indicator.style.transform = 'translate(-50%, -50%) scale(0.8)';
                setTimeout(() => indicator.remove(), 500);
            }, 2000);
        }

        // ================ TIMER ================
        function startTimer() {
            clearInterval(gameData.timer);
            updateTimerDisplay();
            
            gameData.timer = setInterval(() => {
                gameData.timeLeft--;
                updateTimerDisplay();
                
                if (gameData.timeLeft <= 0) {
                    clearInterval(gameData.timer);
                    timeUp();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerText = document.getElementById('timer-text');
            const timerProgress = document.getElementById('timer-progress');
            
            timerText.textContent = gameData.timeLeft;
            
            // Atualizar c√≠rculo do timer
            const circumference = 283; // 2 * œÄ * 45
            const offset = circumference - (gameData.timeLeft / gameData.settings.timeLimit) * circumference;
            timerProgress.style.strokeDashoffset = offset;
            
            // Mudar cor conforme o tempo
            if (gameData.timeLeft < 10) {
                timerProgress.style.stroke = '#f44336';
                timerText.style.color = '#f44336';
            } else if (gameData.timeLeft < 20) {
                timerProgress.style.stroke = '#ff9800';
                timerText.style.color = '#ff9800';
            } else {
                timerProgress.style.stroke = '#4caf50';
                timerText.style.color = '#ffeb3b';
            }
        }

        function timeUp() {
            // Desabilitar op√ß√µes
            document.querySelectorAll('.option').forEach(o => {
                o.style.pointerEvents = 'none';
            });
            
            // Mostrar feedback de tempo esgotado
            alert('‚è∞ Tempo esgotado!');
            
            // Registrar como resposta errada
            const q = gameData.questions[gameData.currentQuestion];
            const options = document.querySelectorAll('.option');
            options[q.correct].classList.add('correct');
            
            gameData.userAnswers.push({
                question: q.question,
                userAnswer: -1,
                correctAnswer: q.correct,
                isCorrect: false,
                time: gameData.settings.timeLimit,
                points: 0,
                timeout: true
            });
            
            gameData.currentStreak = 0;
            document.getElementById('next-btn').disabled = false;
        }

        // ================ SISTEMA DE XP E N√çVEIS ================
        function addXP(points) {
            gameData.xp += points;
            
            // Verificar se subiu de n√≠vel
            while (gameData.xp >= gameData.xpToNextLevel) {
                gameData.xp -= gameData.xpToNextLevel;
                gameData.level++;
                gameData.xpToNextLevel = Math.floor(gameData.xpToNextLevel * 1.2); // Aumenta 20% a cada n√≠vel
                
                // Efeitos de level up
                levelUpEffects();
            }
            
            updateLevelDisplay();
            saveGameData();
        }

        function levelUpEffects() {
            // Tocar som
            playSound('level-up');
            
            // Efeito visual
            const levelUp = document.createElement('div');
            levelUp.innerHTML = `
                <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                           background: rgba(0,0,0,0.8); color: white; padding: 30px; border-radius: 20px; 
                           text-align: center; z-index: 10000; border: 3px solid #ffeb3b;">
                    <div style="font-size: 50px; margin-bottom: 20px;">üéâ</div>
                    <h2 style="color: #ffeb3b; margin-bottom: 10px;">N√≠vel Up!</h2>
                    <h3 style="font-size: 40px; color: #4caf50;">N√≠vel ${gameData.level}</h3>
                    <p style="margin-top: 20px;">Novos power-ups desbloqueados!</p>
                </div>
            `;
            document.body.appendChild(levelUp);
            
            // Fogos de artif√≠cio para celebrar level up
            setTimeout(() => createFireworksEffect(), 300);
            
            setTimeout(() => {
                levelUp.style.opacity = '0';
                levelUp.style.transform = 'translate(-50%, -50%) scale(0.8)';
                setTimeout(() => levelUp.remove(), 500);
            }, 3000);
            
            // Desbloquear power-ups adicionais
            if (gameData.level % 3 === 0) {
                Object.keys(gameData.powerUps).forEach(power => {
                    gameData.powerUps[power].count += 1;
                });
                updatePowerUpDisplay();
            }
        }

        // ================ CONQUISTAS ================
        function checkAchievements() {
            const newAchievements = [];
            
            // Verificar conquistas de streak
            if (gameData.currentStreak >= 10 && !achievements.find(a => a.id === 'streak_master').unlocked) {
                unlockAchievement('streak_master');
                newAchievements.push('streak_master');
            }
            
            // Verificar conquistas de tempo
            const avgTime = gameData.questionTimes.reduce((a, b) => a + b, 0) / gameData.questionTimes.length;
            if (avgTime < 30 && gameData.questionTimes.length >= 5 && !achievements.find(a => a.id === 'speed_demon').unlocked) {
                unlockAchievement('speed_demon');
                newAchievements.push('speed_demon');
            }
            
            return newAchievements;
        }

        function checkGameAchievements() {
            const newAchievements = [];
            
            // Primeiro jogo
            if (!achievements.find(a => a.id === 'first_game').unlocked) {
                unlockAchievement('first_game');
                newAchievements.push('first_game');
            }
            
            // Pontua√ß√£o perfeita
            if (gameData.correctAnswers === gameData.totalQuestions && !achievements.find(a => a.id === 'perfect_score').unlocked) {
                unlockAchievement('perfect_score');
                newAchievements.push('perfect_score');
            }
            
            // Usou todos os power-ups
            const totalUsed = Object.values(gameData.powerUps).reduce((sum, p) => sum + p.used, 0);
            if (totalUsed >= 4 && !achievements.find(a => a.id === 'power_user').unlocked) {
                unlockAchievement('power_user');
                newAchievements.push('power_user');
            }
            
            // N√≠vel 10
            if (gameData.level >= 10 && !achievements.find(a => a.id === 'level_10').unlocked) {
                unlockAchievement('level_10');
                newAchievements.push('level_10');
            }
            
            // Mostrar conquistas desbloqueadas
            if (newAchievements.length > 0) {
                showUnlockedAchievements(newAchievements);
                
                // Fogos de artif√≠cio para celebrar conquistas
                setTimeout(() => createFireworksEffect(), 100);
            }
        }

        function unlockAchievement(id) {
            const achievement = achievements.find(a => a.id === id);
            if (achievement && !achievement.unlocked) {
                achievement.unlocked = true;
                gameData.achievements.push(id);
                addXP(achievement.xp);
                updateAchievementsDisplay();
                saveGameData();
                return true;
            }
            return false;
        }

        // ================ INTERFACE ================
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(screenId).style.display = 'block';
        }

        function updateGameStatus() {
            document.getElementById('score').textContent = gameData.score;
            document.getElementById('question-counter').textContent = 
                `${gameData.currentQuestion + 1}/${gameData.totalQuestions}`;
            document.getElementById('streak').textContent = `Streak: ${gameData.currentStreak}`;
            document.getElementById('current-theme').textContent = 
                gameData.theme === 'probabilidade' ? 'Probabilidade' : 'Estat√≠stica';
            document.getElementById('difficulty').textContent = 
                `N√≠vel: ${gameData.settings.difficulty === 'easy' ? 'F√°cil' : 
                        gameData.settings.difficulty === 'medium' ? 'M√©dio' : 
                        gameData.settings.difficulty === 'hard' ? 'Dif√≠cil' : 'Misturado'}`;
            
            updateLevelDisplay();
        }

        function updateLevelDisplay() {
            document.getElementById('level').textContent = gameData.level;
            document.getElementById('xp').textContent = `${gameData.xp}/${gameData.xpToNextLevel} XP`;
            
            const percentage = (gameData.xp / gameData.xpToNextLevel) * 100;
            document.getElementById('level-fill').style.width = `${percentage}%`;
            document.getElementById('level-percentage').textContent = `${Math.floor(percentage)}%`;
        }

        function updatePowerUpDisplay() {
            // Tela inicial
            document.getElementById('hint-count').textContent = gameData.powerUps.hint.count;
            document.getElementById('skip-count').textContent = gameData.powerUps.skip.count;
            document.getElementById('time-count').textContent = gameData.powerUps.time.count;
            document.getElementById('double-count').textContent = gameData.powerUps.double.count;
            
            // Durante o jogo
            document.getElementById('game-hint-count').textContent = gameData.powerUps.hint.count;
            document.getElementById('game-skip-count').textContent = gameData.powerUps.skip.count;
            document.getElementById('game-time-count').textContent = gameData.powerUps.time.count;
            document.getElementById('game-double-count').textContent = gameData.powerUps.double.count;
            
            // Desabilitar power-ups sem estoque
            document.querySelectorAll('.power-up').forEach(powerUp => {
                const power = powerUp.dataset.power;
                if (gameData.powerUps[power].count <= 0) {
                    powerUp.disabled = true;
                } else {
                    powerUp.disabled = false;
                }
            });
        }

        function updateThemeDisplay() {
            // Atualizar progresso dos temas
            const themeProgress = JSON.parse(localStorage.getItem('themeProgress') || '{}');
            
            document.getElementById('probabilidade-progress').textContent = 
                `${themeProgress.probabilidade?.completed || 0}%`;
            document.getElementById('probabilidade-record').textContent = 
                themeProgress.probabilidade?.record || 0;
            
            document.getElementById('estatistica-progress').textContent = 
                `${themeProgress.estatistica?.completed || 0}%`;
            document.getElementById('estatistica-record').textContent = 
                themeProgress.estatistica?.record || 0;
        }

        function showStreakIndicator() {
            const indicator = document.getElementById('streak-indicator');
            document.getElementById('current-streak').textContent = gameData.currentStreak;
            indicator.style.display = 'block';
            
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 3000);
        }

        function createAnswersSummary() {
            const summary = document.getElementById('answers-summary');
            summary.innerHTML = '';
            
            gameData.userAnswers.forEach((answer, index) => {
                const q = gameData.questions[index];
                const item = document.createElement('div');
                item.style.marginBottom = '15px';
                item.style.padding = '15px';
                item.style.background = answer.isCorrect ? 'rgba(76,175,80,0.1)' : 'rgba(244,67,54,0.1)';
                item.style.borderRadius = '10px';
                item.style.borderLeft = `4px solid ${answer.isCorrect ? '#4caf50' : '#f44336'}`;
                
                let status = answer.isCorrect ? '‚úÖ' : '‚ùå';
                if (answer.skipped) status = '‚è≠Ô∏è';
                if (answer.timeout) status = '‚è∞';
                
                item.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 8px;">
                        ${status} Quest√£o ${index + 1}: ${answer.question}
                    </div>
                    <div style="font-size: 14px; color: ${answer.isCorrect ? '#4caf50' : '#f44336'};">
                        ${answer.isCorrect ? 
                            `Acertou! +${answer.points} pontos (${answer.time.toFixed(1)}s)` : 
                            `Resposta correta: ${q.options[answer.correctAnswer]}`
                        }
                        ${answer.skipped ? ' (Pulada)' : ''}
                        ${answer.timeout ? ' (Tempo esgotado)' : ''}
                    </div>
                `;
                
                summary.appendChild(item);
            });
        }

        function createPerformanceChart() {
            const ctx = document.getElementById('performance-chart').getContext('2d');
            
            // Dados para o gr√°fico
            const questionNumbers = Array.from({length: gameData.userAnswers.length}, (_, i) => i + 1);
            const correctness = gameData.userAnswers.map(a => a.isCorrect ? 1 : 0);
            const responseTimes = gameData.userAnswers.map(a => a.time);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: questionNumbers,
                    datasets: [
                        {
                            label: 'Acertos (1=sim, 0=n√£o)',
                            data: correctness,
                            borderColor: '#4caf50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.3,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Tempo de resposta (s)',
                            data: responseTimes,
                            borderColor: '#2196f3',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.3,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#bbdefb'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            },
                            ticks: {
                                color: '#bbdefb'
                            }
                        }
                    }
                }
            });
        }

        // ================ AUDIO CORRIGIDO DEFINITIVAMENTE ================
        let audioEnabled = false;
        
        function initAudio() {
            console.log("Inicializando √°udios...");
            
            // Tentar carregar todos os √°udios
            const audioElements = document.querySelectorAll('audio');
            audioElements.forEach(audio => {
                // Configurar volume
                audio.volume = 0.5;
                
                // Tentar carregar
                audio.load().catch(e => {
                    console.log("Erro ao carregar √°udio:", e);
                });
            });
            
            console.log("√Åudios inicializados");
        }
        
        function testAudio() {
            console.log("Testando √°udio...");
            audioEnabled = true;
            playSound('firework');
            alert("üîä Teste de som realizado! Se voc√™ ouviu fogos de artif√≠cio, o som est√° funcionando.");
        }
        
        function playSound(type) {
            // Verificar se o som est√° habilitado
            if (localStorage.getItem('soundEnabled') === 'false') return;
            
            // Se o √°udio ainda n√£o foi habilitado (primeira intera√ß√£o), n√£o tenta tocar
            if (!audioEnabled) {
                console.log("√Åudio n√£o habilitado ainda. Clique em 'Testar Som' primeiro.");
                return;
            }
            
            const audio = document.getElementById(`${type}-sound`);
            if (audio) {
                try {
                    // Para o √°udio e reinicia
                    audio.pause();
                    audio.currentTime = 0;
                    
                    // Ajustar volume espec√≠fico para fogos de artif√≠cio
                    if (type === 'firework') {
                        audio.volume = 0.6;
                    } else {
                        audio.volume = 0.5;
                    }
                    
                    // Tenta tocar
                    const playPromise = audio.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.catch(error => {
                            console.log(`N√£o foi poss√≠vel tocar o som ${type}:`, error);
                            // Tentativa alternativa - usar √°udio embutido
                            fallbackAudio(type);
                        });
                    }
                } catch (error) {
                    console.log(`Erro ao tocar som ${type}:`, error);
                    fallbackAudio(type);
                }
            } else {
                console.log(`√Åudio n√£o encontrado: ${type}`);
                fallbackAudio(type);
            }
        }
        
        // Fallback para √°udio usando Web Audio API se os URLs externos falharem
        function fallbackAudio(type) {
            console.log(`Usando fallback para: ${type}`);
            
            // Criar contexto de √°udio
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioContext = new AudioContext();
            
            // Gerar som baseado no tipo
            let frequency = 440; // Hz
            let duration = 0.3; // segundos
            
            switch(type) {
                case 'correct':
                    frequency = 523.25; // C5
                    break;
                case 'incorrect':
                    frequency = 349.23; // F4
                    break;
                case 'level-up':
                    frequency = 659.25; // E5
                    break;
                case 'achievement':
                    // Acorde maior
                    playChord([523.25, 659.25, 783.99], 1.0);
                    return;
                case 'powerup':
                    frequency = 587.33; // D5
                    break;
                case 'firework':
                    // Som de explos√£o
                    playExplosionSound();
                    return;
            }
            
            // Criar oscilador
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = 'sine';
            
            // Configurar envelope
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        function playChord(frequencies, duration) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioContext = new AudioContext();
            const gainNode = audioContext.createGain();
            
            gainNode.connect(audioContext.destination);
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            frequencies.forEach(freq => {
                const oscillator = audioContext.createOscillator();
                oscillator.connect(gainNode);
                oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                oscillator.type = 'sine';
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            });
        }
        
        function playExplosionSound() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioContext = new AudioContext();
            const bufferSize = audioContext.sampleRate * 0.5;
            const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
            const output = buffer.getChannelData(0);
            
            // Gerar ru√≠do branco
            for (let i = 0; i < bufferSize; i++) {
                output[i] = Math.random() * 2 - 1;
            }
            
            const whiteNoise = audioContext.createBufferSource();
            whiteNoise.buffer = buffer;
            
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            whiteNoise.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(1000, audioContext.currentTime);
            filter.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 1);
            
            gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            
            whiteNoise.start(audioContext.currentTime);
            whiteNoise.stop(audioContext.currentTime + 1);
        }

        // ================ LOCAL STORAGE ================
        function saveGameData() {
            const data = {
                xp: gameData.xp,
                level: gameData.level,
                xpToNextLevel: gameData.xpToNextLevel,
                achievements: gameData.achievements,
                settings: gameData.settings,
                powerUps: gameData.powerUps
            };
            localStorage.setItem('mathGameData', JSON.stringify(data));
        }

        function loadGameData() {
            const data = JSON.parse(localStorage.getItem('mathGameData'));
            if (data) {
                gameData.xp = data.xp || 0;
                gameData.level = data.level || 1;
                gameData.xpToNextLevel = data.xpToNextLevel || 100;
                gameData.achievements = data.achievements || [];
                gameData.settings = data.settings || gameData.settings;
                gameData.powerUps = data.powerUps || gameData.powerUps;
                
                // Atualizar conquistas
                achievements.forEach(ach => {
                    ach.unlocked = gameData.achievements.includes(ach.id);
                });
            }
            
            // Carregar configura√ß√µes da UI
            document.getElementById('question-count').value = gameData.settings.questionCount;
            document.getElementById('time-limit').value = gameData.settings.timeLimit;
            document.getElementById('difficulty-level').value = gameData.settings.difficulty;
            
            updateAchievementsDisplay();
            updateThemeDisplay();
            updatePowerUpDisplay();
            updateLevelDisplay();
        }

        function saveRecords() {
            const accuracy = (gameData.correctAnswers / gameData.totalQuestions) * 100;
            const themeProgress = JSON.parse(localStorage.getItem('themeProgress') || '{}');
            
            if (!themeProgress[gameData.theme]) {
                themeProgress[gameData.theme] = { completed: 0, record: 0 };
            }
            
            // Atualizar porcentagem de conclus√£o
            themeProgress[gameData.theme].completed = Math.max(
                themeProgress[gameData.theme].completed,
                Math.floor(accuracy)
            );
            
            // Atualizar recorde de pontua√ß√£o
            if (gameData.score > (themeProgress[gameData.theme].record || 0)) {
                themeProgress[gameData.theme].record = gameData.score;
            }
            
            localStorage.setItem('themeProgress', JSON.stringify(themeProgress));
            updateThemeDisplay();
        }

        // ================ CONQUISTAS UI ================
        function updateAchievementsDisplay() {
            const list = document.getElementById('achievements-list');
            list.innerHTML = '';
            
            let unlockedCount = 0;
            
            achievements.forEach(ach => {
                const item = document.createElement('div');
                item.className = `achievement-item ${ach.unlocked ? 'unlocked' : 'locked'}`;
                
                item.innerHTML = `
                    <div class="achievement-icon">${ach.icon}</div>
                    <div class="achievement-info">
                        <h4>${ach.name}</h4>
                        <p>${ach.description}</p>
                        <p style="font-size: 10px; color: ${ach.unlocked ? '#4caf50' : '#f44336'}">
                            ${ach.unlocked ? '‚úÖ Desbloqueado' : 'üîí Bloqueado'} ‚Ä¢ ${ach.xp} XP
                        </p>
                    </div>
                `;
                
                list.appendChild(item);
                if (ach.unlocked) unlockedCount++;
            });
            
            document.getElementById('achievement-count').textContent = unlockedCount;
        }

        function showUnlockedAchievements(achievementIds) {
            const container = document.getElementById('new-achievements');
            const list = document.getElementById('achievements-unlocked');
            list.innerHTML = '';
            
            achievementIds.forEach(id => {
                const ach = achievements.find(a => a.id === id);
                if (ach) {
                    const item = document.createElement('div');
                    item.className = 'achievement-item unlocked';
                    item.style.marginBottom = '10px';
                    item.innerHTML = `
                        <div class="achievement-icon">${ach.icon}</div>
                        <div class="achievement-info">
                            <h4>${ach.name}</h4>
                            <p>${ach.description}</p>
                            <p style="color: #4caf50; font-size: 12px;">+${ach.xp} XP ganhos!</p>
                        </div>
                    `;
                    list.appendChild(item);
                }
            });
            
            container.style.display = 'block';
        }

        function toggleAchievements() {
            document.getElementById('achievements-panel').classList.toggle('active');
        }

        function closeAchievements() {
            document.getElementById('achievements-panel').classList.remove('active');
        }

        // ================ UTILIDADES ================
        function resetGameData() {
            gameData.currentQuestion = 0;
            gameData.score = 0;
            gameData.correctAnswers = 0;
            gameData.userAnswers = [];
            gameData.currentStreak = 0;
            gameData.maxStreak = 0;
            gameData.questionTimes = [];
            gameData.doublePointsActive = false;
            gameData.questionStartTime = null;
            
            // Resetar power-ups (exceto os extras ganhos por n√≠vel)
            gameData.powerUps = {
                hint: { count: 3 + Math.floor(gameData.level / 3), used: 0 },
                skip: { count: 2 + Math.floor(gameData.level / 3), used: 0 },
                time: { count: 1 + Math.floor(gameData.level / 3), used: 0 },
                double: { count: 1 + Math.floor(gameData.level / 3), used: 0 }
            };
        }

        function restartGame() {
            resetGameData();
            showScreen('start-screen');
        }

        function showStats() {
            alert('üìä Estat√≠sticas:\n' +
                  `N√≠vel: ${gameData.level}\n` +
                  `XP: ${gameData.xp}/${gameData.xpToNextLevel}\n` +
                  `Conquistas: ${gameData.achievements.length}/${achievements.length}\n` +
                  `Jogos completados: ${localStorage.getItem('gamesPlayed') || 0}`);
        }

        function shareResults() {
            const accuracy = (gameData.correctAnswers / gameData.totalQuestions) * 100;
            const text = `üéÆ Acabei de jogar Matem√°tica do 9¬∫ Ano!\n` +
                        `Pontua√ß√£o: ${gameData.score} pontos\n` +
                        `Acertos: ${gameData.correctAnswers}/${gameData.totalQuestions} (${accuracy.toFixed(1)}%)\n` +
                        `N√≠vel: ${gameData.level}\n` +
                        `#Matematica #Educacao #JogoEducativo`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Meu Resultado - Jogo de Matem√°tica',
                    text: text,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(text);
                alert('üìã Resultado copiado para a √°rea de transfer√™ncia!');
            }
        }

        // ================ INICIALIZA√á√ÉO FINAL ================
        // Configurar som
        if (localStorage.getItem('soundEnabled') === null) {
            localStorage.setItem('soundEnabled', 'true');
        }
        
        // Habilitar √°udio no primeiro clique do usu√°rio
        document.addEventListener('click', function enableAudio() {
            audioEnabled = true;
            // Remover o listener ap√≥s o primeiro clique
            document.removeEventListener('click', enableAudio);
        });
        
        // Contar jogos jogados
        let gamesPlayed = parseInt(localStorage.getItem('gamesPlayed') || '0');
        localStorage.setItem('gamesPlayed', (gamesPlayed + 1).toString());
        
        console.log('üéÆ Jogo de Matem√°tica carregado com sucesso!');
    </script>
</body>
</html>
